
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5 - Muitas Vari√°veis e os Waffles Esp√∫rios &#8212; Statistical Rethinking</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6 - Os DAGs assombrados &amp; O Terror Causal" href="parte_6.html" />
    <link rel="prev" title="4 - Fun√ß√µes Wiggly" href="parte_4.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Statistical Rethinking</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="capa.html">
   Estatistica Bayesiana
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro_pt-BR.html">
   Intro - Estat√≠stica Bayesiana (üáßüá∑)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_en.html">
   Intro - Bayesian Statistics (üá∫üá∏)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_1.html">
   1- Introdu√ß√£o
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_2.html">
   2 - Engenharia de Golems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_3.html">
   3- Modelos Geoc√™ntricos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_4.html">
   4 - Fun√ß√µes Wiggly
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   5 - Muitas Vari√°veis e os Waffles Esp√∫rios
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_6.html">
   6 - Os DAGs assombrados &amp; O Terror Causal
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_7.html">
   7 - Compasso de Ulisses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_8.html">
   8 - Os peixes-bois condicionais
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_9.html">
   9 - Markov Chain Monte Carlo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_10.html">
   10 - Grande Entropia e Modelos Lineares Generalizados
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_11.html">
   11 - A cravada de Deus e Inteiros
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_12.html">
   12 - Monstros e Misturas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_13.html">
   13 - Modelos com Mem√≥ria
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_14.html">
   14 - Aventuras na Covari√¢ncias
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/parte_5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR/issues/new?title=Issue%20on%20page%20%2Fparte_5.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/rodolphomacedo/statistical_rethinking_pt_BR/main?urlpath=tree/parte_5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   5 - Muitas Vari√°veis e os Waffles Esp√∫rios
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#correlacoes-espurias">
   Correla√ß√µes Esp√∫rias
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regressao-multiplas">
   Regress√£o M√∫ltiplas
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pros-e-contras-das-multiplas-variaveis">
     Pr√≥s e contras das m√∫ltiplas vari√°veis:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiplas-causas-de-divorcios">
     M√∫ltiplas causas de div√≥rcios
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#entendendo-os-grafos-um-pouco-mais-perto">
     Entendendo os grafos um pouco mais perto.
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bons-grafos">
     Bons Grafos
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prioris">
     Prioris
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nosso-modelo">
     Nosso modelo
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#regressao-multipla">
       Regress√£o M√∫ltipla
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predicao-da-posteriori">
     Predi√ß√£o da Posteriori
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-dos-residuos-dos-preditores">
       Plot dos Res√≠duos dos Preditores
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#controles-estatisticos">
     ‚ÄòControles‚Äô estat√≠sticos
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#graficos-contrafactuais">
     Gr√°ficos contrafactuais
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#checagem-da-predicao-da-posteriori">
     Checagem da predi√ß√£o da posteriori
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#associacoes-mascaradas">
     Associa√ß√µes Mascaradas
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#milk-and-brain">
     Milk and Brain
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="muitas-variaveis-e-os-waffles-espurios">
<h1>5 - Muitas Vari√°veis e os Waffles Esp√∫rios<a class="headerlink" href="#muitas-variaveis-e-os-waffles-espurios" title="Permalink to this headline">¬∂</a></h1>
<p>Nosso objetivo nessa parte √© come√ßar o processo da constru√ß√£o de modelos de regress√µes m√∫ltiplas e, assim, tamb√©m come√ßaremos a criar as bases para o <code class="docutils literal notranslate"><span class="pre">framework</span> <span class="pre">de</span> <span class="pre">infer√™ncias</span> <span class="pre">causais</span></code>.</p>
<p>Para iniciarmos a discuss√£o iremos introduzir um exemplo emp√≠rico, ou seja, um exemplo baseado na experi√™ncia e observa√ß√µes, sejam elas baseadas em algum m√©todo (<em>met√≥dicas</em>) ou n√£o.</p>
<a class="reference internal image-reference" href="_images/waffle_house.jpeg"><img alt="Waffle House" src="_images/waffle_house.jpeg" style="width: 1000px;" /></a>
<p><a class="reference external" href="https://br.linkedin.com/company/waffle-house">Fonte</a></p>
<p><a class="reference external" href="https://www.youtube.com/watch?v=e0tO64mtYMU">Aula - Statistical Rethinking Winter 2019 Lecture 05</a></p>
<p>A <em>waffle house</em> √© uma cadeia de restaurantes com mais de <span class="math notranslate nohighlight">\(2000\)</span> locais em <span class="math notranslate nohighlight">\(25\)</span> estados nos EUA (mapa amarelo abaixo). A maioria das suas localiza√ß√µes est√° no Sul do pa√≠s e √© um item da cultural e regional norte americana. (<em><a class="reference external" href="https://en.wikipedia.org/wiki/Waffle_House">wikipedia</a></em>). Uma das particularidades dessa rede de restaurantes √© que eles trabalham 24 horas. Nunca fecham! Essa √© a proposta de neg√≥cio deles.</p>
<p>Um outro fato importante e desagrad√°vel que se surge no sul dos EUA s√£o os <em>Furac√µes</em>. Esses s√£o causados pelas depress√µes tropicais clim√°ticas do pais. Os restaurantes da rede Waffles s√£o um dos √∫nicos estabelecimentos que continuam abertos nesses per√≠odos turbulentos. <em>Exceto quando esses furac√µes atingem uma de suas lojas.</em></p>
<p>A rede √© t√£o confi√°vel que governadores dos EUA criaram o <code class="docutils literal notranslate"><span class="pre">waffle</span> <span class="pre">house</span> <span class="pre">index</span></code>, internamente na FEMA (<em>ag√™ncia federal de gest√£o de emerg√™ncias</em>). Usada como uma m√©trica informal com o nome da rede de restaurantes, pretendem  determinar o efeito das tempestades, como uma escala aux√≠liar para o planejamento de recupera√ß√£o de um desastre. (<em><a class="reference external" href="https://en.wikipedia.org/wiki/Waffle_House_Index">waffle house index</a></em>)</p>
<a class="reference internal image-reference" href="_images/WH_per_people.png"><img alt="waffle house map" src="_images/WH_per_people.png" style="width: 900px;" /></a>
<p>Imagem - <a class="reference external" href="https://www.scottareynhout.com/blog/2017/10/7/waffle-house-map">https://www.scottareynhout.com/blog/2017/10/7/waffle-house-map</a></p>
<p>Al√©m dos desastres naturais, existem tamb√©m muitas outras coisas acontecendo em grande escala no sul dos EUA, tal como <strong>div√≥rcios</strong>!</p>
<p>No gr√°fico abaixo temos a indica√ß√£o da quantidade de div√≥rcios nos EUA. Observe o sul do pa√≠s e compare com o mapa acima.</p>
<a class="reference internal image-reference" href="_images/WH_per_divorce.png"><img alt="Waffle House contry-level-marriage-divorce-data-2010" src="_images/WH_per_divorce.png" style="width: 900px;" /></a>
<p>Imagem - <a class="reference external" href="https://www.bgsu.edu/ncfmr/resources/data/original-data/county-level-marriage-divorce-data-2010.html">https://www.bgsu.edu/ncfmr/resources/data/original-data/county-level-marriage-divorce-data-2010.html</a></p>
<p>Percebeu?</p>
<p>Em ambos os mapas existem uma grande concentra√ß√£o, no extremo do sul do mapa, de restaurantes da rede Waffle House e, subindo mais ao norte do pa√≠s, temos quantidades cada vez menores. O mesmo ocorre no mapa das <em>taxas de div√≥rcios</em>, quando olhamos para os mesmos locais no mapa.</p>
<p>Podemos ent√£o fazer uma estimativa: <code class="docutils literal notranslate"><span class="pre">esses</span> <span class="pre">dados</span> <span class="pre">est√£o</span> <span class="pre">correlacionados</span> <span class="pre">entre</span> <span class="pre">si</span></code>. E podemos nos ser levados a pensar que quanto maior a concentra√ß√£o de restaurantes na regi√£o maior seria seria a taxa de div√≥rcios.</p>
<p>E por que isso acontece?</p>
<p>Pelo seguinte motivo: <code class="docutils literal notranslate"><span class="pre">Por</span> <span class="pre">nada</span></code>!</p>
<p>Isso mesmo, nada!!!</p>
<p>N√£o existe nada que tenha uma rela√ß√£o direta na qual a quantidade de restaurantes da rede em alguma determinada regi√£o influencie casais a brigarem e tomarem a decis√£o de se separar!</p>
<p>√â estranho. √â c√¥mico. √â intrigante. Isso √© uma <code class="docutils literal notranslate"><span class="pre">Correla√ß√£o</span> <span class="pre">Esp√∫ria</span></code>!</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="correlacoes-espurias">
<h1>Correla√ß√µes Esp√∫rias<a class="headerlink" href="#correlacoes-espurias" title="Permalink to this headline">¬∂</a></h1>
<p>Essas s√£o as <code class="docutils literal notranslate"><span class="pre">correla√ß√µes</span> <span class="pre">esp√∫rias</span></code>, ou seja, <code class="docutils literal notranslate"><span class="pre">correla√ß√µes</span> <span class="pre">sem</span> <span class="pre">certeza</span></code>; que n√£o √© verdadeira nem real; √© hipot√©tica!</p>
<p>Muita coisa est√° relacionada com as outras no mundo real. <code class="docutils literal notranslate"><span class="pre">Isso</span> <span class="pre">√©</span> <span class="pre">a</span> <span class="pre">Natureza</span></code>!</p>
<p>Por exemplo, se quisermos, por qualquer motivo que seja, arrumar um ‚Äúargumento‚Äù para enfraquecer a imagem da rede Waffle House, ‚Äúpodemos‚Äù usar essas correla√ß√µes esp√∫rias com um dos argumentos. Assim, n√≥s iriamos expor na m√≠dia a seguinte manchete:</p>
<div class="admonition-breaking-news admonition">
<p class="admonition-title">Breaking News:</p>
<p>Pesquisadores [da universidade xyz] indicam que: o aumento do n√∫mero de restaurantes da rede Waffle House
na regi√£o implica num aumento assustador no n√∫mero de div√≥rcios nessa mesma regi√£o!</p>
</div>
<p>Isso soa estranho, eu sei! Esse √© apenas um exemplo extremo.</p>
<p>Mas, l√° no fundo, esse tipo de pensamento n√£o soa t√£o estranho no dia-a-dia‚Ä¶</p>
<p>Existem diversas correla√ß√µes esp√∫rias no mundo. Muita coisa tem correla√ß√£o com muitas outras coisas.</p>
<div class="admonition-entretanto admonition">
<p class="admonition-title">Entretanto:</p>
<p>Essas correla√ß√µes n√£o implicam causalidade.</p>
</div>
<p>Mas para entendermos melhor, vamos ver mais alguns exemplos sobre essas correla√ß√µes esp√∫rias:</p>
<ul class="simple">
<li><p>O consumo de queijo tem uma correla√ß√£o de <span class="math notranslate nohighlight">\(94.7\%\)</span> com os acidentes fatais com o emaranhado do len√ßol de cama.</p></li>
<li><p>O consumo per capita de frango apresenta uma correla√ß√£o de <span class="math notranslate nohighlight">\(89\%\)</span> com a importa√ß√£o de petr√≥leo.</p></li>
<li><p>Os acidentes por afogamentos em piscina tem a correla√ß√£o de <span class="math notranslate nohighlight">\(66\%\)</span> com o n√∫mero de filmes lan√ßados pelo Nicolas Cage, por ano. Veja graficamente essa correla√ß√£o abaixo:</p></li>
</ul>
<a class="reference internal image-reference" href="_images/chart.jpeg"><img alt="Tyler Vigen spurious correlations" src="_images/chart.jpeg" style="width: 1000px;" /></a>
<p>Percebeu?</p>
<p>Se o consumo de frango diminu√≠sse, a importa√ß√£o provavelmente n√£o sofreria nenhum impacto por essa causa. E, caso o consumo de queijo diminuir, tamb√©m n√£o haver√° uma diminui√ß√£o nos acidentes fatais das pessoas que est√£o dormindo em suas camas. E, como √© esperado, se o Nicolas Cage se aposentar dos cinemas, os acidentes por afogamento continuar√£o constantes.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Correla√ß√£o n√£o implica causalidade!</p>
</div>
<p>Por fim, ter mais lojas da rede Waffle House n√£o <code class="docutils literal notranslate"><span class="pre">causa</span></code> mais div√≥rcios na regi√£o.</p>
<hr class="docutils" />
<p>Mais correla√ß√µes esp√∫rias, tais como essas acima, podem ser encontradas no site do <a class="reference external" href="https://www.tylervigen.com/spurious-correlations">Tyler Vigen</a>.</p>
<hr class="docutils" />
<p>Entendido essa parte, vamos ao objetivo desse cap√≠tulo.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="regressao-multiplas">
<h1>Regress√£o M√∫ltiplas<a class="headerlink" href="#regressao-multiplas" title="Permalink to this headline">¬∂</a></h1>
<p>Vamos ver como construir um modelo de regress√£o linear novamente. Mas dessa vez iremos ver tamb√©m como se faz com  <code class="docutils literal notranslate"><span class="pre">m√∫ltiplas</span> <span class="pre">vari√°veis</span></code> e quais s√£o suas implica√ß√µes.</p>
<div class="section" id="pros-e-contras-das-multiplas-variaveis">
<h2>Pr√≥s e contras das m√∫ltiplas vari√°veis:<a class="headerlink" href="#pros-e-contras-das-multiplas-variaveis" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li><p>A parte boa desse tipo de modelo √© que as regress√µes m√∫ltiplas podem n√£o s√≥ revelar correla√ß√µes esp√∫rias como tamb√©m podem revelar associa√ß√µes escondidas que n√≥s n√£o far√≠amos normalmente, ou seja, n√£o ter√≠amos visto essas associa√ß√µes usando o modelo com uma simples vari√°vel preditora.</p></li>
<li><p>Mas, por outro lado, podemos tamb√©m adicionar vari√°veis explicativas aos modelos que contenham correla√ß√µes esp√∫rias √† regress√£o m√∫ltipla e, podem tamb√©m, esconder as algumas das reais associa√ß√µes que existem.</p></li>
</ul>
<p>Ent√£o, como essas coisas geralmente n√£o s√£o bem explicadas, vamos detalhar todo o processo de constru√ß√£o de uma regress√£o m√∫ltipla, a seguir.</p>
<p>Quando constru√≠mos um modelo usando uma regress√£o m√∫ltipla, n√≥s devemos ter uma estrutura mais profusa para pensar sobre as nossas decis√µes. Apenas <em>jogar</em> todas as vari√°veis explicativas dentro da regress√£o m√∫ltipla, como usualmente √© feito, √© o segredo para o fracasso da an√°lise e n√≥s n√£o queremos fazer isso!</p>
<p>Para isso precisamos de uma estrutura mais ampla e rica para conseguirmos pensar e tomar melhores decis√µes. Essa estrutura √© o <code class="docutils literal notranslate"><span class="pre">framework</span> <span class="pre">de</span> <span class="pre">infer√™ncia</span> <span class="pre">casual</span></code>.</p>
<p>Nessa parte iremos aprender do b√°sico sobre infer√™ncia casual:</p>
<ul class="simple">
<li><p>Grafos ac√≠clicos direcionados (DAGs - <em>Directed acyclic graphs</em>)</p></li>
<li><p>Fork, pipes, colliders‚Ä¶</p></li>
<li><p>Crit√©rio de Backdoor.</p></li>
</ul>
<p>J√° sabemos que o Waffle House n√£o causam os div√≥rcios. Mas o que causa os div√≥rcios?</p>
<p>J√° vimos no mapa acima que div√≥rcios do sul do pa√≠s tem uma taxa bem mais alta do que no restante mais ao norte. Existem muitos esfor√ßos para tentar identificar as causas e as taxas de div√≥rcios. Sabemos que no sul tem uma predomin√¢ncia religiosa quando comparada ao restante do pa√≠s. Isso deixa os cientistas com certas desconfian√ßas.</p>
<p>Existem assim muitas coisas que est√£o correlacionadas com a taxa de div√≥rcios. Uma delas √© a <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamentos</span></code>. Tamb√©m podemos usar essas informa√ß√µes para cada um dos outros <span class="math notranslate nohighlight">\(50\)</span> estados do pa√≠s. Todos eles t√™m uma <code class="docutils literal notranslate"><span class="pre">correla√ß√£o</span> <span class="pre">positiva</span></code> da taxa de casamentos com a taxa de div√≥rcios.</p>
<p>Um ponto importante nessa correla√ß√£o √© que <em>s√≥ pode acontecer um div√≥rcio se houver o casamento</em>!</p>
<p>Mas a correla√ß√£o entre essas taxas podem ser tamb√©m <code class="docutils literal notranslate"><span class="pre">correla√ß√µes</span> <span class="pre">esp√∫rias</span></code>. Assim como a correla√ß√£o entre homic√≠dos e div√≥rcios s√£o uma correla√ß√£o esp√∫ria.</p>
<p>Pois uma taxa alta de casamentos pode indicar que a sociedade v√™ o casamento de modo favor√°vel e isso pode significar taxas de div√≥rcios mais baixas. N√£o necessariamente faz sentido, mas pode ser que as taxas de casamentos e de div√≥rcios sejam correla√ß√µes esp√∫rias tamb√©m.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Correla√ß√£o n√£o implica Causalidade</p></li>
<li><p>Causalidade n√£o implica Correla√ß√£o</p></li>
<li><p>Causalidade implica em correla√ß√£o condicional</p></li>
</ul>
</div>
<p>Assim, precisamos mais do que apenas simples modelos! √â necess√°rio um estrutura mais robusta.</p>
<p>Mas, o que causa os div√≥rcios?</p>
<p>Vamos descobrir isso‚Ä¶</p>
<p>Existe outra vari√°vel que tamb√©m √© correlacionada com a vari√°vel <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">div√≥rcio</span></code>, √© a vari√°vel <code class="docutils literal notranslate"><span class="pre">idade</span> <span class="pre">mediana</span> <span class="pre">das</span> <span class="pre">pessoas</span> <span class="pre">que</span> <span class="pre">se</span> <span class="pre">casam,</span> <span class="pre">em</span> <span class="pre">cada</span> <span class="pre">estado</span></code>. Mas diferente da <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamento</span></code>, essa vari√°vel apresenta uma <em>correla√ß√£o negativa</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">stan</span>
<span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definindo o plano de fundo cinza claro para todos os gr√°ficos feitos no matplotlib</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Desbloqueio do asyncIO do jupyter</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">HPDI</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">,</span> <span class="n">credible_mass</span><span class="p">):</span>
    
    <span class="c1"># Calcula o maior intervalo de probabilidades a partir de uma amostra</span>
    
    <span class="c1"># Fonte: https://stackoverflow.com/questions/22284502/highest-posterior-density-region-and-central-credible-region</span>
    <span class="n">sorted_points</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">)</span>
    <span class="n">ciIdxInc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">credible_mass</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_points</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">nCIs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_points</span><span class="p">)</span> <span class="o">-</span> <span class="n">ciIdxInc</span>
    <span class="n">ciWidth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nCIs</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nCIs</span><span class="p">):</span>
        <span class="n">ciWidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">ciIdxInc</span><span class="p">]</span> <span class="o">-</span> <span class="n">sorted_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">HDImin</span> <span class="o">=</span> <span class="n">sorted_points</span><span class="p">[</span><span class="n">ciWidth</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ciWidth</span><span class="p">))]</span>
        <span class="n">HDImax</span> <span class="o">=</span> <span class="n">sorted_points</span><span class="p">[</span><span class="n">ciWidth</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ciWidth</span><span class="p">))</span><span class="o">+</span><span class="n">ciIdxInc</span><span class="p">]</span>

    <span class="k">return</span><span class="p">(</span><span class="n">HDImin</span><span class="p">,</span> <span class="n">HDImax</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ====================================</span>
<span class="c1">#   Lendo os dados da Waffle House</span>
<span class="c1"># ====================================</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/WaffleDivorce.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Location</th>
      <th>Loc</th>
      <th>Population</th>
      <th>MedianAgeMarriage</th>
      <th>Marriage</th>
      <th>Marriage SE</th>
      <th>Divorce</th>
      <th>Divorce SE</th>
      <th>WaffleHouses</th>
      <th>South</th>
      <th>Slaves1860</th>
      <th>Population1860</th>
      <th>PropSlaves1860</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>AL</td>
      <td>4.78</td>
      <td>25.3</td>
      <td>20.2</td>
      <td>1.27</td>
      <td>12.7</td>
      <td>0.79</td>
      <td>128</td>
      <td>1</td>
      <td>435080</td>
      <td>964201</td>
      <td>0.45</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>AK</td>
      <td>0.71</td>
      <td>25.2</td>
      <td>26.0</td>
      <td>2.93</td>
      <td>12.5</td>
      <td>2.05</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>AZ</td>
      <td>6.33</td>
      <td>25.8</td>
      <td>20.3</td>
      <td>0.98</td>
      <td>10.8</td>
      <td>0.74</td>
      <td>18</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>AR</td>
      <td>2.92</td>
      <td>24.3</td>
      <td>26.4</td>
      <td>1.70</td>
      <td>13.5</td>
      <td>1.22</td>
      <td>41</td>
      <td>1</td>
      <td>111115</td>
      <td>435450</td>
      <td>0.26</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>CA</td>
      <td>37.25</td>
      <td>26.8</td>
      <td>19.1</td>
      <td>0.39</td>
      <td>8.0</td>
      <td>0.24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>379994</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ============================================</span>
<span class="c1">#  Plotando os dados das taxas de div√≥rcios</span>
<span class="c1"># ============================================</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Associa√ß√µes Esp√∫rias?&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Casamento&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Div√≥rcio&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Mediana da Idade dos Noivos&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Div√≥rcio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_21_0.png" src="_images/parte_5_21_0.png" />
</div>
</div>
<p>Vamos construir modelos lineares simples para os dois gr√°ficos acima.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================================</span>
<span class="c1">#  Construindo um modelo linear simples:</span>
<span class="c1">#</span>
<span class="c1">#    taxa de div√≥rcio ~ alpha + beta * taxa_casamento</span>
<span class="c1"># ========================================================</span>
<span class="n">divorce_model1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        vector[N] divorce_rate;</span>
<span class="s2">        vector[N] marriage_rate;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    parameters {</span>
<span class="s2">        real alpha;</span>
<span class="s2">        real beta;</span>
<span class="s2">        real&lt;lower=0, upper=50&gt; sigma;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    model {</span>
<span class="s2">        divorce_rate ~ normal(alpha + beta * marriage_rate, sigma);</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">my_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="p">),</span>
    <span class="s1">&#39;marriage_rate&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">&#39;divorce_rate&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">posteriori1</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">divorce_model1</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">my_data</span><span class="p">)</span>
<span class="n">fit1</span> <span class="o">=</span> <span class="n">posteriori1</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">alpha_1</span> <span class="o">=</span> <span class="n">fit1</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_1</span> <span class="o">=</span> <span class="n">fit1</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma_1</span> <span class="o">=</span> <span class="n">fit1</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==============================================================</span>
<span class="c1"># Construindo um modelo linear simples:</span>
<span class="c1">#</span>
<span class="c1">#  taxa divorcio ~ alpha + beta * mediana da idade dos noivos</span>
<span class="c1"># ==============================================================</span>

<span class="n">stan_model2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        vector[N] divorce_rate;</span>
<span class="s2">        vector[N] median_age_marriage;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    parameters {</span>
<span class="s2">        real alpha;</span>
<span class="s2">        real beta;</span>
<span class="s2">        real&lt;lower=0, upper=50&gt; sigma;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    model {</span>
<span class="s2">        divorce_rate ~ normal(alpha + beta * median_age_marriage, sigma);</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">my_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="p">),</span>
    <span class="s1">&#39;divorce_rate&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">&#39;median_age_marriage&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">posteriori2</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">stan_model2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">my_data</span><span class="p">)</span>
<span class="n">fit2</span> <span class="o">=</span> <span class="n">posteriori2</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">alpha_2</span> <span class="o">=</span> <span class="n">fit2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_2</span> <span class="o">=</span> <span class="n">fit2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma_2</span> <span class="o">=</span> <span class="n">fit2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ====================================================================</span>
<span class="c1">#  Plotando os dados das taxas de div√≥rcios e suas estimativas m√©dias</span>
<span class="c1"># ====================================================================</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Associa√ß√µes Esp√∫rias?&#39;</span><span class="p">)</span>

<span class="c1"># Calculando as regi√µes de HPDI para mu - Taxa de casamentos com 0.92 de credibilidade</span>
<span class="n">range_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="p">)</span>
<span class="n">posteriori_mu_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_1</span> <span class="o">+</span> <span class="n">beta_1</span> <span class="o">*</span> <span class="n">marriage</span> <span class="k">for</span> <span class="n">marriage</span> <span class="ow">in</span> <span class="n">range_mu</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">posteriori_mu_HPDI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">HPDI</span><span class="p">(</span><span class="n">posteriori_marriage</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">)</span> <span class="k">for</span> <span class="n">posteriori_marriage</span> <span class="ow">in</span> <span class="n">posteriori_mu_aux</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Gr√°fico de Div√≥rcio x Casamento</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">range_mu</span><span class="p">,</span> 
                 <span class="n">posteriori_mu_HPDI</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">posteriori_mu_HPDI</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
         <span class="n">alpha_1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">beta_1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Casamento&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Div√≥rcio&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Correla√ß√£o Positiva </span><span class="se">\n</span><span class="s1"> Esp√∫ria?&#39;</span><span class="p">)</span>

<span class="c1"># ------------</span>

<span class="c1"># Calculando as regi√µes de HPDI para mu - Mediana para idade de casamentos com 0.92 de credibilidade</span>
<span class="n">range_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="p">)</span>
<span class="n">posteriori_mu_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_2</span> <span class="o">+</span> <span class="n">beta_2</span> <span class="o">*</span> <span class="n">mediaAgeMarriage</span> <span class="k">for</span> <span class="n">mediaAgeMarriage</span> <span class="ow">in</span> <span class="n">range_mu</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">posteriori_mu_HPDI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">HPDI</span><span class="p">(</span><span class="n">posteriori_mediaAgeMarriage</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">)</span> <span class="k">for</span> <span class="n">posteriori_mediaAgeMarriage</span> <span class="ow">in</span> <span class="n">posteriori_mu_aux</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Gr√°fico de Div√≥rcio x Mediana da Idade dos Casamentos</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">range_mu</span><span class="p">,</span> 
                 <span class="n">posteriori_mu_HPDI</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">posteriori_mu_HPDI</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
         <span class="n">alpha_2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">beta_2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Mediana da Idade dos Noivos&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Div√≥rcio&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Correla√ß√£o Negativa </span><span class="se">\n</span><span class="s1"> Esp√∫ria?&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_25_0.png" src="_images/parte_5_25_0.png" />
</div>
</div>
<p>Observando os dois gr√°ficos acima, quais dessas correla√ß√µes s√£o <code class="docutils literal notranslate"><span class="pre">causas</span> <span class="pre">plaus√≠veis</span></code>?</p>
<p>No gr√°fico da esquerda, sabemos que a <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamento</span></code> tem uma associa√ß√£o direta com a <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">div√≥rcio</span></code>, pois, para se divorciar √© necess√°rio antes ter casado. Mas essa interpreta√ß√£o dos fatos pode estar contaminada pelo nosso senso comum e, assim, uma associa√ß√£o esp√∫ria, nos seria v√°lida. Um dos motivos pra isso acontecer √© que em locais que possuem maiores incentivos religiosos e podem implicar em maiores incentivos para casamentos, podendo, assim, n√£o haver uma causalidade direta com o div√≥rcio.</p>
<p>J√° no gr√°fico √† direita, a <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">div√≥rcio</span></code> est√° associada com <code class="docutils literal notranslate"><span class="pre">mediana</span> <span class="pre">das</span> <span class="pre">idades</span> <span class="pre">dos</span> <span class="pre">noivos</span></code>, nos apresentando uma associa√ß√£o negativa. Isso pode nos levar a pensar que jovens, ao se casarem, tomam decis√µes muito emotivas e que isso tamb√©m levaria a altas taxas de div√≥rcios. Ou pode ser que essa seja uma associa√ß√£o esp√∫ria e nossas hip√≥teses e nosso senso comum n√£o tenha sentido.</p>
<p>Assim, mesmo que nossas justificativas sejam bastante <code class="docutils literal notranslate"><span class="pre">veross√≠meis</span></code> a respeito do comportamento da Natureza do evento, n√£o podemos afirmar que essas associa√ß√µes n√£o sejam esp√∫rias.</p>
<p>Se a identifica√ß√£o de associa√ß√µes esp√∫rias, como no exemplo de filmes do <em>Nicolas Cage</em>, <code class="docutils literal notranslate"><span class="pre">pareciam</span> <span class="pre">√≥bvias</span></code> de serem identificadas, agora, essas n√£o parecem ser t√£o simples de perceber sua veracidade.</p>
<p>Portanto, √© necess√°rio construirmos um ferramental que nos permita identificar com mais facilidade e, com um maior grau de certeza, se essas associa√ß√µes s√£o reais ou s√£o esp√∫rias.</p>
<p>O que queremos fazer agora √© colocar essas duas vari√°veis no mesmo modelo e entender o que isso faz e por que nos revela, quase certamente, que determinada vari√°vel √© uma <code class="docutils literal notranslate"><span class="pre">impostora</span></code>.</p>
</div>
<div class="section" id="multiplas-causas-de-divorcios">
<h2>M√∫ltiplas causas de div√≥rcios<a class="headerlink" href="#multiplas-causas-de-divorcios" title="Permalink to this headline">¬∂</a></h2>
<img alt="Aprender a taxa casamentos de uma cidade" src="_images/cidade1.jpg" />
<p><a class="reference external" href="https://pt.wikipedia.org/wiki/Cidade#/media/Ficheiro:Hong_Kong_Night_Skyline.jpg">Fonte: <em>Hong Kong - wikipedia</em></a></p>
<p>Como entender o mecanismo das Causas Naturais de div√≥rcio numa cidade grande</p>
<p>O que n√≥s queremos saber √© qual o valor de uma <code class="docutils literal notranslate"><span class="pre">vari√°vel</span> <span class="pre">preditora</span></code>, uma vez que n√≥s conhecemos os valores das outras vari√°veis preditoras corretamente?</p>
<p>Todas vari√°veis preditoras s√£o ,em alguma extens√£o, correlacionadas com as outras vari√°veis preditoras e, tamb√©m, com a vari√°vel resposta. Entretanto, elas t√™m <code class="docutils literal notranslate"><span class="pre">correla√ß√µes</span> <span class="pre">parciais</span></code> que s√£o reveladoras de informa√ß√µes adicionais dessa estrutura de correla√ß√£o.</p>
<p>Para entendermos melhor, vamos exemplificar com nosso exemplo sobre div√≥rcios.</p>
<p>N√≥s gostariamos de aprender mais sobre o valor da <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamentos</span></code>, uma vez que j√° conhecemos a <code class="docutils literal notranslate"><span class="pre">mediana</span> <span class="pre">da</span> <span class="pre">idade</span> <span class="pre">da</span> <span class="pre">taxa</span> <span class="pre">dos</span> <span class="pre">noivos</span></code>.</p>
</div>
<div class="section" id="entendendo-os-grafos-um-pouco-mais-perto">
<h2>Entendendo os grafos um pouco mais perto.<a class="headerlink" href="#entendendo-os-grafos-um-pouco-mais-perto" title="Permalink to this headline">¬∂</a></h2>
<p>DAG‚Äôs s√£o o acr√¥nimo para a express√£o ingl√™s <code class="docutils literal notranslate"><span class="pre">Directed</span> <span class="pre">Acyclic</span> <span class="pre">Graph</span></code>, o que √© portug√™s √© conhecido como <code class="docutils literal notranslate"><span class="pre">Grafos</span> <span class="pre">Ac√≠clicos</span> <span class="pre">Direcionados</span></code> <a class="reference external" href="https://pt.wikipedia.org/wiki/Grafos_ac%C3%ADclicos_dirigidos">(<em>ver mais em wikipedia</em>)</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =======================================</span>
<span class="c1">#   Construindo o desenho de um DAG </span>
<span class="c1"># =======================================</span>

<span class="c1"># -----------------------------------------------------</span>
<span class="c1"># Obs: Os pr√≥ximos grafos irei esconder os c√≥digos, </span>
<span class="c1">#      para ficar visualmente melhor. Mas, se quiser,</span>
<span class="c1">#      os c√≥digos podem ser encontrados no github.</span>
<span class="c1"># -----------------------------------------------------</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">size</span><span class="o">=</span><span class="mi">40</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.495</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Grafo dos Div√≥rcios&#39;</span><span class="p">)</span>

<span class="c1"># Edge: M &lt;---&gt; D</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> 
             <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.79</span><span class="p">,</span> <span class="mf">0.79</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.265</span><span class="p">)</span> <span class="p">,</span>
             <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;,  head_width=1, head_length=1.2&quot;</span><span class="p">))</span>

<span class="c1"># Edge: A &lt;---&gt; M</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> 
             <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.77</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">),</span>
             <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;,  head_width=1, head_length=1.2&quot;</span><span class="p">))</span>

<span class="c1"># Edge: A &lt;---&gt; D</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> 
             <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.77</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">),</span>
             <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;,  head_width=1, head_length=1.2&quot;</span><span class="p">))</span>


<span class="c1"># Remover os valores dos eixos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_34_0.png" src="_images/parte_5_34_0.png" />
</div>
</div>
<p>DAG‚Äôs s√£o ferramentas heur√≠sticas usadas no framework de infer√™ncias causais. Elas n√£o como ferramentas mec√¢nicas anal√≠ticas que j√° vimos, mas s√£o <em>incrivelmente</em> √∫teis para nos auxiliar a pensar melhor e eventualmente tamb√©m nos permite entender muito melhor os modelos mec√¢nicos.</p>
<p>As setas do <em>DAG</em> apontam apenas em uma <code class="docutils literal notranslate"><span class="pre">dire√ß√£o</span></code> e essa dire√ß√µes indica uma <code class="docutils literal notranslate"><span class="pre">rela√ß√£o</span> <span class="pre">de</span> <span class="pre">causalidade</span></code> entre as vari√°veis analisadas, ou seja, indica que uma vari√°vel tem <code class="docutils literal notranslate"><span class="pre">influ√™ncia</span> <span class="pre">direta</span></code> sobre a outra.</p>
<p>A aus√™ncia de <em>ciclos</em> significa que n√£o existem <em>loops</em> na causalidade. Mas esses loops podem acontecer sobre o tempo, o que tornaria a an√°lise tamb√©m uma <code class="docutils literal notranslate"><span class="pre">s√©rie</span> <span class="pre">temporal</span></code>!</p>
<p>A representa√ß√£o desses problemas reais em estruturas como <em>DAG‚Äôs</em> podem ser, realmente, muito grandes. Pois, assim, podemos descrever a estrutura no tempo <span class="math notranslate nohighlight">\(T\)</span>, <span class="math notranslate nohighlight">\(\{T_1, T_2, ...\}\)</span>, e assim por diante.</p>
<p>N√≥s, normalmente rotulamos os grafos por dois nomes: <code class="docutils literal notranslate"><span class="pre">n√≥s</span></code> (<em>nodes</em>) e <code class="docutils literal notranslate"><span class="pre">arestas</span></code> (<em>edge</em>). (Iremos aqui, por conve√ß√£o, usar os nomes em ingl√™s.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Os nodes (n√≥s) s√£o as vari√°veis. J√° os edges (as arestas) representam a rela√ß√£o causal entre os nodes.</p>
</div>
<p>As associa√ß√µes que foram levadas em considera√ß√£o, podem  ser inclu√≠das dentro dos modelos de redes bayesianas, que s√£o considerados parte do conjunto de ferramentas de <em>Machine Learning</em>. Esses modelos tamb√©m n√£o levam em considera√ß√£o a causalidade, pois n√£o existe um mecanismo interno nesses modelos que leve em considera√ß√£o a dire√ß√£o da causalidade.</p>
<p>J√° nos <em>DAG‚Äôs</em>, tal mecanismo, existe!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Esse mecanismo nos permite a capacidade de enxergar, atrav√©s das lentes probabil√≠sticas, a influ√™ncia da causa e efeito em diferentes eventos! Isso n√£o √© medir uma associa√ß√£o. √â uma medida para a causalidade!</p>
</div>
<p>E isso, faz <code class="docutils literal notranslate"><span class="pre">toda</span></code> a diferen√ßa!</p>
<p><em>Tamb√©m veremos qual √© a diferen√ßa entre as duas abordagens comnetadas‚Ä¶</em></p>
</div>
<div class="section" id="bons-grafos">
<h2>Bons Grafos<a class="headerlink" href="#bons-grafos" title="Permalink to this headline">¬∂</a></h2>
<p>Queremos saber a diferen√ßa entre esses dois grafos abaixo. O da esquerda tem um caminho direto de <span class="math notranslate nohighlight">\(A &lt;-&gt; M &lt;-&gt; D\)</span> e, no outro gr√°fico, uma suposi√ß√£o de que temos que a rela√ß√£o causal entre a taxa de casamento (<span class="math notranslate nohighlight">\(M\)</span>) e a taxa de div√≥rcio (<span class="math notranslate nohighlight">\(D\)</span>) n√£o existe mais.</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="_images/parte_5_40_0.png" src="_images/parte_5_40_0.png" />
</div>
</div>
<p>Regress√µes Lineares, em princ√≠pio, podem nos dizer a diferen√ßa entre essas duas coisas. Mas uma regress√£o bivariada j√° n√£o pode mais. Elas podem nos dar apenas algum conhecimento da associa√ß√£o entre <em>casamentos</em> e <em>div√≥rcios</em>, mas <code class="docutils literal notranslate"><span class="pre">n√£o</span> <span class="pre">podem</span> <span class="pre">nos</span> <span class="pre">dizer</span> <span class="pre">qual</span> <span class="pre">a</span> <span class="pre">diferen√ßa</span> <span class="pre">entre</span> <span class="pre">esses</span> <span class="pre">dois</span> <span class="pre">*DAG's*</span></code> acima.</p>
<p>Mas, porque n√£o?</p>
<p>Por que, A tem influ√™ncia tanto na taxa de casamentos (<span class="math notranslate nohighlight">\(A &lt;-&gt; M\)</span>) quanto em D (<span class="math notranslate nohighlight">\(A &lt;-&gt; D\)</span>), isso gera uma <code class="docutils literal notranslate"><span class="pre">correla√ß√£o</span></code> entre os eventos <em>taxa de casamento</em> (<span class="math notranslate nohighlight">\(M\)</span>) e <em>taxa de div√≥rcio</em> (<span class="math notranslate nohighlight">\(D\)</span>), mesmo que uma n√£o influencie na outra, como no gr√°fico √† direita. (<em>Elegante essa explica√ß√£o, hein!</em>)</p>
<p>√â um modo bonito de dizer:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Correla√ß√£o n√£o √© Casualidade!</p>
</div>
<p>Essa mesmo estrutura do <em>DAG‚Äôs</em>, pode ser modelada com as correla√ß√µes esp√∫rias do in√≠cio do cap√≠tulo, <em>waffle House</em> vs <em>taxa de div√≥rcios</em></p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="_images/parte_5_42_0.png" src="_images/parte_5_42_0.png" />
</div>
</div>
<p>A correla√ß√£o que existe entre essas duas vari√°veis como foi visto anteriormente, tem sua origem na causa de algum outro evento que n√£o conhecemos, rotulado por (<span class="math notranslate nohighlight">\(?\)</span>). S√≥ sabemos que seu comportamento tem uma influ√™ncia direta sobre a magnitude do efeito dos div√≥rcios e da quantidade de lojas da rede de restaurantes tem por regi√£o.</p>
<p>Ent√£o, se estamos tentando medir a liga√ß√£o entre a taxa de casamentos (<span class="math notranslate nohighlight">\(M\)</span>) e a taxa de div√≥rcios (<span class="math notranslate nohighlight">\(D\)</span>) usando, como sugest√£o, a estrutura o grafo da direita (<em>da figura acima</em>), teremos uma grande confus√£o. Pois  mais adiante uma defini√ß√£o melhor sobre essa confus√£o.</p>
<p>Vamos rotular essa estrutura com a seguinte nota√ß√£o:</p>
<div class="math notranslate nohighlight">
\[ M &lt;-&gt; D | A \]</div>
<p>Significa que podemos conhecer a <code class="docutils literal notranslate"><span class="pre">associa√ß√£o</span></code> que <span class="math notranslate nohighlight">\(M\)</span> e <span class="math notranslate nohighlight">\(D\)</span> tem entre si, (<span class="math notranslate nohighlight">\(M &lt;-&gt; D\)</span>), condicionado (<span class="math notranslate nohighlight">\(|\)</span>, caracter chamado de <em>pipe</em>) a <span class="math notranslate nohighlight">\(A\)</span>.</p>
<p>Quando conhecemos o valor de <span class="math notranslate nohighlight">\(A\)</span>, ent√£o eu tenho um valor extra, uma associa√ß√£o externa, entre as duas vari√°veis. E √© isso que a regress√£o m√∫ltipla pode pode nos dizer.</p>
<div class="math notranslate nohighlight">
\[ D_i \sim Normal(\mu_i, \sigma)\]</div>
<div class="math notranslate nohighlight">
\[ \mu_i = \alpha + \beta_M M_i + \beta_A A_i \]</div>
<p>Onde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(D_i\)</span>: Taxa de div√≥rcio</p></li>
</ul>
<p>As taxas m√©dias dos casamentos:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta_M\)</span>: A ‚Äò<em>peso</em>‚Äô da taxa de casamentos</p></li>
<li><p><span class="math notranslate nohighlight">\(M_i\)</span>: A taxa m√©dia de casamentos</p></li>
</ul>
<p>As as medianas das idades nos casamentos:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta_A\)</span>: A ‚Äò<em>peso</em>‚Äô da mediana das idades dos casamentos</p></li>
<li><p><span class="math notranslate nohighlight">\(A_i\)</span>: Mediana das idades dos casamentos</p></li>
</ul>
<p>Podemos ver que esse modelo tem uma certa diferen√ßa dos modelos que vimos anteriormente. Existe um <span class="math notranslate nohighlight">\(\beta\)</span> para cada uma das vari√°veis preditoras.</p>
<p>Essa regress√£o linear, √© um tipo especial de <em>rede bayesiana</em>, associa a vari√°vel resposta (<span class="math notranslate nohighlight">\(D_i\)</span>) a uma distribui√ß√£o gaussiana. E sua m√©dia (<span class="math notranslate nohighlight">\(\mu_i\)</span>) √© dada pela vari√°veis j√° conhecidas e um desvio padr√£o (<span class="math notranslate nohighlight">\(\sigma\)</span>).</p>
<p>Ent√£o, nossa m√©dia ser√° descrita como <span class="math notranslate nohighlight">\(\mu_i\)</span>, onde <span class="math notranslate nohighlight">\(i\)</span>, significa que condicionaremos os valores de <span class="math notranslate nohighlight">\(\mu_i\)</span> para cada <span class="math notranslate nohighlight">\(i\)</span>. Aqui, no exemplo, cada <span class="math notranslate nohighlight">\(i\)</span> indica um novo estado do sul dos EUA. E, assim, cada condicionamento ser√° descrito pelos ‚Äò<em>pesos</em>‚Äô multiplicado as suas pr√≥prias vari√°veis preditoras.</p>
</div>
<div class="section" id="prioris">
<h2>Prioris<a class="headerlink" href="#prioris" title="Permalink to this headline">¬∂</a></h2>
<p>Agora, n√≥s iremos padronizar a vari√°vel <em>taxa de div√≥rcio</em> (<span class="math notranslate nohighlight">\(D_i\)</span>), a vari√°vel <em>taxa de casamento</em> (<span class="math notranslate nohighlight">\(M_i\)</span>) e tamb√©m a vari√°vel <em>mediana das idades dos casamentos</em>.</p>
<p>Assim, como esperamos, podemos escrever a priori para <span class="math notranslate nohighlight">\(\alpha\)</span> da seguinte forma:</p>
<div class="math notranslate nohighlight">
\[\alpha \sim Normal(0, 0.2)\]</div>
<p>Pois esperamos que <span class="math notranslate nohighlight">\(\alpha\)</span> esteja pr√≥ximo de zero!</p>
<p>E as prioris para os <span class="math notranslate nohighlight">\(\beta\)</span>‚Äôs da seguinte forma:</p>
<div class="math notranslate nohighlight">
\[ \beta_M \sim Normal(0, 0.5)\]</div>
<div class="math notranslate nohighlight">
\[ \beta_A \sim Normal(0, 0.5)\]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim Exponential(1) \]</div>
<p>Pois todos os valores foram padronizados, e assim esperamos que a estimativa √† priori seja pr√≥xima de zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#   Padronizando as vari√°veis </span>
<span class="c1"># =============================</span>
<span class="n">M_stdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> 
<span class="n">D_stdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">A_stdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===========================================================</span>
<span class="c1">#  Priori preditiva para Mediana das Idades dos Casamentos</span>
<span class="c1"># ===========================================================</span>

<span class="n">range_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">A_stdr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">A_stdr</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>  <span class="c1"># Range de valores da m√©dia de idade dos casamentos padronizados</span>

<span class="n">qtd_amostras</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># Quantidade de amostras da priori preditiva</span>

<span class="c1"># Amostrando os valores de ùúáùëñ da priori</span>
<span class="n">ùõº</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">qtd_amostras</span><span class="p">)</span>
<span class="n">ùõΩ_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">qtd_amostras</span><span class="p">)</span>
<span class="n">ùúé</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">qtd_amostras</span><span class="p">)</span>  <span class="c1"># Priori ùúé ~ Exp(1)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================</span>
<span class="c1">#   Gr√°fico da Priori Preditiva para ùúáùëñ</span>
<span class="c1"># ========================================</span>

<span class="n">ùúá</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ùõº</span> <span class="o">+</span> <span class="n">ùõΩ_A</span> <span class="o">*</span> <span class="n">A_i</span> <span class="k">for</span> <span class="n">A_i</span> <span class="ow">in</span> <span class="n">range_A</span> <span class="p">]</span>  <span class="c1"># Calculando ùúáùëñ = ùõº + ùõΩùê¥ * ùê¥ùëñ, para todo ùê¥ùëñ</span>

<span class="c1"># Plotando o gr√°fico </span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="c1"># Relembrando o DAG: A &lt;-&gt; D!</span>
<span class="c1"># Plotando as retas da posteriori para ùúáùëñ</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">range_A</span><span class="p">,</span> <span class="n">ùúá</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Priori Preditiva de $\mu_i$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;( $A$ ) M√©dia das Idades dos Casamentos (padronizadas)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;( $D$ ) Taxa de Div√≥rcio (padronizadas)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="c1"># Ajustando os limites da visuzaliza√ß√£o do gr√°fico.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_51_0.png" src="_images/parte_5_51_0.png" />
</div>
</div>
<p>Temos no gr√°fico acima a representa√ß√£o da nossa distribui√ß√£o √† priori do modelo de regress√£o linear. Sorteamos <span class="math notranslate nohighlight">\(50\)</span> linhas dessa distribui√ß√£o. Essa √© a distribui√ß√£o  √† priori preditiva de <span class="math notranslate nohighlight">\(\mu_i\)</span>.  Ou seja, <code class="docutils literal notranslate"><span class="pre">isso</span> <span class="pre">√©</span> <span class="pre">oque</span> <span class="pre">nosso</span> <span class="pre">modelo</span> <span class="pre">pensa</span> <span class="pre">sobre</span> <span class="pre">o</span> <span class="pre">problema,</span> <span class="pre">antes</span> <span class="pre">de</span> <span class="pre">darmos</span> <span class="pre">os</span> <span class="pre">dados</span> <span class="pre">√†</span> <span class="pre">ele</span></code>.</p>
<p>Temos que sempre fazer a simula√ß√£o da priori preditiva. S√≥ assim ser√° poss√≠vel entender uma importante caracter√≠stica presente em todos os modelo. Temos observar se a amplitude da priori faz sentido. Quando n√≥s dermos os dados para o modelo, √© necess√°rio que as estimativas do modelo resida sobre distribui√ß√£o √† priori. Caso contr√°rio, teremos uma priori ruim. Em cen√°rios mais simples, e com muitos dados, esse efeito pode at√© passar despercebido e ajustar bem. Por√©m em cen√°rios mais complexos, uma priori ruim poder√° ser desastrosa!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sempre verifique a priori.</p>
</div>
<p>Vamos andar pelo gr√°fico para entendermos melhor suas partes. Iniciando pela <code class="docutils literal notranslate"><span class="pre">M√©dia</span> <span class="pre">das</span> <span class="pre">Idades</span> <span class="pre">dos</span> <span class="pre">Casamentos</span> <span class="pre">padronizada</span> <span class="pre">($A$</span> <span class="pre">padronizada)</span></code> que √© uma gaussiana, centrada em <span class="math notranslate nohighlight">\(0\)</span> e com desvio padr√£o<span class="math notranslate nohighlight">\(\frac{1}{2}\)</span>:</p>
<div class="math notranslate nohighlight">
\[A \sim Normal(0, 0.5)\]</div>
<p>No gr√°fico n√≥s estamos observando todos os valores dentro do intervalo <span class="math notranslate nohighlight">\([-2, \mbox{ } 2]\)</span>. Esse intervalo corresponde ao <span class="math notranslate nohighlight">\(2^o\)</span> desvio padr√£o! Isso deve corresponder a grande maioria dos casos que os valores da Mediana das Idades dos Casamentos (<em>padronizadas</em>) ir√° ocorrer.</p>
<p>Esse pensamento tamb√©m √© v√°lido para a vari√°vel <code class="docutils literal notranslate"><span class="pre">Taxa</span> <span class="pre">de</span> <span class="pre">Div√≥rcio</span> <span class="pre">($D$</span> <span class="pre">padronizada)</span></code>. Seus valores tamb√©m est√£o delimitados pelo intervalo <span class="math notranslate nohighlight">\([-2, \mbox{ } 2]\)</span>, representando o <span class="math notranslate nohighlight">\(2^o\)</span> desvio padr√£o.</p>
<p>Esse modelo nos diz √© qual a taxa de div√≥rcio padronizada,(<span class="math notranslate nohighlight">\(D\)</span>), que √© uma vari√°vel <em>z-score</em>, quando j√° conhecemos os valores da M√©dia das Idades dos Casamentos (<span class="math notranslate nohighlight">\(A\)</span>), que tamb√©m est√° padronizada (outra <em>z-score</em>). Assim temos duas vari√°veis padronizadas, <em>z-scores</em>, explicando uma √† outra.</p>
<p>Agora, se as linhas da regress√£o linear n√£o morar no espa√ßo delimitado pela priori, ent√£o a <code class="docutils literal notranslate"><span class="pre">escolhemos</span> <span class="pre">uma</span> <span class="pre">priori</span> <span class="pre">ruim</span></code>! Por que isso √© imposs√≠vel! Se ap√≥s dermos os dados pra o modelo, a inclina√ß√£o da curva for maior que a delimitada pela regi√£o da priori, temos uma priori ruim.</p>
<p>Ainda podemos discutir se a escolha da priori ir√° governar todo o range da taxa de div√≥ricio. Provavelmente n√£o √© verdade. Em cap√≠tulos posteriores, quando falarmos sobre <em>overfitting</em> (ou em portugu√™s, teremos um sobreajuste). Isso acontece pois a priori n√£o √© apertada o suficiente para trabalharmos seguran√ßa. Nesse caso podemos pensar em prioris <em>flat</em>, que podem ser justificada cientificamente, tal como uma priori <em>flat</em> impl√≠cita nas an√°lises frequentistas.</p>
</div>
<div class="section" id="nosso-modelo">
<h2>Nosso modelo<a class="headerlink" href="#nosso-modelo" title="Permalink to this headline">¬∂</a></h2>
<p>Esse √© nosso modelo, descrito na primeira linha. Na segunda linha temos dois termos lineares, lembrando que o termo linear significa aditivo. Esses dois termos ir√° gerar um plano. A seguir, teremos nossas prioris. Um destaque para a priori do <span class="math notranslate nohighlight">\(\sigma\)</span>, de agora em diante n√£o vamos mais usar <span class="math notranslate nohighlight">\(Uniform\)</span> mas sim a distribui√ß√£o <span class="math notranslate nohighlight">\(Exponential\)</span>, pois ela tem boas propriedades. Falaremos mais sobre isso adiante.</p>
<div class="math notranslate nohighlight">
\[D_i \sim Normal(\mu_i, \sigma) \]</div>
<div class="math notranslate nohighlight">
\[ \mu_i = \alpha + \beta_M M_i + \beta_A A_i \]</div>
<div class="math notranslate nohighlight">
\[ \alpha \sim Normal(0, 0.2) \]</div>
<div class="math notranslate nohighlight">
\[ \beta_M \sim Normal(0, 0.5) \]</div>
<div class="math notranslate nohighlight">
\[ \beta_A \sim Normal(0, 0.5) \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim  Exponential(1) \]</div>
<p>O uso da distribui√ß√£o <span class="math notranslate nohighlight">\(Exponential\)</span> como priori para <span class="math notranslate nohighlight">\(\sigma\)</span> tem vantagens tais como, sempre tem valores positivos, para valores maiores a sua probabilidade decresce e para defini-l√° precisamos indicar qual ser√° seu valor m√©dio.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================</span>
<span class="c1">#  Estimando o modelo linear proposto</span>
<span class="c1"># =====================================</span>

<span class="n">stan_model_divorce</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        vector[N] divorce_rate;</span>
<span class="s2">        vector[N] marriage_rate;</span>
<span class="s2">        vector[N] median_age;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    parameters {</span>
<span class="s2">        real alpha;</span>
<span class="s2">        real beta_M;</span>
<span class="s2">        real beta_A;</span>
<span class="s2">        real&lt;lower=0&gt; sigma;</span>
<span class="s2">    }</span>

<span class="s2">    model{</span>
<span class="s2">        alpha ~ normal(0, 0.2);</span>
<span class="s2">        beta_M ~ normal(0,0.5);</span>
<span class="s2">        beta_A ~ normal(0, 0.5);</span>
<span class="s2">        sigma ~ exponential(1);</span>
<span class="s2">        </span>
<span class="s2">        divorce_rate ~ normal(alpha + </span>
<span class="s2">                              beta_M * marriage_rate + </span>
<span class="s2">                              beta_A * median_age, </span>
<span class="s2">                              sigma);</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">my_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">D_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> 
    <span class="s1">&#39;divorce_rate&#39;</span><span class="p">:</span> <span class="n">D_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">&#39;marriage_rate&#39;</span><span class="p">:</span> <span class="n">M_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">&#39;median_age&#39;</span><span class="p">:</span> <span class="n">A_stdr</span><span class="o">.</span><span class="n">values</span>
<span class="p">}</span>

<span class="n">posteriori_divorce</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">stan_model_divorce</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">my_data</span><span class="p">)</span>
<span class="n">fit_divorce</span> <span class="o">=</span> <span class="n">posteriori_divorce</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_M</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;beta_M&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_A</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;beta_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Iremos usar esses valores mais tarde nesse material, quando formos fazer a verifica√ß√£o.</span>
<span class="c1"># Assim,irei renomear as vari√°veis da posteriori.</span>

<span class="n">alpha_check</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_M_check</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;beta_M&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_A_check</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;beta_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma_check</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resume_posteriori</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">confidence_HPDI</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the summary of posteriori data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">posteriori</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">confi_HPDI</span> <span class="o">=</span> <span class="n">HPDI</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">confidence_HPDI</span><span class="p">)</span>
    
    <span class="n">posteriori</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">posteriori</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">posteriori</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confi_HPDI</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">posteriori</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confi_HPDI</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">posteriori</span><span class="p">]),</span> <span class="n">rounded</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">describe_posteriori</span><span class="p">(</span><span class="n">vars_post</span><span class="p">,</span> <span class="n">confidence_HPDI</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="n">post</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">var_</span> <span class="ow">in</span> <span class="n">vars_post</span><span class="p">:</span>
        <span class="n">post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resume_posteriori</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">var_</span><span class="p">),</span> <span class="n">confidence_HPDI</span><span class="p">))</span>
    
    <span class="n">hpdi_min_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_HPDI</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
    <span class="n">hpdi_max_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">confidence_HPDI</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
        
    <span class="n">post</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">post</span><span class="p">,</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">vars_post</span><span class="p">,</span>
                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="s1">&#39;Std&#39;</span><span class="p">,</span> <span class="n">hpdi_min_label</span><span class="p">,</span> <span class="n">hpdi_max_label</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Estimativas das Posterioris&#39;</span><span class="p">)</span>
        
        <span class="n">min_axis_</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">max_axis_</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_axis_</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">max_axis_</span><span class="o">*</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">min_axis_</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">0.2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
            

        <span class="k">if</span> <span class="n">min_axis_</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">max_axis_</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">post</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================</span>
<span class="c1">#  Descrevendo os dados da posteriori</span>
<span class="c1"># =====================================</span>

<span class="n">vars_post</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_M&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_A&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
<span class="n">describe_posteriori</span><span class="p">(</span><span class="n">vars_post</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>Std</th>
      <th>5.5%</th>
      <th>94.5%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>alpha</th>
      <td>-0.00</td>
      <td>0.10</td>
      <td>-0.18</td>
      <td>0.20</td>
    </tr>
    <tr>
      <th>beta_M</th>
      <td>-0.06</td>
      <td>0.16</td>
      <td>-0.38</td>
      <td>0.23</td>
    </tr>
    <tr>
      <th>beta_A</th>
      <td>-0.61</td>
      <td>0.16</td>
      <td>-0.91</td>
      <td>-0.29</td>
    </tr>
    <tr>
      <th>sigma</th>
      <td>0.83</td>
      <td>0.09</td>
      <td>0.67</td>
      <td>0.99</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As informa√ß√µes da tabela acima cont√©m um resumo das posterioris estimadas. Como esperado <span class="math notranslate nohighlight">\(\alpha\)</span> tem a m√©dia <span class="math notranslate nohighlight">\(0\)</span>. Pois tinha que ser assim conforme a constru√ß√£o do nosso modelo.</p>
<p>J√° a estimativa para do <span class="math notranslate nohighlight">\(\beta_M\)</span>, <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamento</span></code>, √© levemente negativa e o desvio padr√£o est√° entre <span class="math notranslate nohighlight">\(2\)</span> a <span class="math notranslate nohighlight">\(3\)</span> vezes a sua m√©dia. Podemos olhar para o intervalo de HPDI de <span class="math notranslate nohighlight">\(89\%\)</span> no qual essa valores est√£o entre <span class="math notranslate nohighlight">\(-0.36\)</span> e <span class="math notranslate nohighlight">\(0.26\)</span>.</p>
<p>Talvez exista algum efeito, ou talvez n√£o tenha nenhum efeito dependendo da dire√ß√£o. N√≥s apenas n√£o sabemos muito bem o que pensar sobre essa vari√°vel, pois ela n√£o apresenta uma rela√ß√£o consistente, n√£o existe uma associa√ß√£o consistente na regress√£o multipla entre a <em>taxa de casamentos</em> e a <em>taxa de div√≥rcios</em>.</p>
<p>Agora, a <code class="docutils literal notranslate"><span class="pre">mediana</span> <span class="pre">das</span> <span class="pre">idades</span> <span class="pre">do</span> <span class="pre">casamentos</span></code> tem uma estimativa m√©dia de <span class="math notranslate nohighlight">\(-0.6\)</span> com o desvio padr√£o tamb√©m de <span class="math notranslate nohighlight">\(0.16\)</span>, temos que a massa da posteriori est√° inteiramente abaixo de zero! Assim, realmente temos uma associ√ß√£o negativa entre a <em>media das idades dos casasmentos</em> e a <em>taxa de div√≥rcios</em>.</p>
<p>Mas agora n√≥s j√° sabemos que n√£o temos um <code class="docutils literal notranslate"><span class="pre">impacto</span> <span class="pre">diretamente</span> <span class="pre">causal</span></code> entre <em>taxa de casamentos</em> e a <em>taxa de div√≥rcios</em>. Isso estava mascarado pois <em>idade mediana</em> √© uma causa comum entre as duas outras vari√°veis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Legendas</span>
<span class="c1"># ===========</span>

<span class="c1"># beta_2 == D ~ A   </span>
<span class="c1"># beta_A ==&gt; D ~ A + M </span>

<span class="c1"># beta_M ==&gt; D ~ A + M  </span>
<span class="c1"># beta_1 ==&gt; D ~ M  </span>

<span class="n">vars_all</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beta_1&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_M&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_2&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_A&#39;</span><span class="p">]</span> 
<span class="n">describe_posteriori</span><span class="p">(</span><span class="n">vars_all</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_61_0.png" src="_images/parte_5_61_0.png" />
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>Std</th>
      <th>5.5%</th>
      <th>94.5%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>beta_1</th>
      <td>0.18</td>
      <td>0.06</td>
      <td>0.06</td>
      <td>0.30</td>
    </tr>
    <tr>
      <th>beta_M</th>
      <td>-0.06</td>
      <td>0.16</td>
      <td>-0.38</td>
      <td>0.23</td>
    </tr>
    <tr>
      <th>beta_2</th>
      <td>-0.88</td>
      <td>0.18</td>
      <td>-1.21</td>
      <td>-0.55</td>
    </tr>
    <tr>
      <th>beta_A</th>
      <td>-0.61</td>
      <td>0.16</td>
      <td>-0.91</td>
      <td>-0.29</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Quando observando as tabelas acima e comparando com o gr√°fico, temos que a taxa de casamentos (<span class="math notranslate nohighlight">\(\beta_M\)</span>), resultante da regress√£o multipla, tem a sua distribui√ß√£o √† posteriori, com <span class="math notranslate nohighlight">\(89\%\)</span> de HPDI, contendo o <code class="docutils literal notranslate"><span class="pre">zero</span></code>. Portanto prov√°velmente a vari√°vel taxa de casamento (<span class="math notranslate nohighlight">\(\beta_M\)</span>) <code class="docutils literal notranslate"><span class="pre">n√£o</span> <span class="pre">tem</span> <span class="pre">impacto</span> <span class="pre">casual</span> <span class="pre">direto</span></code> na taxa de div√≥rcio.</p>
<p>Ele foi mascarado por que a <em>mediana das idades dos casamentos</em> (<span class="math notranslate nohighlight">\(A\)</span>) √© uma vari√°vel que influ√™ncia tanto a <em>taxa de div√≥rcio</em> quanto a <em>taxa de casamentos</em>.</p>
<p>No gr√°fico acima fica claro que o modelo <em>beta_1</em>, no modelo <span class="math notranslate nohighlight">\(D ~ M\)</span>, nos diz que <em>taxa de casamento</em> tem uma associa√ß√£o positiva com a <em>taxa de div√≥rcio</em>, o que era de se esperar pelos nossos entendimentos sobre como poderia funcionar esse evento.</p>
<p>Entretanto, como a regress√£o m√∫ltipla podemos ver que a posteriori atinge o zero, e assim n√£o podemos perceber que <em>provavelmente</em> n√£o existe uma associa√ß√£o entre a <em>taxa de casamentos</em> e a <em>taxa de div√≥rcios</em>.</p>
<p>Isso √© uma boa coisa que a regress√£o m√∫ltipla pode fazer por n√≥s! Eu acredito que <code class="docutils literal notranslate"><span class="pre">essa</span> <span class="pre">√©</span> <span class="pre">realmente</span> <span class="pre">a</span> <span class="pre">rela√ß√£o</span> <span class="pre">causal</span></code> que temos aqui.</p>
<p>Assim, nosso <em>DAG</em> provavelmente seria dessa forma:</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="_images/parte_5_63_0.png" src="_images/parte_5_63_0.png" />
</div>
</div>
<p>Assim, como n√£o temos uma rela√ß√£o forte da <em>taxa de casamentos</em> (<span class="math notranslate nohighlight">\(M\)</span>) com a vari√°vel <em>taxa de div√≥rcios</em> (<span class="math notranslate nohighlight">\(D\)</span>), a representa√ß√£o de nosso <em>DAG</em>, ou seja, a representa√ß√£o da causalidade, poder√° ser mapeada de acordo com o gr√°fico acima.</p>
<p>Mas vamos explorar um pouco melhor o significado dessa abordagem.</p>
<div class="section" id="regressao-multipla">
<h3>Regress√£o M√∫ltipla<a class="headerlink" href="#regressao-multipla" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Uma vez que n√≥s conhecemos <span class="math notranslate nohighlight">\(A\)</span>, <em>mediana das idades dos casamentos</em>, existe apenas um pequeno valor adicional de conhecimento sobre <span class="math notranslate nohighlight">\(D\)</span> que est√° contido em <span class="math notranslate nohighlight">\(M\)</span>, a <em>taxa de casamento</em>.</p></li>
</ul>
<p>Ent√£o podemos interpretar isso da seguinte forma, ao conhecermos os valores de <span class="math notranslate nohighlight">\(A\)</span> implica que o conhecimento de <span class="math notranslate nohighlight">\(M\)</span> n√£o vai nos ajudar muito mais a entender <span class="math notranslate nohighlight">\(D\)</span>. Isso coincide com <em>DAG</em> acima, onde n√£o h√° rela√ß√£o causal da <em>taxa de casamentos</em> para a <em>taxa de div√≥rcios</em>.</p>
<ul class="simple">
<li><p>Uma vez que n√≥s conhecemos a <span class="math notranslate nohighlight">\(M\)</span>, taxa de casamentos, h√° muito valor em conhecer tamb√©m <span class="math notranslate nohighlight">\(A\)</span>, mediana das idades dos casamentos.</p></li>
</ul>
<p>Isso funciona na outra dire√ß√£o, pois a <em>mediana das idades dos casamentos</em> (<span class="math notranslate nohighlight">\(A\)</span>) √© uma <code class="docutils literal notranslate"><span class="pre">causa</span></code> comum da <em>taxa de casamentos</em> (<span class="math notranslate nohighlight">\(M\)</span>).</p>
<ul class="simple">
<li><p>Se n√≥s n√£o conhecermos a <em>mediana das idades dos casamentos</em> (<span class="math notranslate nohighlight">\(A\)</span>) em algum estado, ainda √© √∫til conhecer a <em>taxa de casamentos</em> (<span class="math notranslate nohighlight">\(M\)</span>).</p></li>
</ul>
<p>Saber sobre a <em>taxa de casamentos</em> (<span class="math notranslate nohighlight">\(M\)</span>) √© √∫til e importante pois isso pode nos d√° informa√ß√µes adicionais. Essa informa√ß√£o vem de outra rela√ß√£o causal e n√£o nos d√° uma informa√ß√£o causal direta entre as vari√°veis.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Esse √© nosso neg√≥cio aqui. A infer√™ncia! Descobrir a diferen√ßa entre essas coisas.</p>
</div>
<p>Se n√≥s apenas quisermos fazer uma previs√£o e n√£o nos importarmos com a infer√™ncia causal, a <em>taxa de casamento</em> √© √∫til e ajudar√° a prever as coisas. Mas, por outro lado, n√£o nos ajuda a fazer <code class="docutils literal notranslate"><span class="pre">intereven√ß√µes</span> <span class="pre">no</span> <span class="pre">mundo</span> <span class="pre">real</span></code>, porque se quisermos mudar a <em>taxa de div√≥rcios</em> (<span class="math notranslate nohighlight">\(D\)</span>) nos estado manipulando a <em>taxa de casamento</em> (<span class="math notranslate nohighlight">\(M\)</span>) n√£o teria nenhum efeito.</p>
<p>Simplesmente por que n√£o √© assim que as coisas funcionam. <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">maquinaria</span> <span class="pre">de</span> <span class="pre">causalidade</span> <span class="pre">natural</span> <span class="pre">dos</span> <span class="pre">div√≥rcios</span> <span class="pre">n√£o</span> <span class="pre">apresenta</span> <span class="pre">essa</span> <span class="pre">liga√ß√£o</span></code> entre da <em>taxa de casamentos</em> para a <em>taxa de div√≥rcios</em>.</p>
<p>Assim, para efeito de pol√≠ticas p√∫blicas, √© necess√°rio focar nas altera√ß√µes na <em>mediana da idade dos casamentos</em> (<span class="math notranslate nohighlight">\(M\)</span>) para verificar os efeitos na <em>taxa de div√≥rcios</em> (<span class="math notranslate nohighlight">\(D\)</span>).</p>
<p>Assim precisamos ser claros se queremos <strong>apenas</strong> prever as coisas. Se quisermos tamb√©m inteferir as rela√ß√µes causais, devemos fazer a previs√£o das rela√ß√µes causais para que possamos fazer as interven√ß√µes. <code class="docutils literal notranslate"><span class="pre">Uma</span> <span class="pre">interven√ß√£o</span> <span class="pre">requer</span> <span class="pre">um</span> <span class="pre">verdadeiro</span> <span class="pre">entendimento</span> <span class="pre">da</span> <span class="pre">causalidade</span> <span class="pre">do</span> <span class="pre">sistema</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Uma previs√£o n√£o tem o poder de fazer tais interven√ß√µes causais.</p>
</div>
<p>Isso √© o grande terror da ci√™ncia, podemos fazer previs√µes realmente boas sem entendermos nada! Lembra dos modelos <em>geoc√™ntricos</em>. <code class="docutils literal notranslate"><span class="pre">Modelo</span> <span class="pre">estat√≠sticos</span> <span class="pre">corretos</span> <span class="pre">n√£o</span> <span class="pre">s√£o</span> <span class="pre">suficientes</span> <span class="pre">para</span> <span class="pre">descobrir</span> <span class="pre">rela√ß√µes</span> <span class="pre">causais</span></code>, ent√£o precisamos de algo extra!</p>
</div>
</div>
<div class="section" id="predicao-da-posteriori">
<h2>Predi√ß√£o da Posteriori<a class="headerlink" href="#predicao-da-posteriori" title="Permalink to this headline">¬∂</a></h2>
<p>Como visualizamos os modelos como este acima? Existem muitas diferentes formas de mostrar isso. Vamos ver algumas  formas e exemplos rapidamente. Por√©m a maneira mais √∫til de visualizar um particular modelo depende do modelo em particular e do objeto de estudo que estamos tentando observar. N√£o existe uma forma gen√©rica para visualizar qualquer tipo de gr√°fico.</p>
<p>Vamos apresentar alguns exemplos:</p>
<ol class="simple">
<li><p><strong>Plot dos res√≠duos dos preditores</strong>: Muito √∫til para entender como a regress√£o funciona, assim iremos fazer isso apenas uma vez nesse curso. Esse tipo de visualiza√ß√£o √© muito bom para entender o funcionamento da regress√£o mas n√£o √© t√£o bom para comunicar os resultados.</p></li>
<li><p><strong>Plot contrafactuais</strong>: Chama-se contrafactuais pois n√≥s imaginamos como manipular qualquer uma das vari√°veis sem alterar quaisquer outras vari√°rveis. Com isso faremos as previs√µes para saber como o modelo se comporta com essas manipula√ß√µes.</p></li>
<li><p><strong>Plot da Predi√ß√£o da Posteriori</strong>: √â basicamente o mesmo que j√° fizemos antes, por√©m veremos alguns pontos diferentes mais adiante.</p></li>
</ol>
<div class="section" id="plot-dos-residuos-dos-preditores">
<h3>Plot dos Res√≠duos dos Preditores<a class="headerlink" href="#plot-dos-residuos-dos-preditores" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p><strong>Objetivo:</strong> Mostrar a associa√ß√£o de cada um dos preditores com o resultado, ‚Äúcontrolado‚Äù por outras preditores.</p></li>
</ul>
<p>A associa√ß√£o de uma vari√°vel com o resultado parece ter o controle em outras vari√°veis preditoras, ent√£o dentro da maquinaria do modelo. Queremos com isso entender como o modelo <em>enxerga</em> essas coisas internamente. Isso √© o que queremos fazer, calcular esses estados intermedi√°rios mesmo que eles n√£o sejam vis√≠veis no modelo, para termos uma boa intui√ß√£o do que est√° acontecendo internamente no modelo.</p>
<ul class="simple">
<li><p>Nos d√° uma intui√ß√£o muito boa.</p></li>
</ul>
<p>√ötil para termos uma intui√ß√£o do modelo e como est√° o seu funcionamento interno.</p>
<ul class="simple">
<li><p>Nunca analise os res√≠duos.</p></li>
</ul>
<p>N√£o existem motivos l√≥gicos para fazer uma regress√£o da vari√°vel resposta, (<span class="math notranslate nohighlight">\(D \sim residuos\)</span>, por exemplo), isso nos d√° uma resposta errada. Pois nos dar√° estimativas erradas e tend√™nciosas.</p>
<p><strong>Receita</strong>:</p>
<ol class="simple">
<li><p><strong>Fa√ßa uma regress√£o de uma vari√°vel com as outras vari√°veis.</strong></p>
<ul class="simple">
<li><p>No nosso exemplo, teremos a <em>idade mediana dos casamentos</em>, (<span class="math notranslate nohighlight">\(M\)</span>) explicando a <em>taxa de casamento</em>, (<span class="math notranslate nohighlight">\(A\)</span>), ambas padronizadas.</p></li>
</ul>
</li>
<li><p><strong>Calcule os res√≠duos dos preditores.</strong></p>
<ul class="simple">
<li><p>Assim podemos encontrar a <em>vari√¢ncia extra</em> que sobrou depois dessa associa√ß√£o, esses s√£o os res√≠duos.</p></li>
</ul>
</li>
<li><p><strong>Fa√ßa uma regress√£o da vari√°veis resposta com os res√≠duos encontrados no passo anterior.</strong></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================================</span>
<span class="c1">#   Lendo os dados da Waffle House (novamente)</span>
<span class="c1"># =============================================</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/WaffleDivorce.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Location</th>
      <th>Loc</th>
      <th>Population</th>
      <th>MedianAgeMarriage</th>
      <th>Marriage</th>
      <th>Marriage SE</th>
      <th>Divorce</th>
      <th>Divorce SE</th>
      <th>WaffleHouses</th>
      <th>South</th>
      <th>Slaves1860</th>
      <th>Population1860</th>
      <th>PropSlaves1860</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>AL</td>
      <td>4.78</td>
      <td>25.3</td>
      <td>20.2</td>
      <td>1.27</td>
      <td>12.7</td>
      <td>0.79</td>
      <td>128</td>
      <td>1</td>
      <td>435080</td>
      <td>964201</td>
      <td>0.45</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>AK</td>
      <td>0.71</td>
      <td>25.2</td>
      <td>26.0</td>
      <td>2.93</td>
      <td>12.5</td>
      <td>2.05</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>AZ</td>
      <td>6.33</td>
      <td>25.8</td>
      <td>20.3</td>
      <td>0.98</td>
      <td>10.8</td>
      <td>0.74</td>
      <td>18</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>AR</td>
      <td>2.92</td>
      <td>24.3</td>
      <td>26.4</td>
      <td>1.70</td>
      <td>13.5</td>
      <td>1.22</td>
      <td>41</td>
      <td>1</td>
      <td>111115</td>
      <td>435450</td>
      <td>0.26</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>CA</td>
      <td>37.25</td>
      <td>26.8</td>
      <td>19.1</td>
      <td>0.39</td>
      <td>8.0</td>
      <td>0.24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>379994</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==========================================</span>
<span class="c1">#   Relembrando: Padronizando as vari√°veis </span>
<span class="c1"># ==========================================</span>
<span class="n">M_stdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> 
<span class="n">D_stdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">A_stdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Para evitar a reescrever muito c√≥digo, irei ao longo do texto criando alguns fun√ß√µes para facilitar a leitura.</p>
<p>Segue abaixo a primeira fun√ß√£o, ela ir√° plotar uma priori para um modelo linear normalmente distribu√≠do.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===================</span>
<span class="c1">#  Plotando a priori</span>
<span class="c1"># ===================</span>

<span class="k">def</span> <span class="nf">plot_priori_lm_normal</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot √† priori to linear model using normal distribution.</span>
<span class="sd">    </span>
<span class="sd">    Modelo:</span>
<span class="sd">    =======</span>
<span class="sd">    y ~ normal(mu_i, sigma)</span>
<span class="sd">    mi = alpha + beta * x</span>
<span class="sd">    </span>
<span class="sd">    Prioris:</span>
<span class="sd">    ========</span>
<span class="sd">    alpha ~ normal(alpha[alpha_mean], alpha[alpha_std], N)</span>
<span class="sd">    beta ~ normal(beta[beta_mean], beta[beta_std], N)</span>
<span class="sd">    sigma ~ exponential(1)</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    =======</span>
<span class="sd">    N: int</span>
<span class="sd">    alpha: [alpha_mean, alpha_std]</span>
<span class="sd">    beta: [beta_mean, beta_std]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Prioris</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>   

    <span class="c1"># Os dados originais est√£o padronizados</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># Modelo linear para as prioris</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">x_i</span> <span class="k">for</span> <span class="n">x_i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

    <span class="c1"># Plotando a priori</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Plot das Prioris normalizadas&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;(x) - Eixo X&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;(y) - Eixo y&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Abaixo, a fun√ß√£o ir√° encapsular todo o c√≥digo de uma regress√£o linear bayesiana univariada.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ================================</span>
<span class="c1">#  Regress√£o Linear - Univariada </span>
<span class="c1"># ================================</span>

<span class="k">def</span> <span class="nf">plot_lm_posteriori</span><span class="p">(</span><span class="n">var_y</span><span class="p">,</span> <span class="n">var_x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">plot_residuos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                       <span class="n">title_xaxis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title_yaxis</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># Modelo linear para as prioris</span>
    <span class="c1"># Os dados originais est√£o padronizados</span>

    <span class="c1"># Os dados originais est√£o padronizados</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    
    <span class="c1"># C√°culo dos y e y_mean dado x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">x_i</span> <span class="k">for</span> <span class="n">x_i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="n">y_mean</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">beta</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">x</span>

    <span class="c1"># Plotando a priori</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_x</span><span class="p">,</span> <span class="n">var_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_residuos</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">var_x</span><span class="p">,</span> <span class="n">var_x</span><span class="p">],</span> 
                 <span class="p">[</span><span class="n">var_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">beta</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">var_x</span><span class="p">],</span>
                 <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Posteriori Plot dos Res√≠duos dos Preditores&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">title_xaxis</span> <span class="k">if</span> <span class="n">title_xaxis</span> <span class="k">else</span> <span class="s1">&#39;(x) - Eixo x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">title_yaxis</span> <span class="k">if</span> <span class="n">title_yaxis</span> <span class="k">else</span> <span class="s1">&#39;(y) - Eixo y&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    

<span class="k">def</span> <span class="nf">lm</span><span class="p">(</span><span class="n">var_y</span><span class="p">,</span> <span class="n">var_x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">filter_n</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
       <span class="n">plot_residuos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title_xaxis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title_yaxis</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_y</span><span class="p">)):</span>  <span class="c1"># TODO: Use except to raise an error.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Erro: As dimens√µes das vari√°veis n√£o s√£o iguais.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="n">stan_model</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; </span>
<span class="s2">        data {</span>
<span class="s2">            int&lt;lower=0&gt; N;</span>
<span class="s2">            vector[N] variavel_resposta;</span>
<span class="s2">            vector[N] variavel_explicativa;</span>
<span class="s2">            real alpha_mean;</span>
<span class="s2">            real alpha_std;</span>
<span class="s2">            real beta_mean;</span>
<span class="s2">            real beta_std;</span>
<span class="s2">            real exp;</span>
<span class="s2">        }</span>

<span class="s2">        parameters {</span>
<span class="s2">            real alpha;</span>
<span class="s2">            real beta;</span>
<span class="s2">            real&lt;lower=0&gt; sigma;</span>
<span class="s2">        }</span>

<span class="s2">        model {</span>
<span class="s2">            alpha ~ normal(alpha_mean, alpha_std);</span>
<span class="s2">            beta ~ normal(beta_mean, beta_std);</span>
<span class="s2">            sigma ~ exponential(</span><span class="si">{exp}</span><span class="s2">);</span>

<span class="s2">            variavel_resposta ~ normal(alpha +  beta  * variavel_explicativa, sigma);</span>
<span class="s2">        }</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_y</span><span class="p">),</span>
        <span class="s1">&#39;variavel_resposta&#39;</span><span class="p">:</span> <span class="n">var_y</span><span class="p">,</span>
        <span class="s1">&#39;variavel_explicativa&#39;</span><span class="p">:</span> <span class="n">var_x</span><span class="p">,</span>
        <span class="s1">&#39;alpha_mean&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;alpha_std&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;beta_mean&#39;</span><span class="p">:</span> <span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;beta_std&#39;</span><span class="p">:</span> <span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="n">exp</span><span class="p">,</span>
    <span class="p">}</span>
    
    <span class="n">posteriori</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">stan_model</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">posteriori</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="n">num_chains</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>

    <span class="n">alpha_</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">beta_</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    
    <span class="c1"># Filtra a quantidade de dados para o plot</span>
    <span class="k">if</span> <span class="n">filter_n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">alpha_</span> <span class="o">=</span> <span class="n">alpha_</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">alpha_</span><span class="p">)</span> <span class="o">-</span> <span class="n">filter_n</span><span class="p">:</span> <span class="p">]</span>
        <span class="n">beta_</span> <span class="o">=</span> <span class="n">beta_</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">beta_</span><span class="p">)</span> <span class="o">-</span> <span class="n">filter_n</span><span class="p">:</span> <span class="p">]</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plot_lm_posteriori</span><span class="p">(</span><span class="n">var_y</span><span class="p">,</span> <span class="n">var_x</span><span class="p">,</span> <span class="n">alpha_</span><span class="p">,</span> <span class="n">beta_</span><span class="p">,</span> <span class="n">plot_residuos</span><span class="o">=</span><span class="n">plot_residuos</span><span class="p">,</span> 
                           <span class="n">title_xaxis</span><span class="o">=</span><span class="n">title_xaxis</span><span class="p">,</span> <span class="n">title_yaxis</span><span class="o">=</span><span class="n">title_yaxis</span><span class="p">)</span>
    
    <span class="n">residuos</span> <span class="o">=</span> <span class="n">var_y</span> <span class="o">-</span> <span class="p">(</span><span class="n">alpha_</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">beta_</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">var_x</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">alpha_</span><span class="p">,</span> <span class="n">beta_</span><span class="p">,</span> <span class="n">residuos</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ====================================</span>
<span class="c1">#  Plotando a priori para verificar </span>
<span class="c1"># ====================================</span>
<span class="c1"># Prioris</span>
<span class="n">alpha_divorce</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
<span class="n">beta_divorce</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">200</span>

<span class="c1"># Plot da Priori - Modelo linear</span>
<span class="n">plot_priori_lm_normal</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">alpha_divorce</span><span class="p">,</span> <span class="n">beta_divorce</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_77_0.png" src="_images/parte_5_77_0.png" />
</div>
</div>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==================</span>
<span class="c1">#  Posteriori M ~ A</span>
<span class="c1"># ==================</span>

<span class="n">posteriori_MA</span> <span class="o">=</span> <span class="n">lm</span><span class="p">(</span><span class="n">var_y</span><span class="o">=</span><span class="n">M_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">var_x</span><span class="o">=</span><span class="n">A_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_divorce</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta_divorce</span><span class="p">,</span>
                   <span class="n">title_yaxis</span><span class="o">=</span> <span class="s2">&quot;Taxa de casamentos (M)&quot;</span><span class="p">,</span>
                   <span class="n">title_xaxis</span><span class="o">=</span> <span class="s2">&quot;Mediana das Idades dos Casamentos (A)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#  Posteriori D ~ residuos_MA</span>
<span class="c1"># =============================</span>
<span class="n">residuos_MA</span> <span class="o">=</span> <span class="n">posteriori_MA</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">posteriori_MA</span> <span class="o">=</span> <span class="n">lm</span><span class="p">(</span><span class="n">D_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">residuos_MA</span><span class="p">,</span> <span class="n">alpha_divorce</span><span class="p">,</span> <span class="n">beta_divorce</span><span class="p">,</span> <span class="n">plot_residuos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">title_xaxis</span><span class="o">=</span><span class="s2">&quot;Taxa de Div√≥rcio (D)&quot;</span><span class="p">,</span> 
                   <span class="n">title_yaxis</span><span class="o">=</span><span class="s2">&quot;Res√≠duos da Taxa de Casamentos (A-residual)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===================</span>
<span class="c1">#  Posteriori A ~ M</span>
<span class="c1"># ===================</span>

<span class="n">posteriori_AM</span> <span class="o">=</span> <span class="n">lm</span><span class="p">(</span><span class="n">var_y</span><span class="o">=</span><span class="n">A_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">var_x</span><span class="o">=</span><span class="n">M_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_divorce</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta_divorce</span><span class="p">,</span> 
                   <span class="n">title_yaxis</span><span class="o">=</span> <span class="s2">&quot;Mediana das Idades dos Casamentos (A)&quot;</span><span class="p">,</span>
                   <span class="n">title_xaxis</span><span class="o">=</span> <span class="s2">&quot;Taxa de casamentos (M)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#  Posteriori D ~ residuos_AM</span>
<span class="c1"># =============================</span>
<span class="n">residuos_AM</span> <span class="o">=</span> <span class="n">posteriori_AM</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Res√≠duos</span>

<span class="c1"># posteriori_AM = lm(D_stdr.values, residuos_AM, alpha_divorce, beta_divorce, plot_residuos=False)</span>
<span class="n">posteriori_AM</span> <span class="o">=</span> <span class="n">lm</span><span class="p">(</span><span class="n">D_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">residuos_AM</span><span class="p">,</span> <span class="n">alpha_divorce</span><span class="p">,</span> <span class="n">beta_divorce</span><span class="p">,</span> <span class="n">plot_residuos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">title_xaxis</span><span class="o">=</span><span class="s2">&quot;Taxa de Div√≥rcio (D)&quot;</span><span class="p">,</span> 
                   <span class="n">title_yaxis</span><span class="o">=</span><span class="s2">&quot;Res√≠duos da Idade da Mediana dos Casamentos (M-residual)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Podemos observar que nos gr√°ficos acima (o (<span class="math notranslate nohighlight">\(2^o\)</span>) gr√°fico <code class="docutils literal notranslate"><span class="pre">Posteriori</span> <span class="pre">D</span> <span class="pre">~</span> <span class="pre">residuos_MA</span></code> e o (<span class="math notranslate nohighlight">\(4^o\)</span>) gr√°fico <code class="docutils literal notranslate"><span class="pre">Posteriori</span> <span class="pre">D</span> <span class="pre">~</span> <span class="pre">residuos_AM</span></code>) que a regress√£o dos seus respectivos res√≠duos explicando a taxa de div√≥rcio.</p>
<p>Existe uma forte correla√ß√£o negativa no gr√°fico <code class="docutils literal notranslate"><span class="pre">Posteriori</span> <span class="pre">D</span> <span class="pre">~</span> <span class="pre">residuos_AM</span></code>, o que j√° ocorre no gr√°fico <code class="docutils literal notranslate"><span class="pre">Posteriori</span> <span class="pre">D</span> <span class="pre">~</span> <span class="pre">residuos_MA</span></code>. Isso ocorre por que assim existe um valor consider√°vel
da <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamentos</span> <span class="pre">(M)</span></code> que explica</p>
<hr class="docutils" />
<p>(<strong>TODO:</strong> <em>Comparar com a <a class="reference external" href="https://youtu.be/e0tO64mtYMU?t=2281">aula</a>, 38:01</em> - Parece que est√£o invertidos.)</p>
</div>
</div>
<div class="section" id="controles-estatisticos">
<h2>‚ÄòControles‚Äô estat√≠sticos<a class="headerlink" href="#controles-estatisticos" title="Permalink to this headline">¬∂</a></h2>
<p>Quando pensamos em controles estat√≠ticos, j√° nos vem a mente os <em>Designs de Experimentos</em>, no qual configuramos quais as vari√°veis s√£o poss√≠velmente <em>causas</em> nos estudos observados. N√£o fazemos isso, n√£o h√° nada √©tico que indique que <em>taxa de casamento</em> (<span class="math notranslate nohighlight">\(M\)</span>) √© causa de algo. Isso n√£o √© √©tico com as outras pessoas nem conosco fazer essas coisas.</p>
<p>Ent√£o, n√≥s est√°vemos presos a estudos observacionais para uma quantidade muito grande de problemas importantes e o que n√≥s queremos fazer √© <code class="docutils literal notranslate"><span class="pre">inferencias</span> <span class="pre">causais</span></code> no entanto, e as regress√µes m√∫ltiplas nos oferecem uma forma para fazer isso, apenas quando combinamos com uma ideia clara sobre quais s√£o as rela√ß√µes causais entre os modelos.</p>
<p><code class="docutils literal notranslate"><span class="pre">Controle</span> <span class="pre">estat√≠stico</span></code> significa condicionar apenas as informa√ß√µes em uma vari√°vel e verificar se existe alguma informa√ß√£o valiosa!</p>
<p>Mas, para <code class="docutils literal notranslate"><span class="pre">interpretar</span> <span class="pre">o</span> <span class="pre">efeito</span></code> o efeito que acontece apartir desses controles √© necess√°rio um framework, ou seja, uma estrutura adequada tal como os <em>DAGs</em> ou qualquer outra coisa. Iremos ver exemplos que ao controlar algo estamos na verdade criando um <code class="docutils literal notranslate"><span class="pre">confound</span></code> (<em>uma confus√£o</em>). Podemos criar confound tanto quanto remov√™-los, nesse caso iremos remover achando que iremos ter uma resposta certa, mais tarde.</p>
<ul class="simple">
<li><p><strong>Regress√£o linear m√∫ltipla responde a quest√£o</strong>: O qu√£o cada preditor est√° associado com o resultado, uma vez que conhecemos TODOS os outros preditores?</p></li>
<li><p>Usamos modelo para construir a sa√≠da esperada - <em>n√£o m√°gica!</em></p></li>
<li><p>N√£o ser arrogante: A <em>taxa de casamento</em> ainda pode estar associada com a <em>taxa de div√≥rcio</em> para algum  subconjunto de estados.</p></li>
<li><p>N√£o podemos fazer uma forte infer√™ncia causal apenas com as m√©dias, √© preciso os dados indiv√≠duais.</p></li>
</ul>
</div>
<div class="section" id="graficos-contrafactuais">
<h2>Gr√°ficos contrafactuais<a class="headerlink" href="#graficos-contrafactuais" title="Permalink to this headline">¬∂</a></h2>
<p>Os gr√°fico contrafactuais s√£o mostrados quando mantemos todas as vari√°veis fixas e manipulamos apeans uma vari√°vel de interesse. Assim, veremos a linha de regress√£o mudando seu comportamento.</p>
<p>O objetivo √© explorar as implica√ß√µes dos resultados do modelo.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- Fixar os outros preditores

- Calcular a predi√ß√£o atrav√©s do valor dos preditores
</pre></div>
</div>
<p>Nos gr√°ficos vemos como o modelo v√™ as coisa internamente, ou seja, como ele v√™ as rela√ß√µes preditivas, assumindo que podemos brincar de Deus e definir os valores preditos para qualquer rela√ß√£o. Claro, qualquer rela√ß√£o que n√£o esteja no mundo real.</p>
<p>Manipular uma dessas vari√°veis tamb√©m ir√° manipular os valores das outras vari√°veis. Assim, se manipularmos a <code class="docutils literal notranslate"><span class="pre">idade</span> <span class="pre">mediada</span> <span class="pre">dos</span> <span class="pre">casamentos</span></code> tamb√©m estaremos manipulando a <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamento</span></code>. Por√©m o contr√°rio n√£o √© verdadeiro.</p>
<p>Com esses gr√°ficos podemos definir qualquer valor que goste e ver como o modelo ir√° reagir a essa altera√ß√£o. Isso √© muito √∫til para saber o acontece no modelo, mas isso ainda <code class="docutils literal notranslate"><span class="pre">n√£o</span> <span class="pre">√©</span> <span class="pre">inferencia</span> <span class="pre">causal</span></code>.</p>
</div>
<div class="section" id="checagem-da-predicao-da-posteriori">
<h2>Checagem da predi√ß√£o da posteriori<a class="headerlink" href="#checagem-da-predicao-da-posteriori" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li><p><strong>Objetivo</strong>: Calcular as predi√ß√µes implic√≠ta para os casos observados.</p>
<ul>
<li><p>Checar o ajuste do modelo - golems podem cometer erros.</p></li>
<li><p>Encontrar falhas na modelagem, estimular novas ideias.</p></li>
</ul>
</li>
</ul>
<p>Para saber a aproxima√ß√£o da posteriori funcionou corretamente. As vezes os ajustes da posteriori nos diram que o ajuste est√° muito ruim entre as <code class="docutils literal notranslate"><span class="pre">previs√µes</span> <span class="pre">posteriores</span> <span class="pre">do</span> <span class="pre">modelo</span></code> e os <code class="docutils literal notranslate"><span class="pre">dados</span> <span class="pre">brutos</span></code>. Isso que iremos fazer, comparar esses dois conjuntos de dados, se forem semelhantes, n√≥s podemos ter errado algo, nosso computador pode ter errado algo ou ambos.</p>
<p>Precisamos rever e ajustar, as estimativas dos modelos podem estar erradas pois as vezes a natureza do modelo √© complicada deixando um ambiente hostil para vida humana e temos que lutar para existir, lutando contra a entropia.</p>
<hr class="docutils" />
<ul class="simple">
<li><p>Sempre sobre a m√©dia da distribui√ß√£o posteriori.</p>
<ul>
<li><p>Usar apenas a m√©dia da posteriori nos leva a excesso de confian√ßa.</p></li>
<li><p>Abra√ßar a incerteza.</p></li>
</ul>
</li>
</ul>
<p>A outra coisa que podemos fazer √© olhar para os casos que n√£o se encaixam muito bem e tentar descobrir como fazer infer√™ncias causais mais robustas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_comparative_obseved_posteriori</span><span class="p">():</span>
    <span class="n">list_compared</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Para ficar parecido com os resutados da aula, usar o credible_mass menor que 0.68 (muito demorado!)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
        <span class="n">predict_divorce</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">alpha_check</span> <span class="o">+</span> <span class="n">beta_M_check</span> <span class="o">*</span> <span class="n">M_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_A_check</span> <span class="o">*</span> <span class="n">A_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma_check</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">hpdi</span> <span class="o">=</span> <span class="n">HPDI</span><span class="p">(</span><span class="n">predict_divorce</span><span class="p">,</span> <span class="n">credible_mass</span><span class="o">=</span><span class="mf">0.89</span><span class="p">)</span>
        <span class="n">mean_posteriori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predict_divorce</span><span class="p">)</span>
        <span class="n">list_compared</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">D_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mean_posteriori</span><span class="p">,</span> <span class="n">hpdi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hpdi</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    
    <span class="n">list_compared</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_compared</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">,</span> <span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="s1">&#39;HPDI_min&#39;</span><span class="p">,</span> <span class="s1">&#39;HPDI_max&#39;</span><span class="p">])</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    
    <span class="c1"># Plot mean</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">list_compared</span><span class="o">.</span><span class="n">Observed</span><span class="p">,</span> <span class="n">list_compared</span><span class="o">.</span><span class="n">Predicted</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_compared</span><span class="p">)):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">list_compared</span><span class="o">.</span><span class="n">Observed</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">list_compared</span><span class="o">.</span><span class="n">Observed</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>  
                 <span class="p">[</span><span class="n">list_compared</span><span class="o">.</span><span class="n">HPDI_min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">list_compared</span><span class="o">.</span><span class="n">HPDI_max</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                 <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Valores da predi√ß√£o comparada com o observado&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Div√≥rcio Observado&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Div√≥rcio Predito&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    
<span class="n">plot_comparative_obseved_posteriori</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_90_0.png" src="_images/parte_5_90_0.png" />
</div>
</div>
<p>O gr√°fico acima ir√° comparar os valores preditos contidos na posteriori com os valores observados. Para cada um dos estados, calculamos o intervalo de <span class="math notranslate nohighlight">\(89\%\)</span> de credibilidade (HPDI) e sua m√©dia.</p>
<p>A linha tracejada √© a identidade. Para estados que tem a m√©dia em cima da linha, temos um ajuste perfeito. J√° para estados longe dessa linha, como o estado ID (<a class="reference external" href="https://pt.wikipedia.org/wiki/Idaho">Idaho</a>) o valor predito falha!</p>
<p>Uma das poss√≠veis explica√ß√µes do porque estamos prevendo altos valores na taxa de div√≥ricos em um estado que temos como evid√™ncia uma taxa bem mais baixa √©, a grande presen√ßa de frequentadores da <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">Igreja</span> <span class="pre">de</span> <span class="pre">Jesus</span> <span class="pre">Cristo</span> <span class="pre">dos</span> <span class="pre">Santos</span> <span class="pre">dos</span> <span class="pre">√öltimos</span> <span class="pre">Dias</span></code>, conhecidos como os <a class="reference external" href="https://pt.wikipedia.org/wiki/Idaho#/media/Ficheiro:Idaho_Falls_Temple.jpg">M√≥rmons</a>. Casamentos de pessoas dessa religi√£o tendem a serem mais duradouros por seus motivos religiosos.</p>
<p>Mas para outros estados que est√£o mal ajustados, √© necess√°rio olhar mais de perto e entender melhor o que est√° acontecendo.</p>
</div>
<div class="section" id="associacoes-mascaradas">
<h2>Associa√ß√µes Mascaradas<a class="headerlink" href="#associacoes-mascaradas" title="Permalink to this headline">¬∂</a></h2>
<p>Vamos ver outra coisa interessante que a regress√£o pode fazer. Uma delas √© conseguir revelar as <code class="docutils literal notranslate"><span class="pre">correla√ß√µes</span> <span class="pre">esp√∫rias</span></code>, como acabamos de ver na sess√£o anterior, com a estratifica√ß√£o dos controles estat√≠sticos.</p>
<p>Outra coisa interessante √© a de que quando temos 2 preditores influenciando na vari√°vel resposta, cada em diferentes dire√ß√µes, eles acabam mascarando um ao outro. Precisamos saber qual o real efeito total da causalidade, chamamos isso de <code class="docutils literal notranslate"><span class="pre">associa√ß√£o</span> <span class="pre">mascarada</span></code>.</p>
<ul class="simple">
<li><p>As vezes a associa√ß√£o entre o resultado e o preditor pode ser mascarada por uma outra vari√°vel.</p></li>
<li><p>Necessitamos de ambos preditores para ver a sua influ√™ncia causal.</p></li>
<li><p>Tende a surgir quando:</p>
<ul>
<li><p>Outro preditor associado com a resposta que atua na dire√ß√£o oposta.</p></li>
<li><p>Ambos os preditores tem uma associa√ß√£o entre si.</p></li>
</ul>
</li>
</ul>
<p>E como consequ√™ncia, na natureza eles escondem o efeito um dos outros. E, se n√£o medirmos ambos, podemos ser levados a acreditar que nenhum dele importa tanto quando realmente importam.</p>
<ul class="simple">
<li><p>Ru√≠do nos preditores tamb√©m poder√° mascarar a associa√ß√£o (<em>residuals confounding</em>).</p></li>
</ul>
<p>Outro tipo de associa√ß√£o mascarada √© quando ocorre que nossas medidas cont√©m muitos erros, assim podemos n√£o ver qual o efeito real que est√° acontecendo.</p>
</div>
<div class="section" id="milk-and-brain">
<h2>Milk and Brain<a class="headerlink" href="#milk-and-brain" title="Permalink to this headline">¬∂</a></h2>
<img alt="Milk and Brain" src="_images/milk_brain.png" />
<hr class="docutils" />
<p>Dados pode ser encontrado <a class="reference external" href="https://github.com/rmcelreath/rethinking/blob/master/data/milk.csv">aqui</a></p>
<p>Na imagem acima temos tr√™s primatas, um l√™mure e dois macacos.
Estamos interessado, com esse conjunto de dados, em saber a associa√ß√£o que existe entre a <code class="docutils literal notranslate"><span class="pre">energia</span> <span class="pre">do</span> <span class="pre">leite</span></code> (<span class="math notranslate nohighlight">\(\frac{Kcal}{gramas}\)</span>), qu√£o energ√©tico √© o leite que chegam aos seus filhotes e <code class="docutils literal notranslate"><span class="pre">qu√£o</span> <span class="pre">inteligente</span></code> (<span class="math notranslate nohighlight">\(\%\)</span> <em>neocortex</em>) cada primata √©, usando como particular m√©todo de metrifica√ß√£o de intelig√™ncia, qual o percentual do neocortex em rela√ß√£o a todo o c√©rebro).</p>
<p>Uma das hip√≥tese que temos √© que, para primatas que sejam mais inteligentes, √© necess√°rio maior quantidade de energia no leite materno.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =======================</span>
<span class="c1">#  Milk and Brain - Data</span>
<span class="c1"># =======================</span>
<span class="n">milk_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/milk.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">milk_full</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>clade</th>
      <th>species</th>
      <th>kcal.per.g</th>
      <th>perc.fat</th>
      <th>perc.protein</th>
      <th>perc.lactose</th>
      <th>mass</th>
      <th>neocortex.perc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Strepsirrhine</td>
      <td>Eulemur fulvus</td>
      <td>0.49</td>
      <td>16.60</td>
      <td>15.42</td>
      <td>67.98</td>
      <td>1.95</td>
      <td>55.16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Strepsirrhine</td>
      <td>E macaco</td>
      <td>0.51</td>
      <td>19.27</td>
      <td>16.91</td>
      <td>63.82</td>
      <td>2.09</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Strepsirrhine</td>
      <td>E mongoz</td>
      <td>0.46</td>
      <td>14.11</td>
      <td>16.85</td>
      <td>69.04</td>
      <td>2.51</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Strepsirrhine</td>
      <td>E rubriventer</td>
      <td>0.48</td>
      <td>14.91</td>
      <td>13.18</td>
      <td>71.91</td>
      <td>1.62</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Strepsirrhine</td>
      <td>Lemur catta</td>
      <td>0.60</td>
      <td>27.28</td>
      <td>19.50</td>
      <td>53.22</td>
      <td>2.19</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>New World Monkey</td>
      <td>Alouatta seniculus</td>
      <td>0.47</td>
      <td>21.22</td>
      <td>23.58</td>
      <td>55.20</td>
      <td>5.25</td>
      <td>64.54</td>
    </tr>
    <tr>
      <th>6</th>
      <td>New World Monkey</td>
      <td>A palliata</td>
      <td>0.56</td>
      <td>29.66</td>
      <td>23.46</td>
      <td>46.88</td>
      <td>5.37</td>
      <td>64.54</td>
    </tr>
    <tr>
      <th>7</th>
      <td>New World Monkey</td>
      <td>Cebus apella</td>
      <td>0.89</td>
      <td>53.41</td>
      <td>15.80</td>
      <td>30.79</td>
      <td>2.51</td>
      <td>67.64</td>
    </tr>
    <tr>
      <th>8</th>
      <td>New World Monkey</td>
      <td>Saimiri boliviensis</td>
      <td>0.91</td>
      <td>46.08</td>
      <td>23.34</td>
      <td>30.58</td>
      <td>0.71</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>New World Monkey</td>
      <td>S sciureus</td>
      <td>0.92</td>
      <td>50.58</td>
      <td>22.33</td>
      <td>27.09</td>
      <td>0.68</td>
      <td>68.85</td>
    </tr>
    <tr>
      <th>10</th>
      <td>New World Monkey</td>
      <td>Cebuella pygmaea</td>
      <td>0.80</td>
      <td>41.35</td>
      <td>20.85</td>
      <td>37.80</td>
      <td>0.12</td>
      <td>58.85</td>
    </tr>
    <tr>
      <th>11</th>
      <td>New World Monkey</td>
      <td>Callimico goeldii</td>
      <td>0.46</td>
      <td>3.93</td>
      <td>25.30</td>
      <td>70.77</td>
      <td>0.47</td>
      <td>61.69</td>
    </tr>
    <tr>
      <th>12</th>
      <td>New World Monkey</td>
      <td>Callithrix jacchus</td>
      <td>0.71</td>
      <td>38.38</td>
      <td>20.09</td>
      <td>41.53</td>
      <td>0.32</td>
      <td>60.32</td>
    </tr>
    <tr>
      <th>13</th>
      <td>New World Monkey</td>
      <td>Leontopithecus rosalia</td>
      <td>0.71</td>
      <td>36.90</td>
      <td>21.27</td>
      <td>41.83</td>
      <td>0.60</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Old World Monkey</td>
      <td>Chlorocebus pygerythrus</td>
      <td>0.73</td>
      <td>39.17</td>
      <td>14.65</td>
      <td>46.18</td>
      <td>3.47</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Old World Monkey</td>
      <td>Miopithecus talpoin</td>
      <td>0.68</td>
      <td>40.15</td>
      <td>18.08</td>
      <td>41.77</td>
      <td>1.55</td>
      <td>69.97</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Old World Monkey</td>
      <td>M fuscata</td>
      <td>0.72</td>
      <td>53.05</td>
      <td>13.00</td>
      <td>33.95</td>
      <td>7.08</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Old World Monkey</td>
      <td>M mulatta</td>
      <td>0.97</td>
      <td>55.51</td>
      <td>13.17</td>
      <td>31.32</td>
      <td>3.24</td>
      <td>70.41</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Old World Monkey</td>
      <td>M sinica</td>
      <td>0.79</td>
      <td>48.90</td>
      <td>13.91</td>
      <td>37.19</td>
      <td>7.94</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Old World Monkey</td>
      <td>Papio spp</td>
      <td>0.84</td>
      <td>54.31</td>
      <td>10.97</td>
      <td>34.72</td>
      <td>12.30</td>
      <td>73.40</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Ape</td>
      <td>Nomascus concolor</td>
      <td>0.48</td>
      <td>15.96</td>
      <td>12.52</td>
      <td>71.52</td>
      <td>7.59</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Ape</td>
      <td>Hylobates lar</td>
      <td>0.62</td>
      <td>34.51</td>
      <td>12.57</td>
      <td>52.92</td>
      <td>5.37</td>
      <td>67.53</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Ape</td>
      <td>Symphalangus syndactylus</td>
      <td>0.51</td>
      <td>26.42</td>
      <td>13.46</td>
      <td>60.12</td>
      <td>10.72</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ape</td>
      <td>Pongo pygmaeus</td>
      <td>0.54</td>
      <td>37.78</td>
      <td>7.37</td>
      <td>54.85</td>
      <td>35.48</td>
      <td>71.26</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Ape</td>
      <td>Gorilla gorilla gorilla</td>
      <td>0.49</td>
      <td>27.18</td>
      <td>16.29</td>
      <td>56.53</td>
      <td>79.43</td>
      <td>72.60</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Ape</td>
      <td>G gorilla beringei</td>
      <td>0.53</td>
      <td>30.59</td>
      <td>20.77</td>
      <td>48.64</td>
      <td>97.72</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Ape</td>
      <td>Pan paniscus</td>
      <td>0.48</td>
      <td>21.18</td>
      <td>11.68</td>
      <td>67.14</td>
      <td>40.74</td>
      <td>70.24</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Ape</td>
      <td>P troglodytes</td>
      <td>0.55</td>
      <td>36.84</td>
      <td>9.54</td>
      <td>53.62</td>
      <td>33.11</td>
      <td>76.30</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Ape</td>
      <td>Homo sapiens</td>
      <td>0.71</td>
      <td>50.49</td>
      <td>9.84</td>
      <td>39.67</td>
      <td>54.95</td>
      <td>75.49</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ================</span>
<span class="c1">#   Descri√ß√µes</span>
<span class="c1"># ================</span>

<span class="n">milk_full</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>kcal.per.g</th>
      <th>perc.fat</th>
      <th>perc.protein</th>
      <th>perc.lactose</th>
      <th>mass</th>
      <th>neocortex.perc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>29.000000</td>
      <td>29.000000</td>
      <td>29.000000</td>
      <td>29.000000</td>
      <td>29.000000</td>
      <td>17.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.641724</td>
      <td>33.990345</td>
      <td>16.403448</td>
      <td>49.606207</td>
      <td>14.726897</td>
      <td>67.575882</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.161402</td>
      <td>14.286670</td>
      <td>4.846878</td>
      <td>14.055174</td>
      <td>24.770469</td>
      <td>5.968612</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.460000</td>
      <td>3.930000</td>
      <td>7.370000</td>
      <td>27.090000</td>
      <td>0.120000</td>
      <td>55.160000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.490000</td>
      <td>21.220000</td>
      <td>13.000000</td>
      <td>37.800000</td>
      <td>1.620000</td>
      <td>64.540000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.600000</td>
      <td>36.840000</td>
      <td>15.800000</td>
      <td>48.640000</td>
      <td>3.470000</td>
      <td>68.850000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.730000</td>
      <td>46.080000</td>
      <td>20.770000</td>
      <td>60.120000</td>
      <td>10.720000</td>
      <td>71.260000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.970000</td>
      <td>55.510000</td>
      <td>25.300000</td>
      <td>71.910000</td>
      <td>97.720000</td>
      <td>76.300000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================</span>
<span class="c1">#  Filtrando os dados </span>
<span class="c1"># =====================</span>

<span class="n">milk</span> <span class="o">=</span> <span class="n">milk_full</span><span class="p">[[</span><span class="s1">&#39;kcal.per.g&#39;</span><span class="p">,</span> <span class="s1">&#39;neocortex.perc&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">milk</span><span class="p">[</span><span class="s1">&#39;log(mass)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">milk_full</span><span class="p">[[</span><span class="s1">&#39;mass&#39;</span><span class="p">]])</span>
<span class="n">milk</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>kcal.per.g</th>
      <th>neocortex.perc</th>
      <th>log(mass)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.49</td>
      <td>55.16</td>
      <td>0.667829</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.51</td>
      <td>NaN</td>
      <td>0.737164</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.46</td>
      <td>NaN</td>
      <td>0.920283</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.48</td>
      <td>NaN</td>
      <td>0.482426</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.60</td>
      <td>NaN</td>
      <td>0.783902</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================</span>
<span class="c1">#  Leite dos Primatas</span>
<span class="c1"># =====================</span>

<span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">milk</span><span class="p">[[</span><span class="s1">&#39;kcal.per.g&#39;</span><span class="p">,</span> <span class="s1">&#39;log(mass)&#39;</span><span class="p">,</span> <span class="s1">&#39;neocortex.perc&#39;</span><span class="p">]],</span> 
                           <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                           <span class="n">hist_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bins&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;rwidth&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span> 
                           <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_100_0.png" src="_images/parte_5_100_0.png" />
</div>
</div>
<p>O que vemos aqui √© uma forte correla√ß√£o positiva entre o  <span class="math notranslate nohighlight">\(\%\)</span> <em>neocortex</em> e a magnetude da massa. Ou seja, quanto mais massa o primata tiver, maior tamb√©m ser√° o percentual do seu cortex, e n√£o apenas o c√©rebro como um todo.</p>
<p>A seguir vamos fazer a regress√£o entre essas duas vari√°veis.</p>
<p>52:51</p>
<p>No pr√≥ximo cap√≠tulo, iremos descrever apenas os c√≥digos.</p>
<p>Comecei a ler o livro do in√≠cio e todas as explica√ß√µes a seguir podem ser encontradas no pr√≥prio livro.</p>
<p>Como dito anteriormente, esse material ir√° fornecer todos os c√≥digos em linguagem <span class="math notranslate nohighlight">\(Python3\)</span> usando diretamente  a biblioteca <span class="math notranslate nohighlight">\(Stan\)</span> em conjunto com a wrapper <span class="math notranslate nohighlight">\(PyStan\)</span>.</p>
<p>Para usu√°rios do <span class="math notranslate nohighlight">\(R\)</span>, exite um Wrapper para <span class="math notranslate nohighlight">\(RStan\)</span> para uma poss√≠vel codifica√ß√£o sem utilizar a biblioteca <span class="math notranslate nohighlight">\(Rethinking\)</span> do pr√≥prio livro.</p>
<hr class="docutils" />
<p>D√∫vidas ou sugest√µes acesse a parte inicial desse material para entrar em contato.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="parte_4.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">4 - Fun√ß√µes Wiggly</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="parte_6.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">6 - Os DAGs assombrados &amp; O Terror Causal</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Rodolpho Macedo dos Santos<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>