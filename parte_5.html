
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5 - Muitas Variáveis e os Waffles Espúrios &#8212; Statistical Rethinking</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="4 - Funções Wiggly" href="parte_4.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Statistical Rethinking</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="capa.html">
   Estatistica Bayesiana
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro_pt-BR.html">
   Intro - Estatística Bayesiana (🇧🇷)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_en.html">
   Intro - Bayesian Statistics (🇺🇸)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_1.html">
   1- Introdução
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_2.html">
   2 - Engenharia de Golems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_3.html">
   3- Modelos Geocêntricos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_4.html">
   4 - Funções Wiggly
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   5 - Muitas Variáveis e os Waffles Espúrios
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/parte_5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR/issues/new?title=Issue%20on%20page%20%2Fparte_5.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/rodolphomacedo/statistical_rethinking_pt_BR/main?urlpath=tree/parte_5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   5 - Muitas Variáveis e os Waffles Espúrios
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#correlacoes-espurias">
   Correlações Espúrias
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regressao-multiplas">
   Regressão Múltiplas
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pros-e-contras-das-multiplas-variaveis">
     Prós e contras das múltiplas variáveis:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiplas-causas-de-divorcios">
     Múltiplas causas de divórcios
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#entendendo-os-grafos-um-pouco-mais-perto">
     Entendendo os grafos um pouco mais perto.
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bons-grafos">
     Bons Grafos
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prioris">
     Prioris
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nosso-modelo">
     Nosso modelo
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#regressao-multipla">
       Regressão Múltipla
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Regressão Múltipla
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="muitas-variaveis-e-os-waffles-espurios">
<h1>5 - Muitas Variáveis e os Waffles Espúrios<a class="headerlink" href="#muitas-variaveis-e-os-waffles-espurios" title="Permalink to this headline">¶</a></h1>
<p>Nosso objetivo nessa parte é começar o processo da construção de modelos de regressões múltiplas e, assim, também começaremos a criar as bases para o <code class="docutils literal notranslate"><span class="pre">framework</span> <span class="pre">de</span> <span class="pre">inferências</span> <span class="pre">causais</span></code>.</p>
<p>Para iniciarmos a discussão iremos introduzir um exemplo empírico, ou seja, um exemplo baseado na experiência e observações, sejam elas baseadas em algum método (<em>metódicas</em>) ou não.</p>
<a class="reference internal image-reference" href="_images/waffle_house.jpeg"><img alt="Waffle House" src="_images/waffle_house.jpeg" style="width: 1000px;" /></a>
<p><a class="reference external" href="https://br.linkedin.com/company/waffle-house">Fonte</a></p>
<p><a class="reference external" href="https://www.youtube.com/watch?v=e0tO64mtYMU">Aula - Statistical Rethinking Winter 2019 Lecture 05</a></p>
<p>A <em>waffle house</em> é uma cadeia de restaurantes com mais de <span class="math notranslate nohighlight">\(2000\)</span> locais em <span class="math notranslate nohighlight">\(25\)</span> estados nos EUA (mapa amarelo abaixo). A maioria das suas localizações está no Sul do país e é um item da cultural e regional norte americana. (<em><a class="reference external" href="https://en.wikipedia.org/wiki/Waffle_House">wikipedia</a></em>). Uma das particularidades dessa rede de restaurantes é que eles trabalham 24 horas. Nunca fecham! Essa é a proposta de negócio deles.</p>
<p>Um outro fato importante e desagradável que se surge no sul dos EUA são os <em>Furacões</em>. Esses são causados pelas depressões tropicais climáticas do pais. Os restaurantes da rede Waffles são um dos únicos estabelecimentos que continuam abertos nesses períodos turbulentos. <em>Exceto quando esses furacões atingem uma de suas lojas.</em></p>
<p>A rede é tão confiável que governadores dos EUA criaram o <code class="docutils literal notranslate"><span class="pre">waffle</span> <span class="pre">house</span> <span class="pre">index</span></code>, internamente na FEMA (<em>agência federal de gestão de emergências</em>). Usada como uma métrica informal com o nome da rede de restaurantes, pretendem  determinar o efeito das tempestades, como uma escala auxíliar para o planejamento de recuperação de um desastre. (<em><a class="reference external" href="https://en.wikipedia.org/wiki/Waffle_House_Index">waffle house index</a></em>)</p>
<a class="reference internal image-reference" href="_images/WH_per_people.png"><img alt="waffle house map" src="_images/WH_per_people.png" style="width: 900px;" /></a>
<p>Imagem - <a class="reference external" href="https://www.scottareynhout.com/blog/2017/10/7/waffle-house-map">https://www.scottareynhout.com/blog/2017/10/7/waffle-house-map</a></p>
<p>Além dos desastres naturais, existem também muitas outras coisas acontecendo em grande escala no sul dos EUA, tal como <strong>divórcios</strong>!</p>
<p>No gráfico abaixo temos a indicação da quantidade de divórcios nos EUA. Observe o sul do país e compare com o mapa acima.</p>
<a class="reference internal image-reference" href="_images/WH_per_divorce.png"><img alt="Waffle House contry-level-marriage-divorce-data-2010" src="_images/WH_per_divorce.png" style="width: 900px;" /></a>
<p>Imagem - <a class="reference external" href="https://www.bgsu.edu/ncfmr/resources/data/original-data/county-level-marriage-divorce-data-2010.html">https://www.bgsu.edu/ncfmr/resources/data/original-data/county-level-marriage-divorce-data-2010.html</a></p>
<p>Percebeu?</p>
<p>Em ambos os mapas existem uma grande concentração, no extremo do sul do mapa, de restaurantes da rede Waffle House e, subindo mais ao norte do país, temos quantidades cada vez menores. O mesmo ocorre no mapa das <em>taxas de divórcios</em>, quando olhamos para os mesmos locais no mapa.</p>
<p>Podemos então fazer uma estimativa: <code class="docutils literal notranslate"><span class="pre">esses</span> <span class="pre">dados</span> <span class="pre">estão</span> <span class="pre">correlacionados</span> <span class="pre">entre</span> <span class="pre">si</span></code>. E podemos nos ser levados a pensar que quanto maior a concentração de restaurantes na região maior seria seria a taxa de divórcios.</p>
<p>E por que isso acontece?</p>
<p>Pelo seguinte motivo: <code class="docutils literal notranslate"><span class="pre">Por</span> <span class="pre">nada</span></code>!</p>
<p>Isso mesmo, nada!!!</p>
<p>Não existe nada que tenha uma relação direta na qual a quantidade de restaurantes da rede em alguma determinada região influencie casais a brigarem e tomarem a decisão de se separar!</p>
<p>É estranho. É cômico. É intrigante. Isso é uma <code class="docutils literal notranslate"><span class="pre">Correlação</span> <span class="pre">Espúria</span></code>!</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="correlacoes-espurias">
<h1>Correlações Espúrias<a class="headerlink" href="#correlacoes-espurias" title="Permalink to this headline">¶</a></h1>
<p>Essas são as <code class="docutils literal notranslate"><span class="pre">correlações</span> <span class="pre">espúrias</span></code>, ou seja, <code class="docutils literal notranslate"><span class="pre">correlações</span> <span class="pre">sem</span> <span class="pre">certeza</span></code>; que não é verdadeira nem real; é hipotética!</p>
<p>Muita coisa está relacionada com as outras no mundo real. <code class="docutils literal notranslate"><span class="pre">Isso</span> <span class="pre">é</span> <span class="pre">a</span> <span class="pre">Natureza</span></code>!</p>
<p>Por exemplo, se quisermos, por qualquer motivo que seja, arrumar um “argumento” para enfraquecer a imagem da rede Waffle House, “podemos” usar essas correlações espúrias com um dos argumentos. Assim, nós iriamos expor na mídia a seguinte manchete:</p>
<div class="admonition-breaking-news admonition">
<p class="admonition-title">Breaking News:</p>
<p>Pesquisadores [da universidade xyz] indicam que: o aumento do número de restaurantes da rede Waffle House
na região implica num aumento assustador no número de divórcios nessa mesma região!</p>
</div>
<p>Isso soa estranho, eu sei! Esse é apenas um exemplo extremo.</p>
<p>Mas, lá no fundo, esse tipo de pensamento não soa tão estranho no dia-a-dia…</p>
<p>Existem diversas correlações espúrias no mundo. Muita coisa tem correlação com muitas outras coisas.</p>
<div class="admonition-entretanto admonition">
<p class="admonition-title">Entretanto:</p>
<p>Essas correlações não implicam causalidade.</p>
</div>
<p>Mas para entendermos melhor, vamos ver mais alguns exemplos sobre essas correlações espúrias:</p>
<ul class="simple">
<li><p>O consumo de queijo tem uma correlação de <span class="math notranslate nohighlight">\(94.7\%\)</span> com os acidentes fatais com o emaranhado do lençol de cama.</p></li>
<li><p>O consumo per capita de frango apresenta uma correlação de <span class="math notranslate nohighlight">\(89\%\)</span> com a importação de petróleo.</p></li>
<li><p>Os acidentes por afogamentos em piscina tem a correlação de <span class="math notranslate nohighlight">\(66\%\)</span> com o número de filmes lançados pelo Nicolas Cage, por ano. Veja graficamente essa correlação abaixo:</p></li>
</ul>
<a class="reference internal image-reference" href="_images/chart.jpeg"><img alt="Tyler Vigen spurious correlations" src="_images/chart.jpeg" style="width: 1000px;" /></a>
<p>Percebeu?</p>
<p>Se o consumo de frango diminuísse, a importação provavelmente não sofreria nenhum impacto por essa causa. E, caso o consumo de queijo diminuir, também não haverá uma diminuição nos acidentes fatais das pessoas que estão dormindo em suas camas. E, como é esperado, se o Nicolas Cage se aposentar dos cinemas, os acidentes por afogamento continuarão constantes.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Correlação não implica causalidade!</p>
</div>
<p>Por fim, ter mais lojas da rede Waffle House não <code class="docutils literal notranslate"><span class="pre">causa</span></code> mais divórcios na região.</p>
<hr class="docutils" />
<p>Mais correlações espúrias, tais como essas acima, podem ser encontradas no site do <a class="reference external" href="https://www.tylervigen.com/spurious-correlations">Tyler Vigen</a>.</p>
<hr class="docutils" />
<p>Entendido essa parte, vamos ao objetivo desse capítulo.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="regressao-multiplas">
<h1>Regressão Múltiplas<a class="headerlink" href="#regressao-multiplas" title="Permalink to this headline">¶</a></h1>
<p>Vamos ver como construir um modelo de regressão linear novamente. Mas dessa vez iremos ver também como se faz com  <code class="docutils literal notranslate"><span class="pre">múltiplas</span> <span class="pre">variáveis</span></code> e quais são suas implicações.</p>
<div class="section" id="pros-e-contras-das-multiplas-variaveis">
<h2>Prós e contras das múltiplas variáveis:<a class="headerlink" href="#pros-e-contras-das-multiplas-variaveis" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>A parte boa desse tipo de modelo é que as regressões múltiplas podem não só revelar correlações espúrias como também podem revelar associações escondidas que nós não faríamos normalmente, ou seja, não teríamos visto essas associações usando o modelo com uma simples variável preditora.</p></li>
<li><p>Mas, por outro lado, podemos também adicionar variáveis explicativas aos modelos que contenham correlações espúrias à regressão múltipla e, podem também, esconder as algumas das reais associações que existem.</p></li>
</ul>
<p>Então, como essas coisas geralmente não são bem explicadas, vamos detalhar todo o processo de construção de uma regressão múltipla, a seguir.</p>
<p>Quando construímos um modelo usando uma regressão múltipla, nós devemos ter uma estrutura mais profusa para pensar sobre as nossas decisões. Apenas <em>jogar</em> todas as variáveis explicativas dentro da regressão múltipla, como usualmente é feito, é o segredo para o fracasso da análise e nós não queremos fazer isso!</p>
<p>Para isso precisamos de uma estrutura mais ampla e rica para conseguirmos pensar e tomar melhores decisões. Essa estrutura é o <code class="docutils literal notranslate"><span class="pre">framework</span> <span class="pre">de</span> <span class="pre">inferência</span> <span class="pre">casual</span></code>.</p>
<p>Nessa parte iremos aprender do básico sobre inferência casual:</p>
<ul class="simple">
<li><p>Grafos acíclicos direcionados (DAGs - <em>Directed acyclic graphs</em>)</p></li>
<li><p>Fork, pipes, colliders…</p></li>
<li><p>Critério de Backdoor.</p></li>
</ul>
<p>Já sabemos que o Waffle House não causa os divórcios. Mas o que causa os divórcios?</p>
<p>Já vimos no mapa acima que divórcios do sul do país tem uma taxa bem mais alta do que no restante mais ao norte. Existem muitos esforços para tentar identificar as causas e as taxas de divórcios. Sabemos que no sul tem uma predominância religiosa quando comparada ao restante do país. Isso deixa os cientistas com certas desconfianças.</p>
<p>Existem assim muitas coisas que estão correlacionadas com a taxa de divórcios. Uma delas é a <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamentos</span></code>. Também podemos usar essas informações para cada um dos outros <span class="math notranslate nohighlight">\(50\)</span> estados do país. Todos eles têm uma <code class="docutils literal notranslate"><span class="pre">correlação</span> <span class="pre">positiva</span></code> da taxa de casamentos com a taxa de divórcios.</p>
<p>Um ponto importante nessa correlação é que <em>só pode acontecer um divórcio se houver o casamento</em>!</p>
<p>Mas a correlação entre essas taxas podem ser também <code class="docutils literal notranslate"><span class="pre">correlações</span> <span class="pre">espúrias</span></code>. Assim como a correlação entre homicídos e divórcios são uma correlação espúria.</p>
<p>Pois uma taxa alta de casamentos pode indicar que a sociedade vê o casamento de modo favorável e isso pode significar taxas de divórcios mais baixas. Não necessariamente faz sentido, mas pode ser que as taxas de casamentos e de divórcios sejam correlações espúrias também.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Correlação não implica Causalidade</p></li>
<li><p>Causalidade não implica Correlação</p></li>
<li><p>Causalidade implica em correlação condicional</p></li>
</ul>
</div>
<p>Assim, precisamos mais do que apenas simples modelos! É necessário um estrutura mais robusta.</p>
<p>Mas, o que causa os divórcios?</p>
<p>Vamos descobrir isso…</p>
<p>Existe outra variável que também é correlacionada com a variável <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">divórcio</span></code>, é a variável <code class="docutils literal notranslate"><span class="pre">idade</span> <span class="pre">mediana</span> <span class="pre">das</span> <span class="pre">pessoas</span> <span class="pre">que</span> <span class="pre">se</span> <span class="pre">casam,</span> <span class="pre">em</span> <span class="pre">cada</span> <span class="pre">estado</span></code>. Mas diferente da <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamento</span></code>, essa variável apresenta uma <em>correlação negativa</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">stan</span>
<span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definindo o plano de fundo cinza claro para todos os gráficos feitos no matplotlib</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Desbloqueio do asyncIO do jupyter</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">HPDI</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">,</span> <span class="n">credible_mass</span><span class="p">):</span>
    
    <span class="c1"># Calcula o maior intervalo de probabilidades a partir de uma amostra</span>
    
    <span class="c1"># Fonte: https://stackoverflow.com/questions/22284502/highest-posterior-density-region-and-central-credible-region</span>
    <span class="n">sorted_points</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">)</span>
    <span class="n">ciIdxInc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">credible_mass</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_points</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">nCIs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_points</span><span class="p">)</span> <span class="o">-</span> <span class="n">ciIdxInc</span>
    <span class="n">ciWidth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nCIs</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nCIs</span><span class="p">):</span>
        <span class="n">ciWidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">ciIdxInc</span><span class="p">]</span> <span class="o">-</span> <span class="n">sorted_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">HDImin</span> <span class="o">=</span> <span class="n">sorted_points</span><span class="p">[</span><span class="n">ciWidth</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ciWidth</span><span class="p">))]</span>
        <span class="n">HDImax</span> <span class="o">=</span> <span class="n">sorted_points</span><span class="p">[</span><span class="n">ciWidth</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ciWidth</span><span class="p">))</span><span class="o">+</span><span class="n">ciIdxInc</span><span class="p">]</span>

    <span class="k">return</span><span class="p">(</span><span class="n">HDImin</span><span class="p">,</span> <span class="n">HDImax</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ====================================</span>
<span class="c1">#   Lendo os dados da Waffle House</span>
<span class="c1"># ====================================</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/WaffleDivorce.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Location</th>
      <th>Loc</th>
      <th>Population</th>
      <th>MedianAgeMarriage</th>
      <th>Marriage</th>
      <th>Marriage SE</th>
      <th>Divorce</th>
      <th>Divorce SE</th>
      <th>WaffleHouses</th>
      <th>South</th>
      <th>Slaves1860</th>
      <th>Population1860</th>
      <th>PropSlaves1860</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>AL</td>
      <td>4.78</td>
      <td>25.3</td>
      <td>20.2</td>
      <td>1.27</td>
      <td>12.7</td>
      <td>0.79</td>
      <td>128</td>
      <td>1</td>
      <td>435080</td>
      <td>964201</td>
      <td>0.45</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>AK</td>
      <td>0.71</td>
      <td>25.2</td>
      <td>26.0</td>
      <td>2.93</td>
      <td>12.5</td>
      <td>2.05</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>AZ</td>
      <td>6.33</td>
      <td>25.8</td>
      <td>20.3</td>
      <td>0.98</td>
      <td>10.8</td>
      <td>0.74</td>
      <td>18</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>AR</td>
      <td>2.92</td>
      <td>24.3</td>
      <td>26.4</td>
      <td>1.70</td>
      <td>13.5</td>
      <td>1.22</td>
      <td>41</td>
      <td>1</td>
      <td>111115</td>
      <td>435450</td>
      <td>0.26</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>CA</td>
      <td>37.25</td>
      <td>26.8</td>
      <td>19.1</td>
      <td>0.39</td>
      <td>8.0</td>
      <td>0.24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>379994</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ============================================</span>
<span class="c1">#  Plotando os dados das taxas de divórcios</span>
<span class="c1"># ============================================</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Associações Espúrias?&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Casamento&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Divórcio&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Mediana da Idade dos Noivos&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Divórcio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_21_0.png" src="_images/parte_5_21_0.png" />
</div>
</div>
<p>Vamos construir modelos lineares simples para os dois gráficos acima.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================================</span>
<span class="c1">#  Construindo um modelo linear simples:</span>
<span class="c1">#</span>
<span class="c1">#    taxa de divórcio ~ alpha + beta * taxa_casamento</span>
<span class="c1"># ========================================================</span>
<span class="n">divorce_model1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        vector[N] divorce_rate;</span>
<span class="s2">        vector[N] marriage_rate;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    parameters {</span>
<span class="s2">        real alpha;</span>
<span class="s2">        real beta;</span>
<span class="s2">        real&lt;lower=0, upper=50&gt; sigma;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    model {</span>
<span class="s2">        divorce_rate ~ normal(alpha + beta * marriage_rate, sigma);</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">my_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="p">),</span>
    <span class="s1">&#39;marriage_rate&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">&#39;divorce_rate&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">posteriori1</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">divorce_model1</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">my_data</span><span class="p">)</span>
<span class="n">fit1</span> <span class="o">=</span> <span class="n">posteriori1</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">alpha_1</span> <span class="o">=</span> <span class="n">fit1</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_1</span> <span class="o">=</span> <span class="n">fit1</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma_1</span> <span class="o">=</span> <span class="n">fit1</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==============================================================</span>
<span class="c1"># Construindo um modelo linear simples:</span>
<span class="c1">#</span>
<span class="c1">#  taxa divorcio ~ alpha + beta * mediana da idade dos noivos</span>
<span class="c1"># ==============================================================</span>

<span class="n">stan_model2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        vector[N] divorce_rate;</span>
<span class="s2">        vector[N] median_age_marriage;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    parameters {</span>
<span class="s2">        real alpha;</span>
<span class="s2">        real beta;</span>
<span class="s2">        real&lt;lower=0, upper=50&gt; sigma;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    model {</span>
<span class="s2">        divorce_rate ~ normal(alpha + beta * median_age_marriage, sigma);</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">my_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="p">),</span>
    <span class="s1">&#39;divorce_rate&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">&#39;median_age_marriage&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">posteriori2</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">stan_model2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">my_data</span><span class="p">)</span>
<span class="n">fit2</span> <span class="o">=</span> <span class="n">posteriori2</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">alpha_2</span> <span class="o">=</span> <span class="n">fit2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_2</span> <span class="o">=</span> <span class="n">fit2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma_2</span> <span class="o">=</span> <span class="n">fit2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ====================================================================</span>
<span class="c1">#  Plotando os dados das taxas de divórcios e suas estimativas médias</span>
<span class="c1"># ====================================================================</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Associações Espúrias?&#39;</span><span class="p">)</span>

<span class="c1"># Calculando as regiões de HPDI para mu - Taxa de casamentos com 0.92 de credibilidade</span>
<span class="n">range_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="p">)</span>
<span class="n">posteriori_mu_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_1</span> <span class="o">+</span> <span class="n">beta_1</span> <span class="o">*</span> <span class="n">marriage</span> <span class="k">for</span> <span class="n">marriage</span> <span class="ow">in</span> <span class="n">range_mu</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">posteriori_mu_HPDI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">HPDI</span><span class="p">(</span><span class="n">posteriori_marriage</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">)</span> <span class="k">for</span> <span class="n">posteriori_marriage</span> <span class="ow">in</span> <span class="n">posteriori_mu_aux</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Gráfico de Divórcio x Casamento</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">range_mu</span><span class="p">,</span> 
                 <span class="n">posteriori_mu_HPDI</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">posteriori_mu_HPDI</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
         <span class="n">alpha_1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">beta_1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Casamento&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Divórcio&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Correlação Positiva </span><span class="se">\n</span><span class="s1"> Espúria?&#39;</span><span class="p">)</span>

<span class="c1"># ------------</span>

<span class="c1"># Calculando as regiões de HPDI para mu - Mediana para idade de casamentos com 0.92 de credibilidade</span>
<span class="n">range_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="p">)</span>
<span class="n">posteriori_mu_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_2</span> <span class="o">+</span> <span class="n">beta_2</span> <span class="o">*</span> <span class="n">mediaAgeMarriage</span> <span class="k">for</span> <span class="n">mediaAgeMarriage</span> <span class="ow">in</span> <span class="n">range_mu</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">posteriori_mu_HPDI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">HPDI</span><span class="p">(</span><span class="n">posteriori_mediaAgeMarriage</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">)</span> <span class="k">for</span> <span class="n">posteriori_mediaAgeMarriage</span> <span class="ow">in</span> <span class="n">posteriori_mu_aux</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Gráfico de Divórcio x Mediana da Idade dos Casamentos</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">range_mu</span><span class="p">,</span> 
                 <span class="n">posteriori_mu_HPDI</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">posteriori_mu_HPDI</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
         <span class="n">alpha_2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">beta_2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Mediana da Idade dos Noivos&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Taxa de Divórcio&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Correlação Negativa </span><span class="se">\n</span><span class="s1"> Espúria?&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_25_0.png" src="_images/parte_5_25_0.png" />
</div>
</div>
<p>Observando os dois gráficos acima, quais dessas correlações são <code class="docutils literal notranslate"><span class="pre">causas</span> <span class="pre">plausíveis</span></code>?</p>
<p>No gráfico da esquerda, sabemos que a <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamento</span></code> tem uma associação direta com a <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">divórcio</span></code>, pois, para se divorciar é necessário antes ter casado. Mas essa interpretação dos fatos pode estar contaminada pelo nosso senso comum e, assim, uma associação espúria, nos seria válida. Um dos motivos pra isso acontecer é que em locais que possuem maiores incentivos religiosos e podem implicar em maiores incentivos para casamentos, podendo, assim, não haver uma causalidade direta com o divórcio.</p>
<p>Já no gráfico à direita, a <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">divórcio</span></code> está associada com <code class="docutils literal notranslate"><span class="pre">mediana</span> <span class="pre">das</span> <span class="pre">idades</span> <span class="pre">dos</span> <span class="pre">noivos</span></code>, nos apresentando uma associação negativa. Isso pode nos levar a pensar que jovens, ao se casarem, tomam decisões muito emotivas e que isso também levaria a altas taxas de divórcios. Ou pode ser que essa seja uma associação espúria e nossas hipóteses e nosso senso comum não tenha sentido.</p>
<p>Assim, mesmo que nossas justificativas sejam bastante <code class="docutils literal notranslate"><span class="pre">verossímeis</span></code> a respeito do comportamento da Natureza do evento, não podemos afirmar que essas associações não sejam espúrias.</p>
<p>Se a identificação de associações espúrias, como no exemplo de filmes do <em>Nicolas Cage</em>, <code class="docutils literal notranslate"><span class="pre">pareciam</span> <span class="pre">óbvias</span></code> de serem identificadas, agora, essas não parecem ser tão simples de perceber sua veracidade.</p>
<p>Portanto, é necessário construirmos um ferramental que nos permita identificar com mais facilidade e, com um maior grau de certeza, se essas associações são reais ou são espúrias.</p>
<p>O que queremos fazer agora é colocar essas duas variáveis no mesmo modelo e entender o que isso faz e por que nos revela, quase certamente, que determinada variável é uma <code class="docutils literal notranslate"><span class="pre">impostora</span></code>.</p>
</div>
<div class="section" id="multiplas-causas-de-divorcios">
<h2>Múltiplas causas de divórcios<a class="headerlink" href="#multiplas-causas-de-divorcios" title="Permalink to this headline">¶</a></h2>
<img alt="Aprender a taxa casamentos de uma cidade" src="_images/cidade1.jpg" />
<p><a class="reference external" href="https://pt.wikipedia.org/wiki/Cidade#/media/Ficheiro:Hong_Kong_Night_Skyline.jpg">Fonte: <em>Hong Kong - wikipedia</em></a></p>
<p>Como entender o mecanismo das Causas Naturais de divórcio numa cidade grande, por exemplo?</p>
<p>O que nós queremos saber é qual o valor de uma <code class="docutils literal notranslate"><span class="pre">variável</span> <span class="pre">preditora</span></code>, uma vez que nós conhecemos os valores das outras variáveis preditoras corretamente?</p>
<p>Todas variáveis preditoras são ,em alguma extensão, correlacionadas com as outras variáveis preditoras e, também, com a variável resposta. Entretanto, elas têm <code class="docutils literal notranslate"><span class="pre">correlações</span> <span class="pre">parciais</span></code> que são reveladoras de informações adicionais dessa estrutura de correlação.</p>
<p>Para entendermos melhor, vamos exemplificar com nosso exemplo sobre divórcios.</p>
<p>Nós gostariamos de aprender mais sobre o valor da <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamentos</span></code>, uma vez que já conhecemos a <code class="docutils literal notranslate"><span class="pre">mediana</span> <span class="pre">da</span> <span class="pre">idade</span> <span class="pre">da</span> <span class="pre">taxa</span> <span class="pre">dos</span> <span class="pre">noivos</span></code>.</p>
</div>
<div class="section" id="entendendo-os-grafos-um-pouco-mais-perto">
<h2>Entendendo os grafos um pouco mais perto.<a class="headerlink" href="#entendendo-os-grafos-um-pouco-mais-perto" title="Permalink to this headline">¶</a></h2>
<p>DAG’s são o acrônimo para a expressão inglês <code class="docutils literal notranslate"><span class="pre">Directed</span> <span class="pre">Acyclic</span> <span class="pre">Graph</span></code>, o que é portugês é conhecido como <code class="docutils literal notranslate"><span class="pre">Grafos</span> <span class="pre">Acíclicos</span> <span class="pre">Direcionados</span></code> <a class="reference external" href="https://pt.wikipedia.org/wiki/Grafos_ac%C3%ADclicos_dirigidos">(<em>ver mais em wikipedia</em>)</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =======================================</span>
<span class="c1">#   Construindo o desenho de um DAG </span>
<span class="c1"># =======================================</span>

<span class="c1"># -----------------------------------------------------</span>
<span class="c1"># Obs: Os próximos grafos irei esconder os códigos, </span>
<span class="c1">#      para ficar visualmente melhor. Mas, se quiser,</span>
<span class="c1">#      os códigos podem ser encontrados no github.</span>
<span class="c1"># -----------------------------------------------------</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">size</span><span class="o">=</span><span class="mi">40</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.495</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Grafo dos Divórcios&#39;</span><span class="p">)</span>

<span class="c1"># Edge: M &lt;---&gt; D</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> 
             <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.79</span><span class="p">,</span> <span class="mf">0.79</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.265</span><span class="p">)</span> <span class="p">,</span>
             <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;,  head_width=1, head_length=1.2&quot;</span><span class="p">))</span>

<span class="c1"># Edge: A &lt;---&gt; M</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> 
             <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.77</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">),</span>
             <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;,  head_width=1, head_length=1.2&quot;</span><span class="p">))</span>

<span class="c1"># Edge: A &lt;---&gt; D</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> 
             <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.77</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">),</span>
             <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;,  head_width=1, head_length=1.2&quot;</span><span class="p">))</span>


<span class="c1"># Remover os valores dos eixos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_34_0.png" src="_images/parte_5_34_0.png" />
</div>
</div>
<p>DAG’s são ferramentas heurísticas usadas no framework de inferências causais. Elas não como ferramentas mecânicas analíticas que já vimos, mas são <em>incrivelmente</em> úteis para nos auxiliar a pensar melhor e eventualmente também nos permite entender muito melhor os modelos mecânicos.</p>
<p>As setas do <em>DAG</em> apontam apenas em uma <code class="docutils literal notranslate"><span class="pre">direção</span></code> e essa direções indica uma <code class="docutils literal notranslate"><span class="pre">relação</span> <span class="pre">de</span> <span class="pre">causalidade</span></code> entre as variáveis analisadas, ou seja, indica que uma variável tem <code class="docutils literal notranslate"><span class="pre">influência</span> <span class="pre">direta</span></code> sobre a outra.</p>
<p>A ausência de <em>ciclos</em> significa que não existem <em>loops</em> na causalidade. Mas esses loops podem acontecer sobre o tempo, o que tornaria a análise também uma <code class="docutils literal notranslate"><span class="pre">série</span> <span class="pre">temporal</span></code>!</p>
<p>A representação desses problemas reais em estruturas como <em>DAG’s</em> podem ser, realmente, muito grandes. Pois, assim, podemos descrever a estrutura no tempo <span class="math notranslate nohighlight">\(T\)</span>, <span class="math notranslate nohighlight">\(\{T_1, T_2, ...\}\)</span>, e assim por diante.</p>
<p>Nós, normalmente rotulamos os grafos por dois nomes: <code class="docutils literal notranslate"><span class="pre">nós</span></code> (<em>nodes</em>) e <code class="docutils literal notranslate"><span class="pre">arestas</span></code> (<em>edge</em>). (Iremos aqui, por conveção, usar os nomes em inglês.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Os nodes (nós) são as variáveis. Já os edges (as arestas) representam a relação causal entre os nodes.</p>
</div>
<p>As associações que foram levadas em consideração, podem  ser incluídas dentro dos modelos de redes bayesianas, que são considerados parte do conjunto de ferramentas de <em>Machine Learning</em>. Esses modelos também não levam em consideração a causalidade, pois não existe um mecanismo interno nesses modelos que leve em consideração a direção da causalidade.</p>
<p>Já nos <em>DAG’s</em>, tal mecanismo, existe!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Esse mecanismo nos permite a capacidade de enxergar, através das lentes probabilísticas, a influência da causa e efeito em diferentes eventos! Isso não é medir uma associação. É uma medida para a causalidade!</p>
</div>
<p>E isso, faz <code class="docutils literal notranslate"><span class="pre">toda</span></code> a diferença!</p>
<p><em>Também veremos qual é a diferença entre as duas abordagens comnetadas…</em></p>
</div>
<div class="section" id="bons-grafos">
<h2>Bons Grafos<a class="headerlink" href="#bons-grafos" title="Permalink to this headline">¶</a></h2>
<p>Queremos saber a diferença entre esses dois grafos abaixo. O da esquerda tem um caminho direto de <span class="math notranslate nohighlight">\(A &lt;-&gt; M &lt;-&gt; D\)</span> e, no outro gráfico, uma suposição de que temos que a relação causal entre a taxa de casamento (<span class="math notranslate nohighlight">\(M\)</span>) e a taxa de divórcio (<span class="math notranslate nohighlight">\(D\)</span>) não existe mais.</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="_images/parte_5_39_0.png" src="_images/parte_5_39_0.png" />
</div>
</div>
<p>Regressões Lineares, em princípio, podem nos dizer a diferença entre essas duas coisas. Mas uma regressão bivariada já não pode mais. Elas podem nos dar apenas algum conhecimento da associação entre <em>casamentos</em> e <em>divórcios</em>, mas não podem nos dizer qual a diferença entre esses dois <em>DAG’s</em> acima.</p>
<p>Mas, porque não?</p>
<p>Por que, A tem influência tanto na taxa de casamentos (<span class="math notranslate nohighlight">\(A &lt;-&gt; M\)</span>) quanto em D (<span class="math notranslate nohighlight">\(A &lt;-&gt; D\)</span>), isso gera uma <code class="docutils literal notranslate"><span class="pre">correlação</span></code> entre os eventos <em>taxa de casamento</em> (<span class="math notranslate nohighlight">\(M\)</span>) e <em>taxa de divórcio</em> (<span class="math notranslate nohighlight">\(D\)</span>), mesmo que uma não influencie na outra, como no gráfico à direita. (<em>Elegante essa explicação, hein!</em>)</p>
<p>É um modo bonito de dizer:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Correlação não é Casualidade!</p>
</div>
<p>Essa mesmo estrutura do <em>DAG’s</em>, pode ser modelada com as correlações espúrias do início do capítulo, <em>waffle House</em> vs <em>taxa de divórcios</em></p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="_images/parte_5_41_0.png" src="_images/parte_5_41_0.png" />
</div>
</div>
<p>A correlação que existe entre essas duas variáveis como foi visto anteriormente, tem sua origem na causa de algum outro evento que não conhecemos, rotulado por (<span class="math notranslate nohighlight">\(?\)</span>). Só sabemos que seu comportamento tem uma influência direta sobre a magnitude do efeito dos divórcios e da quantidade de lojas da rede de restaurantes tem por região.</p>
<p>Então, se estamos tentando medir a ligação entre a taxa de casamentos (<span class="math notranslate nohighlight">\(M\)</span>) e a taxa de divórcios (<span class="math notranslate nohighlight">\(D\)</span>) usando, como sugestão, a estrutura o grafo da direita (<em>da figura acima</em>), teremos uma grande confusão. Pois  mais adiante uma definição melhor sobre essa confusão.</p>
<p>Vamos rotular essa estrutura com a seguinte notação:</p>
<div class="math notranslate nohighlight">
\[ M &lt;-&gt; D | A \]</div>
<p>Significa que podemos conhecer a <code class="docutils literal notranslate"><span class="pre">associação</span></code> que <span class="math notranslate nohighlight">\(M\)</span> e <span class="math notranslate nohighlight">\(D\)</span> tem entre si, (<span class="math notranslate nohighlight">\(M &lt;-&gt; D\)</span>), condicionado (<span class="math notranslate nohighlight">\(|\)</span>, caracter chamado de <em>pipe</em>) a <span class="math notranslate nohighlight">\(A\)</span>.</p>
<p>Quando conhecemos o valor de <span class="math notranslate nohighlight">\(A\)</span>, então eu tenho um valor extra, uma associação externa, entre as duas variáveis. E é isso que a regressão múltipla pode pode nos dizer.</p>
<div class="math notranslate nohighlight">
\[ D_i \sim Normal(\mu_i, \sigma)\]</div>
<div class="math notranslate nohighlight">
\[ \mu_i = \alpha + \beta_M M_i + \beta_A A_i \]</div>
<p>Onde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(D_i\)</span>: Taxa de divórcio</p></li>
</ul>
<p>As taxas médias dos casamentos:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta_M\)</span>: A ‘<em>peso</em>’ da taxa de casamentos</p></li>
<li><p><span class="math notranslate nohighlight">\(M_i\)</span>: A taxa média de casamentos</p></li>
</ul>
<p>As as medianas das idades nos casamentos:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta_A\)</span>: A ‘<em>peso</em>’ da mediana das idades dos casamentos</p></li>
<li><p><span class="math notranslate nohighlight">\(A_i\)</span>: Mediana das idades dos casamentos</p></li>
</ul>
<p>Podemos ver que esse modelo tem uma certa diferença dos modelos que vimos anteriormente. Existe um <span class="math notranslate nohighlight">\(\beta\)</span> para cada uma das variáveis preditoras.</p>
<p>Essa regressão linear, é um tipo especial de <em>rede bayesiana</em>, associa a variável resposta (<span class="math notranslate nohighlight">\(D_i\)</span>) a uma distribuição gaussiana. E sua média (<span class="math notranslate nohighlight">\(\mu_i\)</span>) é dada pela variáveis já conhecidas e um desvio padrão (<span class="math notranslate nohighlight">\(\sigma\)</span>).</p>
<p>Então, nossa média será descrita como <span class="math notranslate nohighlight">\(\mu_i\)</span>, onde <span class="math notranslate nohighlight">\(i\)</span>, significa que condicionaremos os valores de <span class="math notranslate nohighlight">\(\mu_i\)</span> para cada <span class="math notranslate nohighlight">\(i\)</span>. Aqui, no exemplo, cada <span class="math notranslate nohighlight">\(i\)</span> indica um novo estado do sul dos EUA. E, assim, cada condicionamento será descrito pelos ‘<em>pesos</em>’ multiplicado as suas próprias variáveis preditoras.</p>
</div>
<div class="section" id="prioris">
<h2>Prioris<a class="headerlink" href="#prioris" title="Permalink to this headline">¶</a></h2>
<p>Agora, nós iremos padronizar a variável <em>taxa de divórcio</em> (<span class="math notranslate nohighlight">\(D_i\)</span>), a variável <em>taxa de casamento</em> (<span class="math notranslate nohighlight">\(M_i\)</span>) e também a variável <em>mediana das idades dos casamentos</em>.</p>
<p>Assim, como esperamos, podemos escrever a priori para <span class="math notranslate nohighlight">\(\alpha\)</span> da seguinte forma:</p>
<div class="math notranslate nohighlight">
\[\alpha \sim Normal(0, 0.2)\]</div>
<p>Pois esperamos que <span class="math notranslate nohighlight">\(\alpha\)</span> esteja próximo de zero!</p>
<p>E as prioris para os <span class="math notranslate nohighlight">\(\beta\)</span>’s da seguinte forma:</p>
<div class="math notranslate nohighlight">
\[ \beta_M \sim Normal(0, 0.5)\]</div>
<div class="math notranslate nohighlight">
\[ \beta_A \sim Normal(0, 0.5)\]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim Exponential(1) \]</div>
<p>Pois todos os valores foram padronizados, e assim esperamos que a estimativa à priori seja próxima de zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#   Padronizando as variáveis </span>
<span class="c1"># =============================</span>
<span class="n">M_stdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Marriage</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> 
<span class="n">D_stdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Divorce</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">A_stdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">MedianAgeMarriage</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===========================================================</span>
<span class="c1">#  Priori preditiva para Mediana das Idades dos Casamentos</span>
<span class="c1"># ===========================================================</span>

<span class="n">range_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">A_stdr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">A_stdr</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>  <span class="c1"># Range de valores da média de idade dos casamentos padronizados</span>

<span class="n">qtd_amostras</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># Quantidade de amostras da priori preditiva</span>

<span class="c1"># Amostrando os valores de 𝜇𝑖 da priori</span>
<span class="n">𝛼</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">qtd_amostras</span><span class="p">)</span>
<span class="n">𝛽_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">qtd_amostras</span><span class="p">)</span>
<span class="n">𝜎</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">qtd_amostras</span><span class="p">)</span>  <span class="c1"># Priori 𝜎 ~ Exp(1)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================</span>
<span class="c1">#   Gráfico da Priori Preditiva para 𝜇𝑖</span>
<span class="c1"># ========================================</span>

<span class="n">𝜇</span> <span class="o">=</span> <span class="p">[</span> <span class="n">𝛼</span> <span class="o">+</span> <span class="n">𝛽_A</span> <span class="o">*</span> <span class="n">A_i</span> <span class="k">for</span> <span class="n">A_i</span> <span class="ow">in</span> <span class="n">range_A</span> <span class="p">]</span>  <span class="c1"># Calculando 𝜇𝑖 = 𝛼 + 𝛽𝐴 * 𝐴𝑖, para todo 𝐴𝑖</span>

<span class="c1"># Plotando o gráfico </span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="c1"># Relembrando o DAG: A &lt;-&gt; D!</span>
<span class="c1"># Plotando as retas da posteriori para 𝜇𝑖</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">range_A</span><span class="p">,</span> <span class="n">𝜇</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Priori Preditiva de $\mu_i$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;( $A$ ) Média das Idades dos Casamentos (padronizadas)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;( $D$ ) Taxa de Divórcio (padronizadas)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="c1"># Ajustando os limites da visuzalização do gráfico.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_50_0.png" src="_images/parte_5_50_0.png" />
</div>
</div>
<p>Temos no gráfico acima a representação da nossa distribuição à priori do modelo de regressão linear. Sorteamos <span class="math notranslate nohighlight">\(50\)</span> linhas dessa distribuição. Essa é a distribuição  à priori preditiva de <span class="math notranslate nohighlight">\(\mu_i\)</span>.  Ou seja, <code class="docutils literal notranslate"><span class="pre">isso</span> <span class="pre">é</span> <span class="pre">oque</span> <span class="pre">nosso</span> <span class="pre">modelo</span> <span class="pre">pensa</span> <span class="pre">sobre</span> <span class="pre">o</span> <span class="pre">problema,</span> <span class="pre">antes</span> <span class="pre">de</span> <span class="pre">darmos</span> <span class="pre">os</span> <span class="pre">dados</span> <span class="pre">à</span> <span class="pre">ele</span></code>.</p>
<p>Temos que sempre fazer a simulação da priori preditiva. Só assim será possível entender uma importante característica presente em todos os modelo. Temos observar se a amplitude da priori faz sentido. Quando nós dermos os dados para o modelo, é necessário que as estimativas do modelo resida sobre distribuição à priori. Caso contrário, teremos uma priori ruim. Em cenários mais simples, e com muitos dados, esse efeito pode até passar despercebido e ajustar bem. Porém em cenários mais complexos, uma priori ruim poderá ser desastrosa!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sempre verifique a priori.</p>
</div>
<p>Vamos andar pelo gráfico para entendermos melhor suas partes. Iniciando pela <code class="docutils literal notranslate"><span class="pre">Média</span> <span class="pre">das</span> <span class="pre">Idades</span> <span class="pre">dos</span> <span class="pre">Casamentos</span> <span class="pre">padronizada</span> <span class="pre">($A$</span> <span class="pre">padronizada)</span></code> que é uma gaussiana, centrada em <span class="math notranslate nohighlight">\(0\)</span> e com desvio padrão<span class="math notranslate nohighlight">\(\frac{1}{2}\)</span>:</p>
<div class="math notranslate nohighlight">
\[A \sim Normal(0, 0.5)\]</div>
<p>No gráfico nós estamos observando todos os valores dentro do intervalo <span class="math notranslate nohighlight">\([-2, \mbox{ } 2]\)</span>. Esse intervalo corresponde ao <span class="math notranslate nohighlight">\(2^o\)</span> desvio padrão! Isso deve corresponder a grande maioria dos casos que os valores da Mediana das Idades dos Casamentos (<em>padronizadas</em>) irá ocorrer.</p>
<p>Esse pensamento também é válido para a variável <code class="docutils literal notranslate"><span class="pre">Taxa</span> <span class="pre">de</span> <span class="pre">Divórcio</span> <span class="pre">($D$</span> <span class="pre">padronizada)</span></code>. Seus valores também estão delimitados pelo intervalo <span class="math notranslate nohighlight">\([-2, \mbox{ } 2]\)</span>, representando o <span class="math notranslate nohighlight">\(2^o\)</span> desvio padrão.</p>
<p>Esse modelo nos diz é qual a taxa de divórcio padronizada,(<span class="math notranslate nohighlight">\(D\)</span>), que é uma variável <em>z-score</em>, quando já conhecemos os valores da Média das Idades dos Casamentos (<span class="math notranslate nohighlight">\(A\)</span>), que também está padronizada (outra <em>z-score</em>). Assim temos duas variáveis padronizadas, <em>z-scores</em>, explicando uma à outra.</p>
<p>Agora, se as linhas da regressão linear não morar no espaço delimitado pela priori, então a <code class="docutils literal notranslate"><span class="pre">escolhemos</span> <span class="pre">uma</span> <span class="pre">priori</span> <span class="pre">ruim</span></code>! Por que isso é impossível! Se após dermos os dados pra o modelo, a inclinação da curva for maior que a delimitada pela região da priori, temos uma priori ruim.</p>
<p>Ainda podemos discutir se a escolha da priori irá governar todo o range da taxa de divóricio. Provavelmente não é verdade. Em capítulos posteriores, quando falarmos sobre <em>overfitting</em> (ou em português, teremos um sobreajuste). Isso acontece pois a priori não é apertada o suficiente para trabalharmos segurança. Nesse caso podemos pensar em prioris <em>flat</em>, que podem ser justificada cientificamente, tal como uma priori <em>flat</em> implícita nas análises frequentistas.</p>
</div>
<div class="section" id="nosso-modelo">
<h2>Nosso modelo<a class="headerlink" href="#nosso-modelo" title="Permalink to this headline">¶</a></h2>
<p>Esse é nosso modelo, descrito na primeira linha. Na segunda linha temos dois termos lineares, lembrando que o termo linear significa aditivo. Esses dois termos irá gerar um plano. A seguir, teremos nossas prioris. Um destaque para a priori do <span class="math notranslate nohighlight">\(\sigma\)</span>, de agora em diante não vamos mais usar <span class="math notranslate nohighlight">\(Uniform\)</span> mas sim a distribuição <span class="math notranslate nohighlight">\(Exponential\)</span>, pois ela tem boas propriedades. Falaremos mais sobre isso adiante.</p>
<div class="math notranslate nohighlight">
\[D_i \sim Normal(\mu_i, \sigma) \]</div>
<div class="math notranslate nohighlight">
\[ \mu_i = \alpha + \beta_M M_i + \beta_A A_i \]</div>
<div class="math notranslate nohighlight">
\[ \alpha \sim Normal(0, 0.2) \]</div>
<div class="math notranslate nohighlight">
\[ \beta_M \sim Normal(0, 0.5) \]</div>
<div class="math notranslate nohighlight">
\[ \beta_A \sim Normal(0, 0.5) \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim  Exponential(1) \]</div>
<p>O uso da distribuição <span class="math notranslate nohighlight">\(Exponential\)</span> como priori para <span class="math notranslate nohighlight">\(\sigma\)</span> tem vantagens tais como, sempre tem valores positivos, para valores maiores a sua probabilidade decresce e para defini-lá precisamos indicar qual será seu valor médio.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================</span>
<span class="c1">#  Estimando o modelo linear proposto</span>
<span class="c1"># =====================================</span>

<span class="n">stan_model_divorce</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        vector[N] divorce_rate;</span>
<span class="s2">        vector[N] marriage_rate;</span>
<span class="s2">        vector[N] median_age;</span>
<span class="s2">    }</span>
<span class="s2">    </span>
<span class="s2">    parameters {</span>
<span class="s2">        real alpha;</span>
<span class="s2">        real beta_M;</span>
<span class="s2">        real beta_A;</span>
<span class="s2">        real&lt;lower=0&gt; sigma;</span>
<span class="s2">    }</span>

<span class="s2">    model{</span>
<span class="s2">        alpha ~ normal(0, 0.2);</span>
<span class="s2">        beta_M ~ normal(0,0.5);</span>
<span class="s2">        beta_A ~ normal(0, 0.5);</span>
<span class="s2">        sigma ~ exponential(1);</span>
<span class="s2">        </span>
<span class="s2">        divorce_rate ~ normal(alpha + beta_M * marriage_rate + beta_A * median_age, sigma);</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">my_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">D_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> 
    <span class="s1">&#39;divorce_rate&#39;</span><span class="p">:</span> <span class="n">D_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">&#39;marriage_rate&#39;</span><span class="p">:</span> <span class="n">M_stdr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">&#39;median_age&#39;</span><span class="p">:</span> <span class="n">A_stdr</span><span class="o">.</span><span class="n">values</span>
<span class="p">}</span>

<span class="n">posteriori_divorce</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">stan_model_divorce</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">my_data</span><span class="p">)</span>
<span class="n">fit_divorce</span> <span class="o">=</span> <span class="n">posteriori_divorce</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_M</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;beta_M&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_A</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;beta_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_divorce</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resume_posteriori</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">confidence_HPDI</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the summary of posteriori data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">posteriori</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">confi_HPDI</span> <span class="o">=</span> <span class="n">HPDI</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">confidence_HPDI</span><span class="p">)</span>
    
    <span class="n">posteriori</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">posteriori</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">posteriori</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confi_HPDI</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">posteriori</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confi_HPDI</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">posteriori</span><span class="p">]),</span> <span class="n">rounded</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">describe_posteriori</span><span class="p">(</span><span class="n">vars_post</span><span class="p">,</span> <span class="n">confidence_HPDI</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="n">post</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">var_</span> <span class="ow">in</span> <span class="n">vars_post</span><span class="p">:</span>
        <span class="n">post</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resume_posteriori</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">var_</span><span class="p">),</span> <span class="n">confidence_HPDI</span><span class="p">))</span>
    
    <span class="n">hpdi_min_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence_HPDI</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
    <span class="n">hpdi_max_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">confidence_HPDI</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
        
    <span class="n">post</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">post</span><span class="p">,</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">vars_post</span><span class="p">,</span>
                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="s1">&#39;Std&#39;</span><span class="p">,</span> <span class="n">hpdi_min_label</span><span class="p">,</span> <span class="n">hpdi_max_label</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Estimativas das Posterioris&#39;</span><span class="p">)</span>
        
        <span class="n">min_axis_</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">max_axis_</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">min_axis_</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">max_axis_</span><span class="o">*</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">min_axis_</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">0.2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
            

        <span class="k">if</span> <span class="n">min_axis_</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">max_axis_</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">post</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================</span>
<span class="c1">#  Descrevendo os dados da posteriori</span>
<span class="c1"># =====================================</span>

<span class="n">vars_post</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_M&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_A&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
<span class="n">describe_posteriori</span><span class="p">(</span><span class="n">vars_post</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>Std</th>
      <th>5.5%</th>
      <th>94.5%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>alpha</th>
      <td>-0.00</td>
      <td>0.10</td>
      <td>-0.18</td>
      <td>0.19</td>
    </tr>
    <tr>
      <th>beta_M</th>
      <td>-0.07</td>
      <td>0.16</td>
      <td>-0.35</td>
      <td>0.24</td>
    </tr>
    <tr>
      <th>beta_A</th>
      <td>-0.61</td>
      <td>0.16</td>
      <td>-0.91</td>
      <td>-0.31</td>
    </tr>
    <tr>
      <th>sigma</th>
      <td>0.83</td>
      <td>0.09</td>
      <td>0.67</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As informações da tabela acima contém um resumo das posterioris estimadas. Como esperado <span class="math notranslate nohighlight">\(\alpha\)</span> tem a média <span class="math notranslate nohighlight">\(0\)</span>. Pois tinha que ser assim conforme a construção do nosso modelo.</p>
<p>Já a estimativa para do <span class="math notranslate nohighlight">\(\beta_M\)</span>, <code class="docutils literal notranslate"><span class="pre">taxa</span> <span class="pre">de</span> <span class="pre">casamento</span></code>, é levemente negativa e o desvio padrão está entre <span class="math notranslate nohighlight">\(2\)</span> a <span class="math notranslate nohighlight">\(3\)</span> vezes a sua média. Podemos olhar para o intervalo de HPDI de <span class="math notranslate nohighlight">\(89\%\)</span> no qual essa valores estão entre <span class="math notranslate nohighlight">\(-0.3\)</span> e <span class="math notranslate nohighlight">\(0.2\)</span>.</p>
<p>Talvez exista algum efeito, ou talvez não tenha nenhum efeito dependendo da direção. Nós apenas não sabemos muito bem o que pensar sobre essa variável, pois ela não apresenta uma relação consistente, não existe uma associação consistente na regressão multipla entre a <em>taxa de casamentos</em> e a <em>taxa de divórcios</em>.</p>
<p>Agora, a <code class="docutils literal notranslate"><span class="pre">mediana</span> <span class="pre">das</span> <span class="pre">idades</span> <span class="pre">do</span> <span class="pre">casamentos</span></code> tem uma estimativa média de <span class="math notranslate nohighlight">\(-0.6\)</span> com o desvio padrão também de <span class="math notranslate nohighlight">\(0.16\)</span>, temos que a massa da posteriori está inteiramente abaixo de zero! Assim, realmente temos uma associção negativa entre a <em>media das idades dos casasmentos</em> e a <em>taxa de divórcios</em>.</p>
<p>Mas agora nós já sabemos que não temos um <code class="docutils literal notranslate"><span class="pre">impacto</span> <span class="pre">diretamente</span> <span class="pre">causal</span></code> entre <em>taxa de casamentos</em> e a <em>taxa de divórcios</em>. Isso estava mascarado pois <em>idade mediana</em> é uma causa comum entre as duas outras variáveis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vars_all</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beta_1&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_M&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_2&#39;</span><span class="p">,</span> <span class="s1">&#39;beta_A&#39;</span><span class="p">]</span> 

<span class="c1">#  Legendas</span>
<span class="c1"># ------------</span>
<span class="c1"># beta_2 == D ~ A   </span>
<span class="c1"># beta_A ==&gt; D ~ A + M </span>

<span class="c1"># beta_M ==&gt; D ~ A + M  </span>
<span class="c1"># beta_1 ==&gt; D ~ M  </span>

<span class="n">describe_posteriori</span><span class="p">(</span><span class="n">vars_all</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_5_59_0.png" src="_images/parte_5_59_0.png" />
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>Std</th>
      <th>5.5%</th>
      <th>94.5%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>beta_1</th>
      <td>0.18</td>
      <td>0.07</td>
      <td>0.05</td>
      <td>0.31</td>
    </tr>
    <tr>
      <th>beta_M</th>
      <td>-0.07</td>
      <td>0.16</td>
      <td>-0.35</td>
      <td>0.24</td>
    </tr>
    <tr>
      <th>beta_2</th>
      <td>-0.87</td>
      <td>0.17</td>
      <td>-1.22</td>
      <td>-0.56</td>
    </tr>
    <tr>
      <th>beta_A</th>
      <td>-0.61</td>
      <td>0.16</td>
      <td>-0.91</td>
      <td>-0.31</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Quando observando as tabelas acima e comparando com o gráfico, temos que a taxa de casamentos (<span class="math notranslate nohighlight">\(\beta_M\)</span>), resultante da regressão multipla, tem a sua distribuição à posteriori, com <span class="math notranslate nohighlight">\(89\%\)</span> de HPDI, contendo o <code class="docutils literal notranslate"><span class="pre">zero</span></code>. Portanto provávelmente a variável taxa de casamento (<span class="math notranslate nohighlight">\(\beta_M\)</span>) <code class="docutils literal notranslate"><span class="pre">não</span> <span class="pre">tem</span> <span class="pre">impacto</span> <span class="pre">casual</span> <span class="pre">direto</span></code> na taxa de divórcio.</p>
<p>Ele foi mascarado por que a <em>mediana das idades dos casamentos</em> (<span class="math notranslate nohighlight">\(A\)</span>) é uma variável que influência tanto a <em>taxa de divórcio</em> quanto a <em>taxa de casamentos</em>.</p>
<p>No gráfico acima fica claro que o modelo <em>beta_1</em>, no modelo <span class="math notranslate nohighlight">\(D ~ M\)</span>, nos diz que <em>taxa de casamento</em> tem uma associação positiva com a <em>taxa de divórcio</em>, o que era de se esperar pelos nossos entendimentos sobre como poderia funcionar esse evento.</p>
<p>Entretanto, como a regressão múltipla podemos ver que a posteriori atinge o zero, e assim não podemos perceber que <em>provavelmente</em> não existe uma associação entre a <em>taxa de casamentos</em> e a <em>taxa de divórcios</em>.</p>
<p>Isso é uma boa coisa que a regressão múltipla pode fazer por nós! Eu acredito que <code class="docutils literal notranslate"><span class="pre">essa</span> <span class="pre">é</span> <span class="pre">realmente</span> <span class="pre">a</span> <span class="pre">relação</span> <span class="pre">causal</span></code> que temos aqui.</p>
<p>Assim, nosso <em>DAG</em> provavelmente seria dessa forma:</p>
<div class="cell tag_remove_input docutils container">
<div class="cell_output docutils container">
<img alt="_images/parte_5_61_0.png" src="_images/parte_5_61_0.png" />
</div>
</div>
<p>Assim, como não temos uma relação forte da <em>taxa de casamentos</em> (<span class="math notranslate nohighlight">\(M\)</span>) com a variável <em>taxa de divórcios</em> (<span class="math notranslate nohighlight">\(D\)</span>), a representação de nosso <em>DAG</em>, ou seja, a representação da causalidade, poderá ser mapeada de acordo com o gráfico acima.</p>
<p>Mas vamos explorar um pouco melhor o significado dessa abordagem.</p>
<div class="section" id="regressao-multipla">
<h3>Regressão Múltipla<a class="headerlink" href="#regressao-multipla" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Uma vez que nós conhecemos <span class="math notranslate nohighlight">\(A\)</span>, <em>mediana das idades dos casamentos</em>, existe apenas um pequeno valor adicional de conhecimento sobre <span class="math notranslate nohighlight">\(D\)</span> que está contido em <span class="math notranslate nohighlight">\(M\)</span>, a <em>taxa de casamento</em>.</p></li>
</ul>
<p>Então podemos interpretar isso da seguinte forma, ao conhecermos os valores de <span class="math notranslate nohighlight">\(A\)</span> implica que o conhecimento de <span class="math notranslate nohighlight">\(M\)</span> não vai nos ajudar muito mais a entender <span class="math notranslate nohighlight">\(D\)</span>. Isso coincide com <em>DAG</em> acima, onde não há relação causal da <em>taxa de casamentos</em> para a <em>taxa de divórcios</em>.</p>
<ul class="simple">
<li><p>Uma vez que nós conhecemos a <span class="math notranslate nohighlight">\(M\)</span>, taxa de casamentos, há muito valor em conhecer também <span class="math notranslate nohighlight">\(A\)</span>, mediana das idades dos casamentos.</p></li>
</ul>
<p>Isso funciona na outra direção, pois a <em>mediana das idades dos casamentos</em> (<span class="math notranslate nohighlight">\(A\)</span>) é uma <code class="docutils literal notranslate"><span class="pre">causa</span></code> comum da <em>taxa de casamentos</em> (<span class="math notranslate nohighlight">\(M\)</span>).</p>
<ul class="simple">
<li><p>Se nós não conhecermos a <em>mediana das idades dos casamentos</em> (<span class="math notranslate nohighlight">\(A\)</span>) em algum estado, ainda é útil conhecer a <em>taxa de casamentos</em> (<span class="math notranslate nohighlight">\(M\)</span>).</p></li>
</ul>
<p>Saber sobre a <em>taxa de casamentos</em> é útil e importante pois isso pode nos dá informações adicionais. Essa informação vem de outra relação causal e não da uma informação causal direta entre as variáveis.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Esse é nosso negócio aqui. A inferência! Descobrir a diferença entre essas coisas.</p>
</div>
<p>Se nós apenas quisermos fazer uma previsão e não nos importarmos com a inferência causal, a <em>taxa de casamento</em> é útil e ajudará a prever as coisas. Mas, por outro lado, não nos ajuda a fazer <code class="docutils literal notranslate"><span class="pre">interevenções</span> <span class="pre">no</span> <span class="pre">mundo</span> <span class="pre">real</span></code>, porque se quisermos mudar a <em>taxa de divórcios</em> (<span class="math notranslate nohighlight">\(D\)</span>) nos estado manipulando a <em>taxa de casamento</em> (<span class="math notranslate nohighlight">\(M\)</span>) não teria nenhum efeito.</p>
<p>Simplesmente por que não é assim que as coisas funcionam. <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">maquinaria</span> <span class="pre">de</span> <span class="pre">causalidade</span> <span class="pre">natural</span> <span class="pre">dos</span> <span class="pre">divórcios</span> <span class="pre">não</span> <span class="pre">apresenta</span> <span class="pre">essa</span> <span class="pre">ligação</span></code> entre da <em>taxa de casamentos</em> para a <em>taxa de divórcios</em>.</p>
<p>Assim, para efeito de políticas públicas, é necessário focar nas alterações na <em>mediana da idade dos casamentos</em> para verificar os efeitos na <em>taxa de divórcios</em>.</p>
<p>Assim precisamos ser claros se queremos <strong>apenas</strong> prever as coisas. Se quisermos também inteferir as relações causais, devemos fazer a previsão das relações causais para que possamos fazer as intervenções. <code class="docutils literal notranslate"><span class="pre">Uma</span> <span class="pre">intervenção</span> <span class="pre">requer</span> <span class="pre">um</span> <span class="pre">verdadeiro</span> <span class="pre">entendimento</span> <span class="pre">da</span> <span class="pre">causalidade</span> <span class="pre">do</span> <span class="pre">sistema</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Uma previsão não tem o poder de fazer tais intervenções causais.</p>
</div>
<p>Isso é o grande terror da ciência, podemos fazer previsões realmente boas sem entendermos nada! Lembra dos modelos <em>geocêntricos</em>. <code class="docutils literal notranslate"><span class="pre">Modelo</span> <span class="pre">estatísticos</span> <span class="pre">corretos</span> <span class="pre">não</span> <span class="pre">são</span> <span class="pre">suficientes</span> <span class="pre">para</span> <span class="pre">descobrir</span> <span class="pre">relações</span> <span class="pre">causais</span></code>, então precisamos de algo extra!</p>
</div>
</div>
<div class="section" id="id1">
<h2>Regressão Múltipla<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Parei em regressão múltipla 31:10</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="parte_4.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">4 - Funções Wiggly</p>
        </div>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Rodolpho Macedo dos Santos<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>