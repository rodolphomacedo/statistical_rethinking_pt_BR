
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3- Modelos Geocêntricos &#8212; Statistical Rethinking</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4 - Funções Wiggly" href="parte_4.html" />
    <link rel="prev" title="2 - Engenharia de Golems" href="parte_2.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Statistical Rethinking</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="capa.html">
   Estatistica Bayesiana
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro_pt-BR.html">
   Intro - Estatística Bayesiana (🇧🇷)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_en.html">
   Intro - Bayesian Statistics (🇺🇸)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_1.html">
   1- Introdução
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_2.html">
   2 - Engenharia de Golems
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3- Modelos Geocêntricos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_4.html">
   4 - Funções Wiggly
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_5.html">
   5 - Muitas variáveis e os waffles espúrios
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/parte_3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR/issues/new?title=Issue%20on%20page%20%2Fparte_3.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/rodolphomacedo/statistical_rethinking_pt_BR/main?urlpath=tree/parte_3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#distribuicao-normal">
   Distribuição Normal
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regressao-linear">
   Regressão Linear
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gerando-um-processo-de-flutuacao-normal">
   Gerando um processo de flutuação normal
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#porque-a-normal">
     Porque a Normal?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#persperctiva-ontologica">
       Persperctiva Ontológica
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#persperctiva-epistemologica">
       Persperctiva Epistemologica
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modelos-lineares">
   Modelos Lineares
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#acordando-a-linguagem-que-iremos-trabalhar">
     Acordando a linguagem que iremos trabalhar
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#linguagem-da-modelagem">
       Linguagem da modelagem
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#contruindo-um-modelo-linear">
       Contruindo um modelo linear
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modelos-gaussianos">
       Modelos Gaussianos
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#adicionando-prioris">
         Adicionando prioris
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simulacao-a-partir-da-priori">
       Simulação a partir da priori
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculando-a-posteriori">
     Calculando a posteriori
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aproximacao-quadratica">
     Aproximação Quadrática
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#estimando-a-altura-usando-a-stan">
       Estimando a altura usando a Stan
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adicionando-uma-variavel-preditora">
     Adicionando uma variável preditora
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#explicando-o-modelo-acima">
       Explicando o modelo acima:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribuicao-priori-preditiva">
     Distribuição Priori Preditiva
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribuicao-preditiva-da-priori">
     Distribuição Preditiva da Priori
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aproximacao-da-posteriori">
     Aproximação da posteriori
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="modelos-geocentricos">
<h1>3- Modelos Geocêntricos<a class="headerlink" href="#modelos-geocentricos" title="Permalink to this headline">¶</a></h1>
<div class="section" id="distribuicao-normal">
<h2>Distribuição Normal<a class="headerlink" href="#distribuicao-normal" title="Permalink to this headline">¶</a></h2>
<img alt="gauss" src="_images/Gauss.jpg" />
<p>fonte: <a class="reference external" href="https://pt.wikipedia.org/wiki/Marco_alem%C3%A3o">wikipedia</a></p>
<p>fonte: <a class="reference external" href="https://www.bis-ans-ende-der-welt.net/Deutschland-B.htm">Distribuição Gausiana</a></p>
</div>
<div class="section" id="regressao-linear">
<h2>Regressão Linear<a class="headerlink" href="#regressao-linear" title="Permalink to this headline">¶</a></h2>
<p>São simples <em>golems</em> estatísticos.</p>
<ul class="simple">
<li><p>Modelo de média e variância de normalmente (Gaussiano) distribuído.</p></li>
<li><p>Média como uma combinação aditiva dos pesos das varáveis que a compõem.</p></li>
<li><p>Variância é constante.</p></li>
</ul>
</div>
<div class="section" id="gerando-um-processo-de-flutuacao-normal">
<h2>Gerando um processo de flutuação normal<a class="headerlink" href="#gerando-um-processo-de-flutuacao-normal" title="Permalink to this headline">¶</a></h2>
<p>Através da flutuação normal <em>(sobe 1 ou desce 1)</em> iremos construir um processo que tenha como resultante natural o surgimento de um comportamento cuja distribuição podemos descrever como a normal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Necessário para desbloquear o asyncio no Jupyter</span>

<span class="c1"># Fonte: https://pystan.readthedocs.io/en/latest/faq.html</span>
<span class="c1"># Fonte: https://github.com/microsoft/playwright-python/issues/178</span>

<span class="c1"># Docs Pystan: https://pystan.readthedocs.io/en/latest/index.html</span>

<span class="c1"># -------------</span>
<span class="c1"># Instalar nest_asyncio: pip install nest_asyncio</span>
<span class="c1"># Versões </span>
<span class="c1"># python==3.8.0</span>
<span class="c1"># numpy==1.21.1</span>
<span class="c1"># pystan==3.2.0</span>
<span class="c1"># nest_asyncio==1.5.1</span>
<span class="c1"># -------------</span>

<span class="c1"># Rodar esse comando antes de import a stan (pystan versão 3.x)</span>
<span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Contruindo um passeio conforme a distribuição Bernoulli(0.5) em +1 ou -1</span>
<span class="n">n_linhas</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># Quantas linhas iremos simular</span>
<span class="n">n_passos</span> <span class="o">=</span> <span class="mi">30</span>   <span class="c1"># Quantidade de passos que iremos simular</span>

<span class="n">corte_1</span> <span class="o">=</span> <span class="mi">3</span>   <span class="c1"># Indica o primeiro corte no passeio</span>
<span class="n">corte_2</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># Indica o segundo corte no passeio</span>
<span class="n">corte_3</span> <span class="o">=</span> <span class="mi">26</span>  <span class="c1"># Indica o terceiro corte no passeio</span>


<span class="n">aleatorizar_grafico</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Para ver a simulação um pouco mais aleatorizada vizualmente, alternar para False para ver a diferênça.</span>

<span class="n">passeios</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Armazenar todos os passeios gerados num array</span>

<span class="c1"># Parâmetros da simulação</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>  <span class="c1"># Alterando a cor de fundo, para ficar mais elegante.</span>
<span class="n">n_passos</span> <span class="o">=</span> <span class="n">n_passos</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Descontando o primeiro passo, pois inicia-se sempre com zero! </span>

<span class="k">for</span> <span class="n">linha</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_linhas</span><span class="p">):</span>  <span class="c1"># Quantas linhas iremos plotar</span>
    
    <span class="n">passeio</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Inicializando todos os pontos com o valor 0 (conforme dito acima!)</span>
    <span class="n">novo_ponto</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># variável de controle </span>
    
    <span class="k">for</span> <span class="n">passo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_passos</span><span class="p">):</span>  <span class="c1"># Quantos passos iremos simular?</span>
        
        <span class="k">if</span> <span class="n">aleatorizar_grafico</span><span class="p">:</span>
            <span class="c1"># +1 (subida) ou -1 (descida) - Com efeito de aleatorizacão (apenas para melhorar a visualização).</span>
            <span class="n">novo_ponto</span> <span class="o">=</span> <span class="n">novo_ponto</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>    
            <span class="c1"># +1 (subida) ou -1 (descida) - Sem efeito de aleatorizacão - &quot;Pixelizado&quot;</span>
            <span class="n">novo_ponto</span> <span class="o">=</span> <span class="n">novo_ponto</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
        
        <span class="n">passeio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">novo_ponto</span><span class="p">)</span>
    
    <span class="n">passeios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">passeio</span><span class="p">)</span>  <span class="c1"># Armazendo todas as linhas geradas</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">linha</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># Plotando a linha gerada</span>
    
<span class="c1"># Retas horizontais dos cortes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">corte_1</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>  <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">corte_2</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">corte_3</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Configurando infos do gráfico    </span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Passeio Aleatório {+1, -1} com p(0.5)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Número de passos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">passeios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">passeios</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Transpondo os vetores de passeios para ajuste na plotagem.</span>

<span class="c1"># ------------</span>
<span class="c1"># Gerando os histogramas de todas as linhas para alguns passos específicos ao longo do passeio.</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">corte_1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograma </span><span class="se">\n</span><span class="s2"> Normalmente distribuído </span><span class="se">\n</span><span class="s2">  passo &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corte_1</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">corte_2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograma </span><span class="se">\n</span><span class="s2"> Normalmente distribuído </span><span class="se">\n</span><span class="s2">  passo &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corte_2</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">corte_3</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograma </span><span class="se">\n</span><span class="s2"> Normalmente distribuído </span><span class="se">\n</span><span class="s2"> passo &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corte_3</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>      
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_8_0.png" src="_images/parte_3_8_0.png" />
<img alt="_images/parte_3_8_1.png" src="_images/parte_3_8_1.png" />
</div>
</div>
<p>Todas as flutuações geradas se equilibriam entre si, gerando assim uma curva simétrica. Porém cada uma delas individualmente não necessariamente se equilibram entre si. Isso é a normal!</p>
<div class="section" id="porque-a-normal">
<h3>Porque a Normal?<a class="headerlink" href="#porque-a-normal" title="Permalink to this headline">¶</a></h3>
<p>O interessante e frustante ao mesmo tempo é que mesmo nós sabendo como cada uma das curvas são geradas, não temos acesso a como cada uma delas individualmente faz o seu percurso, pois muito pouca temos muito pouca informação sobre como é o processo gerador.</p>
<p>Assim, quando vimos um comportamento de um evento que é norrmalmente distribuído, não sabe o que tem la dentro, não temos um acesso intuitivo da informação contida no comportamento indivídual de cada passeio.</p>
<p>Mas sabendo que o processo como um todo tem o comportamento normalmente distribuído, podemos usar essa informação para falsificar ou não hipóteses de um estudo particular.</p>
<div class="math notranslate nohighlight">
\[ x \sim normal(\mu, \sigma) \]</div>
<p>Isso é muito legal pois podemos descrever o processo como um todo apenas por dois números, pois toda a informação do funcionamento da maquinária subjcente do processo eliminado e tudo que foi presevado foi a média (<span class="math notranslate nohighlight">\(\mu\)</span>) e a variância(<span class="math notranslate nohighlight">\(\sigma\)</span>), por isso por isso que precisamos apenas desses dois números para descrever uma distribuição normal.</p>
<p>Essa é toda a informação que conseguimos extrair dessa máquinaria subjacente, a Natureza.</p>
<p>O mais terrível é que não podemos saber o processo a partir de um simples histograma, temos que realmente fazer ciência para isso, temos cavar mais fundo, medir coisas mais difíceis para só assim descobrir mais algumas coisas nas profundezas do mecanismo de geração do processo.</p>
<p>Isso é verdade não apenas para a normal, mas para muitas as distribuições! Todas as distribuições de máxima entropia tem essa mesma propriedade, que muitos processos diferente possuem a mesma distribuição de frequências.</p>
<div class="section" id="persperctiva-ontologica">
<h4>Persperctiva Ontológica<a class="headerlink" href="#persperctiva-ontologica" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Processo que adiciona flutuações amortecidas como resultado</p></li>
<li><p>As flutuações amortecidas se aproximam de uma gaussiana</p></li>
<li><p>Mas nenhuma informação sobrou do processo gerador, apenas a média e a variância.</p></li>
<li><p>Não podemos inferir o processo a partir dessa distribuição.</p></li>
</ul>
<p>Se quisermos construir um modelo visando responder de modo mais conservador possível, no qual tudo que estiver disposto a dizer sobre algum conjunto de medidas, como medida de alturas, é que eles tem variância finita e podemos usar a distribuição gaussiana. Mesmo se eles forem distorcidos ou alguma outra coisas a distribuição gaussiana cobrirá uma faixa mais ampla de valores do que qualquer outra com a mesma média e a mesma variância, essa é a distribuição mais conservadora que podemos assumir. Qualquer outra distribuição será mais restrita e por isso terá mais informação incorporada, por isso a opção mais conservadora que podemos porpor é a gaussiana, no qual tudo que precisamos para ela é a média a variância. (<em>Isso será demostrado mais para frente no curso</em>.)</p>
</div>
<div class="section" id="persperctiva-epistemologica">
<h4>Persperctiva Epistemologica<a class="headerlink" href="#persperctiva-epistemologica" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Conhecemos apenas a média e a variância</p></li>
<li><p>A menos surpreendente e mais conservadora (<em>máxima entropia</em>) distribuição gaussiana</p></li>
<li><p>A distribuição natural da máxima entropia.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="modelos-lineares">
<h2>Modelos Lineares<a class="headerlink" href="#modelos-lineares" title="Permalink to this headline">¶</a></h2>
<p>“<strong>Modelo lineares generalizados</strong>”: teste <em>t</em>, regressão simples, regressão multipla, ANOVA, ANCOVA, MANOVA, MANCOVA, etc, etc, etc. Todos esses modelos são a mesma coisa, são todos modelos lineares.</p>
<p>A seguir iremos construir modelo lineares manualmente do zero para entendermos como é o processo de pensamento de construção de hipóteses e iremos construir um gráfico no qual iremos visualizar, pela primeira vez, nossa incerteza.</p>
<ul class="simple">
<li><p>Iremos aprender estratégias e não procedimentos.</p></li>
</ul>
<div class="section" id="acordando-a-linguagem-que-iremos-trabalhar">
<h3>Acordando a linguagem que iremos trabalhar<a class="headerlink" href="#acordando-a-linguagem-que-iremos-trabalhar" title="Permalink to this headline">¶</a></h3>
<p>Relembrando o primeiro modelo que nós fizemos anteriormente, o lançamento do globo, tinhamos:</p>
<div class="math notranslate nohighlight">
\[ w \sim Binomial(N, p) \]</div>
<div class="math notranslate nohighlight">
\[ p \sim Uniform(0, 1) \]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(w\)</span>: Resultado</p></li>
<li><p><span class="math notranslate nohighlight">\(\sim\)</span>: “<em>É distribuído como…</em>”</p></li>
<li><p><span class="math notranslate nohighlight">\(Binomial( N, p)\)</span>: É a distribuição dos dados (verossimilhança, ou <em>likelihood</em> no inglês)</p></li>
<li><p><span class="math notranslate nohighlight">\(p\)</span>: É o parâmetro que iremos estimar</p></li>
<li><p><span class="math notranslate nohighlight">\(Uniform(0, 1)\)</span>: Nossa distribuição <em>à priori</em></p></li>
</ul>
<p>No exemplo do lançamento do globo, o que estavamos interessados em saber era proporcão de água na superfície (<span class="math notranslate nohighlight">\(p\)</span>) da Terra. O processo que usamos para coletar os dados, a amostragem, automaticamente nos propõe, de modo quase impositivo, a utilização da estrutura Binomial.</p>
<p>A estrutura que distribui os dados binomialmente, nada mais é do que a contagem do número de vezes que é possível acontecer tal fato, dado que a proporção <span class="math notranslate nohighlight">\(p\)</span> é fixa para todas as vezes <span class="math notranslate nohighlight">\(N\)</span> que iremos retirarmos uma amostra.</p>
<hr class="docutils" />
<p>Essa é a linguagem que iremos usar nesse curso, é a notação matemática padrão, no qual consiste na maneira de comunicar a todos os colegas de trabalho o que foi pensado, quais foram as suposições, quais foram as hipóteses (isto é, as sugestões) e qual a estrutura proposta como um possível caminho para se entender o problema.</p>
<p><em>Será a forma de se comunicar ao mundo sua forma de pensar!</em></p>
<div class="section" id="linguagem-da-modelagem">
<h4>Linguagem da modelagem<a class="headerlink" href="#linguagem-da-modelagem" title="Permalink to this headline">¶</a></h4>
<p>Do mesmo modo que escrevemos o modelo acima iremos escrever todos os outros modelo, inclusive, a programação em <strong>Stan</strong> será escrita dessa forma.</p>
<p>Para qualquer modelo que iremos elaborar, seja uma regressão linear simples ou modelo mais elaborados, temos que criar uma lista com todas as variáveis que irão participar desse modelo. Algumas coisas eu irei observar nos dados, como a contagem do número de vezes que o globo foi lançado. E também haverá outras coisas que não vamos poder observar, como a inclinação da uma reta de uma modelo linear simples, ou proporção de água no globo, pois elas não são entidades observáveis.</p>
<p>Por isso temos que listar todas as variáveis e então defini-las.</p>
<p>Definindo as variáveis:</p>
<div class="math notranslate nohighlight">
\[ y_i \]</div>
<div class="math notranslate nohighlight">
\[ \mu_i \]</div>
<div class="math notranslate nohighlight">
\[ \beta \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \]</div>
<div class="math notranslate nohighlight">
\[ x_i \]</div>
<p>Um modelo de regressão, assim como qualquer outro modelo, será escrito da mesma forma que o anterior, porém esse modelo terá muito mais simbolos pois temos muito mais variáveis participando da explicação, mas é a mesma coisa, apenas precisamos definir a cada um deles.</p>
<p>O motor dos modelos de regressão linear é a segunda linha da definição abaixo (<em>a seguir iremos construir esse modelo desde o início</em>):</p>
<div class="math notranslate nohighlight">
\[ y_i \sim Normal(\mu_i, \sigma) \]</div>
<div class="math notranslate nohighlight">
\[ \mu_i = \beta x_i \]</div>
<div class="math notranslate nohighlight">
\[ \beta \sim Normal(0, 10) \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim Exponencial(1) \]</div>
<div class="math notranslate nohighlight">
\[ x_i \sim Normal(0, 1) \]</div>
<p>Essa segunda linha,  <span class="math notranslate nohighlight">\( \mu_i = \beta x_i \)</span>, geralmente a parte que é mais confusa para se entender (iremos ver um exemplo a seguir), mas ela significa que média da distribuição normal de cima (do <span class="math notranslate nohighlight">\(y_i\)</span>) é geralmente definida por uma equação, o que define em termos de alguma outra variável que observamos, <span class="math notranslate nohighlight">\(x_i\)</span>.</p>
<p>O <span class="math notranslate nohighlight">\(x_i\)</span> é uma variável que ajuda a explicar o comportamento do <span class="math notranslate nohighlight">\(y_i\)</span>, ou seja, <span class="math notranslate nohighlight">\(x_i\)</span> é uma variável explicativa.</p>
<p>Mas repare que <span class="math notranslate nohighlight">\(x_i\)</span> também tem uma distribuição, nós normalmente não nos preocupamos em definir uma distribuição para as variáveis explicativas pois não iremos prevê-las, porém existe uma grande vantagem em fazer essas suposições de distribuições, pois podemos fazer coisas muito legais com esse fato, iremos ver essas coisas mais à frente, tais como <code class="docutils literal notranslate"><span class="pre">medidas</span> <span class="pre">de</span> <span class="pre">erros</span></code> e também <code class="docutils literal notranslate"><span class="pre">dados</span> <span class="pre">faltantes</span></code>.</p>
<p>Assim, como todas as variáveis tem sua própria definição de distribuição, se você não sabe algo sobre algumas delas podemos colocar dentro do modelo e assim iremos ganhar automaticamente um poder inferêncial que estávamos perdendo antes.</p>
</div>
<div class="section" id="contruindo-um-modelo-linear">
<h4>Contruindo um modelo linear<a class="headerlink" href="#contruindo-um-modelo-linear" title="Permalink to this headline">¶</a></h4>
<p>Com um conjunto de dados amostrados de uma população, extraída do livro da <em>Nancy Howel</em>, Life history of the DOBE !KUNG, um novo clássico de demografia evolucionária, disponível no pacote R <em>rethinking</em> e suas versões variantes. (Nesse material temos uma cópia do link <a class="reference external" href="https://github.com/rmcelreath/rethinking">Rethinking - R-library - GitHub</a>.</p>
<img alt="Dobe !Kung" src="_images/dobe_kung.jpg" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/Howell1.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>  <span class="c1"># Banco de dados</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>height</th>
      <th>weight</th>
      <th>age</th>
      <th>male</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>151.765</td>
      <td>47.825606</td>
      <td>63.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>139.700</td>
      <td>36.485807</td>
      <td>63.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>136.525</td>
      <td>31.864838</td>
      <td>65.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>156.845</td>
      <td>53.041914</td>
      <td>41.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>145.415</td>
      <td>41.276872</td>
      <td>51.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>163.830</td>
      <td>62.992589</td>
      <td>35.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>149.225</td>
      <td>38.243476</td>
      <td>32.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>168.910</td>
      <td>55.479971</td>
      <td>27.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>147.955</td>
      <td>34.869885</td>
      <td>19.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>165.100</td>
      <td>54.487739</td>
      <td>54.0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Temos uma amostra de <span class="math notranslate nohighlight">\(544\)</span> indivíduos e abaixo temos uma histograma descritivo das quatro variáveis da base:</p>
<ul class="simple">
<li><p>Altura</p></li>
<li><p>Peso</p></li>
<li><p>Idade</p></li>
<li><p>Gênero (<span class="math notranslate nohighlight">\(1\)</span> para homem e <span class="math notranslate nohighlight">\(0\)</span> para mulheres)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],</span> <span class="p">[</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Altura das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Peso das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Kg&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Idade das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Anos&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">male</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gênero das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Feminino       -      Masculino&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_17_0.png" src="_images/parte_3_17_0.png" />
</div>
</div>
</div>
<div class="section" id="modelos-gaussianos">
<h4>Modelos Gaussianos<a class="headerlink" href="#modelos-gaussianos" title="Permalink to this headline">¶</a></h4>
<p>Um primeiro modelo</p>
<div class="math notranslate nohighlight">
\[ h_i \sim Normal(\mu, \sigma) \]</div>
<p>A altura <span class="math notranslate nohighlight">\(h\)</span> do indivíduo <span class="math notranslate nohighlight">\(i\)</span> será distribuído normalmente, com uma média <span class="math notranslate nohighlight">\(\mu\)</span> e o desvio padrão <span class="math notranslate nohighlight">\(\sigma\)</span>.</p>
<hr class="docutils" />
<p>Estamos usando as letras gregas <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>, por conveção de linguagem, mas nada impede que use quaisquer outros simbolos. Não haverá nenhum problema, irá apenas irritar algum estatístico, mas isso será um bônus.</p>
<p>Aqui é necessário que você saiba ler e entender o que isso significa, assim você aprende o que está acontecendo. Lembre-se isso é apenas uma linguagem, isso não é um código. É apenas uma forma de comunicação, uma comunicação científica.</p>
<hr class="docutils" />
<p>Aqui temos duas variáveis para estimar, <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>, e teremos que inferir a partir de <span class="math notranslate nohighlight">\(h\)</span>, das coisas que medimos, mas <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span> precisam de definições por que esse é um modelo bayesiano.</p>
<div class="section" id="adicionando-prioris">
<h5>Adicionando prioris<a class="headerlink" href="#adicionando-prioris" title="Permalink to this headline">¶</a></h5>
<div class="math notranslate nohighlight">
\[ h_i \sim Normal(\mu, \sigma) \]</div>
<div class="math notranslate nohighlight">
\[ \mu \sim Normal(178, 20) \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim Uniform(0, 50) \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">x_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x_sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_mu</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_mu</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Priori de $\mu$ </span><span class="se">\n</span><span class="s1"> Normal(178, 20)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_sigma</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_sigma</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Priori de $\sigma$ </span><span class="se">\n</span><span class="s1"> Uniforme(0, 50)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_19_0.png" src="_images/parte_3_19_0.png" />
</div>
</div>
<p>Qual é a implicação de usar essas distribuições para <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>?</p>
<p>O valor de <span class="math notranslate nohighlight">\(178\)</span> escolhido para ser a média da distribuição normal (<em>à priori</em>) foi por achar que essa poderia ser a altura média da população com uma generosa incerteza (<em>incerteza da média</em>) de <span class="math notranslate nohighlight">\(20\)</span>.</p>
<p>Para o <span class="math notranslate nohighlight">\(\sigma\)</span> colocamos qualquer valor entre <span class="math notranslate nohighlight">\(0\)</span> até <span class="math notranslate nohighlight">\(50\)</span> tem igual probabilidade de ocorrer, esse é um range bastante razoável já que <span class="math notranslate nohighlight">\(50\)</span> é um valor bem mais alto do que podemos esperar para o desvio padrão, pois não temos mais nenhuma informação razoavél colocar como a priori (no mundo real certamente saberiamos um pouco mais).</p>
</div>
</div>
<div class="section" id="simulacao-a-partir-da-priori">
<h4>Simulação a partir da priori<a class="headerlink" href="#simulacao-a-partir-da-priori" title="Permalink to this headline">¶</a></h4>
<p>O que essas prioris estão implicando sobre a estimativa da altura, antes de ver os dados (<span class="math notranslate nohighlight">\(h\)</span>)? Simularmos! <code class="docutils literal notranslate"><span class="pre">Distribuição</span> <span class="pre">à</span> <span class="pre">Priori</span> <span class="pre">Preditivo</span></code>.</p>
<p>Simular os dados apenas das priori nos permitirá entender se do modo como estamos ensinando o modelo seu resultado está sendo satisfatório. Vamos simular!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================================================</span>
<span class="c1"># Construindo o processo de amostragem da distribuição à priori preditiva.</span>
<span class="c1"># ========================================================================</span>

<span class="c1"># Amostragem</span>
<span class="n">amostra_mu</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Normal(178, 20) estimativa para mu.</span>
<span class="n">amostra_sigma</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Uniforme(0, 50) estimativa para sigma.</span>

<span class="n">amostra_h_priori</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">amostra_mu</span><span class="p">,</span> <span class="n">amostra_sigma</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>  <span class="c1"># Amostrando da Normal(mu, sigma)</span>


<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">amostra_h_priori</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">171</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribuição Preditiva da Priori  </span><span class="se">\n</span><span class="s1"> Altura&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;(cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 0 cm de altura, ovo fertilizado.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 272 cm de altura, pessoa mais alta da história.</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_22_0.png" src="_images/parte_3_22_0.png" />
</div>
</div>
<p>Plotar o gráfico da <code class="docutils literal notranslate"><span class="pre">Distribiuição</span> <span class="pre">Preditiva</span> <span class="pre">da</span> <span class="pre">Priori</span></code> nos permite ver qual a probabilidade, por exemplo, de alguém ter a altura próxima de <span class="math notranslate nohighlight">\(0 cm\)</span> é praticamente igual a <em>zero</em>, <span class="math notranslate nohighlight">\(P\{altura = 0\}\)</span>, e também a probabilidade de uma pessoa ser maior do que <span class="math notranslate nohighlight">\(272 cm\)</span>, <span class="math notranslate nohighlight">\(P\{altura &gt;= 272\}\)</span>, que é a altura da pessoa mais alta no mundo já registrada, é bem baixa.</p>
<p>Imagine agora que colocaremos como priori valores muito absurdos para o <span class="math notranslate nohighlight">\(\sigma\)</span>, vejamos o que acontecerá:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================================================</span>
<span class="c1"># Construindo o processo de amostragem da distribuição à priori preditiva.</span>
<span class="c1">#                     Priori versão com dados absurdos</span>
<span class="c1"># ========================================================================</span>

<span class="c1"># Amostragem</span>
<span class="n">amostra_mu</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Normal(178, 20) estimativa para mu.</span>
<span class="n">amostra_sigma</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Uniforme(0, 50) estimativa para sigma.</span>

<span class="n">amostra_h_priori</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">amostra_mu</span><span class="p">,</span> <span class="n">amostra_sigma</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>  <span class="c1"># Amostrando da Normal(mu, sigma)</span>


<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">amostra_h_priori</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">170</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribuição Preditiva da Priori com Valores Absurdos </span><span class="se">\n</span><span class="s1"> Altura </span><span class="se">\n</span><span class="s1"> $Normal(178, 100)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;(cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 0 cm de altura, ovo fertilizado.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 272 cm de altura, pessoa mais alta da história. </span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_24_0.png" src="_images/parte_3_24_0.png" />
</div>
</div>
<p>Os valores de probabilidade que está sendo atribuído pela priori e que estão para fora dos limites mais conservadores possível, não deveriam ter uma importancia tão grande, ou seja, sua probabilidade deveria tenter a <em>zero</em>!</p>
<p>Esse é um exemplo de escolha ruim para uma priori, colocando apenas com um valor enorme para <span class="math notranslate nohighlight">\(\sigma\)</span> mas sem ter uma ligação mais intima com a natureza do problema.</p>
<p>Nesse caso, caso univariado, as distorções que podem ser geradas por usarmos uma priori dessa forma é praticamente nenhuma, o modelo provavelmente ajustará bem. Já para modelos mais complexos como modelo mistos ou modelos hieráquicos com muitos parâmentros, a utilizacão de prioris sem muito sentido podem causar sérias distorções nos resultados.</p>
<p>Por isso, sempre simule a priori para observar se o comportamento do modelo condiz com a realidade mais plausível. É essa a sua crença antes do modelo ver o dados!</p>
</div>
</div>
<div class="section" id="calculando-a-posteriori">
<h3>Calculando a posteriori<a class="headerlink" href="#calculando-a-posteriori" title="Permalink to this headline">¶</a></h3>
<p>Nosso objetivo é estimar qual a distribuição conjunta dos parâmentros <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>, iremos fazer a estimativa via método da aproximação de grid.</p>
<div class="math notranslate nohighlight">
\[ p\{(\mu, \sigma) | h_i\} ∝ p\{h_i | \mu, \sigma \} p\{ \mu \} p\{ \sigma \} \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Para visualização das multiplicações vamos deixar o sigma fixo, em 20 por exemplo, </span>
<span class="c1">#  e iremos variar o mu para três valores distintos de alturas (180, 155, 147).</span>

<span class="n">curva_1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">curva_2</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">curva_3</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">posteriori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">curva_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curva_1</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">180</span><span class="p">))</span>
    <span class="n">curva_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curva_2</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">155</span><span class="p">))</span>
    <span class="n">curva_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curva_3</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">147</span><span class="p">))</span>
    
<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Normal </span><span class="se">\n</span><span class="s1"> Para as alturas ($h_i$): {147, 155, 180} </span><span class="se">\n</span><span class="s1"> com as hipóteses de mu [100, 300] para a média&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Altura (cm)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;147&#39;</span><span class="p">,</span> <span class="s1">&#39;155&#39;</span><span class="p">,</span> <span class="s1">&#39;180&#39;</span><span class="p">])</span>

<span class="n">posteriori_nao_normalizada</span> <span class="o">=</span> <span class="n">curva_1</span> <span class="o">*</span> <span class="n">curva_2</span> <span class="o">*</span> <span class="n">curva_3</span>   <span class="c1"># Essa multiplicação será feita ponto a ponto.</span>
<span class="n">posteriori</span> <span class="o">=</span> <span class="n">posteriori_nao_normalizada</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">)</span>  <span class="c1"># Normalizando a posteriori</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">posteriori</span><span class="p">)</span>  <span class="c1"># Essa multiplicação será feita ponto a ponto.</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori </span><span class="se">\n</span><span class="s1"> Usando os três valores da altura juntos ($h_i$): {147, 155, 180}&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Altura (cm)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.4&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;posteriori&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_27_0.png" src="_images/parte_3_27_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ================================</span>
<span class="c1">#     Calculando a posteriori</span>
<span class="c1"># ================================</span>

<span class="n">grid</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Determina a precisão, valores maiores demanda maior custo computacional</span>

<span class="n">mu_ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>  
<span class="n">sigma_ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>  
<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">mu_ls</span><span class="p">,</span> <span class="n">sigma_ls</span><span class="p">)</span>

<span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">verossimilhanca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">verossimilhanca_parcial</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
    <span class="n">verossimilhanca_parcial_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">verossimilhanca_parcial</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="n">verossimilhanca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verossimilhanca</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">verossimilhanca_parcial_log</span><span class="p">))</span>

<span class="c1"># Adicionando a priori</span>
<span class="c1"># P{x | mu, sigma} * P{mu} * P{sigma}</span>
<span class="c1"># exp( log(P{x | mu, sigma}) + log(P{mu}) + log(P{sigma}) )</span>
<span class="n">posteriori_nao_normalizada</span> <span class="o">=</span> <span class="n">verossimilhanca</span> <span class="o">+</span> \
                             <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">mu</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span> <span class="o">+</span> \
                             <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>   <span class="c1"># Priori de sigma</span>
    
<span class="n">posteriori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">))</span>  <span class="c1"># Por que isso? Está no livro, pg.85 - R code 4.16 </span>
<span class="n">posteriori</span> <span class="o">=</span> <span class="n">posteriori</span> <span class="o">/</span> <span class="n">posteriori</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">mu_mesh</span><span class="p">,</span> <span class="n">sigma_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">mu_ls</span><span class="p">,</span> <span class="n">sigma_ls</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">mu_mesh</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sigma_mesh</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">posteriori</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">grid</span><span class="p">,</span> <span class="n">grid</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Posteriori&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">135</span><span class="p">,</span> <span class="mi">142</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_28_0.png" src="_images/parte_3_28_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Amostrando mu e sigma a partir da posteriori</span>

<span class="n">amostras_posteriori_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">*</span><span class="n">grid</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">posteriori</span><span class="p">)</span>

<span class="n">mu_amostrado</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>
<span class="n">sigma_amostrado</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_amostrado</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da posteriori </span><span class="se">\n</span><span class="s1"> $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_amostrado</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da posteriori </span><span class="se">\n</span><span class="s1"> $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_29_0.png" src="_images/parte_3_29_0.png" />
</div>
</div>
</div>
<div class="section" id="aproximacao-quadratica">
<h3>Aproximação Quadrática<a class="headerlink" href="#aproximacao-quadratica" title="Permalink to this headline">¶</a></h3>
<p>A partir de agora até a metade do curso iremos usar a <code class="docutils literal notranslate"><span class="pre">aproximação</span> <span class="pre">quadrática</span></code>. Se você fez os cálculos da posteriori para a altura, oque é sugerido fortemente, percebemos que a complexidade e o custo computacional envolvido para estimar as duas variáveis (<span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>) são bastante significativos.</p>
<p>Para modelos que necessitem estimar mais parâmetros, 10 por exemplo, o custo computacional e a estrutura necessária para calcular essa estimativa com o método do grid de aproximação se torna inviável. Por isso temos que pensar em uma nova estrutura na qual podemos, <strong>Laplace</strong>, <span class="math notranslate nohighlight">\(1749-1827\)</span>, propõem usar a aproximação quadrática. Com essa estrutura mais exótica, nós poderemos calcular estimativas da posteriori em dimensões muito elevadas.</p>
<ul class="simple">
<li><p>Aproximação da posteriori como uma Gaussiana</p></li>
<li><p>Podemos estimar com encontrando o valor de duas coisas:</p>
<ul>
<li><p>Pelo “pico” da posteriori, <em>maximum a posteriori</em> (MAP)</p></li>
<li><p>Desvio Padrão e a correlação entre os parâmetros.</p></li>
</ul>
</li>
<li><p>As estimativas são bem parecidas com o que já fizemos, exceto que não temos prioris.</p></li>
</ul>
<p>Para a primeira coisa, temos que, ao olhar para a posteriori (os histogramas acima) de <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span> e subir a colina até encontrar o pico. O computador pode começar a busca por qualquer local sem saber onde está o pico, mas ele sabe subir a colina e então pode simplismente subir a colina, usando o apenas o <em>gradiente descendentes</em> (ou melhor, usando o gradiente ascendente, pois iremos escalar a subida até o pico). Existem muitos algoritmos eficiêntes para fazer isso, e podemos dar a ele um espaço multidimensional muito alto (bem maior que 2, como no exemplo anterior) e iremos alcançar o pico.</p>
<p>Quando alçarmos o pico, só precismos medir a curvatura no pico para saber a largura da colina e isso é tudo que precisa ser feito para construirmos a <code class="docutils literal notranslate"><span class="pre">aproximação</span> <span class="pre">quadrática</span></code>. Também conhecida por <code class="docutils literal notranslate"><span class="pre">Aproximação</span> <span class="pre">de</span> <span class="pre">Laplace</span></code>, por ele ter utilizado o procedimento corretamente.</p>
<img alt="Laplace" src="_images/Laplace.jpg" />
<hr class="docutils" />
<p>Fonte: <a class="reference external" href="https://fr.wikipedia.org/wiki/Pierre-Simon_de_Laplace">wikipedia</a></p>
<p>Obs: No curso original, as estimativas são realizadas com a biblioteca <code class="docutils literal notranslate"><span class="pre">Rethinking</span></code> criadas e disponibilizadas pelo github do próprio professor Richard McElreath, pode ser acessado nesse endereço: https://github.com/rmcelreath/rethinking</p>
<p>A partir daqui iremos fazer em paralelo com o curso a utilização da biblioteca Stan-mc a página e a documentação oficial se encontram em <a class="reference external" href="https://mc-stan.org/">Stan</a></p>
<img alt="stan" src="_images/stan-logo.png" />
<p>Obs2: a estimativa da posteriori feita pela Stan utiliza algumas técnicas mais robustas do que a aproximação quadrática, porém no curso, essa estimativa é realiza internamente na biblioteca rethinking e é invisível para o usuário, assim, o conteúdo dessas notas serão intimamente paralelas com o curso, sendo que se ocorrer um distânciamento entre ambas trajetórias, notas extras serão inseridas para minimizar esse longor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">stan</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primeiro_codigo_stan</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">data {</span>
<span class="s2">    int N;</span>
<span class="s2">    real X[N];</span>
<span class="s2">}</span>

<span class="s2">parameters {</span>
<span class="s2">    real mu;</span>
<span class="s2">    real&lt;lower=0&gt; sigma;</span>
<span class="s2">}</span>

<span class="s2">model {</span>
<span class="s2">    // mu ~ normal(60, 30);   // Priori para mu</span>
<span class="s2">    // sigma ~ halfnormal(25); // Priori para sigma</span>
<span class="s2">    </span>
<span class="s2">    X ~ normal(mu, sigma);</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Dados ~ Normal(50, 12)</span>
<span class="n">meus_dados</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X</span><span class="p">}</span>

<span class="n">posteriori_model</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">primeiro_codigo_stan</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">meus_dados</span><span class="p">)</span>

<span class="n">fit</span> <span class="o">=</span> <span class="n">posteriori_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recuperando os parâmetros</span>
<span class="n">mu_modelo_1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>
<span class="n">sigma_modelo_1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  mu médio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mu_modelo_1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  sigma médio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">sigma_modelo_1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Posteriori estimada com a Stan&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_modelo_1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequências à Posteriori&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_modelo_1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequências à Posteriori&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==============================
  mu médio:  50.4
  sigma médio:  11.65
==============================
</pre></div>
</div>
<img alt="_images/parte_3_35_1.png" src="_images/parte_3_35_1.png" />
</div>
</div>
<div class="section" id="estimando-a-altura-usando-a-stan">
<h4>Estimando a altura usando a Stan<a class="headerlink" href="#estimando-a-altura-usando-a-stan" title="Permalink to this headline">¶</a></h4>
<p>De volta ao exemplo anterior, vamos estimar a altura <span class="math notranslate nohighlight">\(h_i\)</span> usando um modelo escrito em Stan.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelo_altura</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        real altura[N];</span>
<span class="s2">    }</span>

<span class="s2">    parameters {</span>
<span class="s2">        real mu;</span>
<span class="s2">        real&lt;lower=0&gt; sigma;</span>
<span class="s2">    }</span>

<span class="s2">    model {</span>
<span class="s2">        // mu ~ normal(178, 20);   // Priori para mu</span>
<span class="s2">        // sigma ~ uniform(1, 50);  // Priori para sigma</span>

<span class="s2">        altura ~ normal(mu, sigma);</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">altura</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Como recomenda a documentação https://mc-stan.org/docs/2_22/stan-users-guide/standardizing-predictors-and-outputs.html</span>
<span class="c1"># Iremos rescalonar o vetor de altura antes de mandar para a Stan</span>
<span class="n">altura_media</span> <span class="o">=</span> <span class="n">altura</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">altura_std</span> <span class="o">=</span> <span class="n">altura</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">altura_resc</span> <span class="o">=</span> <span class="p">(</span><span class="n">altura</span> <span class="o">-</span> <span class="n">altura_media</span><span class="p">)</span> <span class="o">/</span> <span class="n">altura_std</span>

<span class="n">dados</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">altura</span><span class="p">),</span> <span class="s1">&#39;altura&#39;</span><span class="p">:</span> <span class="n">altura</span><span class="p">}</span>  <span class="c1"># Iremos usar a altura não normalizada para efeito de simplificação.</span>

<span class="n">posteriori_model</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">modelo_altura</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dados</span><span class="p">)</span>
<span class="n">fit_altura</span> <span class="o">=</span> <span class="n">posteriori_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#  Modelo calculado na Stan</span>
<span class="c1"># =============================</span>

<span class="c1"># Recuperando os parâmetros</span>
<span class="n">mu_altura</span> <span class="o">=</span> <span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>
<span class="n">sigma_altura</span> <span class="o">=</span> <span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Comparativo com a amostra&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  mu amostrado: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  sigma amostrado: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  mu médio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mu_altura</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  sigma médio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">sigma_altura</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Posteriori estimada com a Stan&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_altura</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequências à Posteriori&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_altura</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequências à Posteriori&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># =============================</span>
<span class="c1">#  Modelo calculado na mão</span>
<span class="c1"># =============================</span>
<span class="c1"># Amostrando mu e sigma a partir da posteriori calculada na mão (exemplo construído acima)</span>

<span class="n">amostras_posteriori_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">*</span><span class="n">grid</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">posteriori</span><span class="p">)</span>

<span class="n">mu_amostrado</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>
<span class="n">sigma_amostrado</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Posteriori estimada na mão&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_amostrado</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da posteriori </span><span class="se">\n</span><span class="s1"> $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_amostrado</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da posteriori </span><span class="se">\n</span><span class="s1"> $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Comparativo com a amostra
==============================
  mu amostrado:  138.26
  sigma amostrado:  27.6
==============================
  mu médio:  138.3
  sigma médio:  27.65
==============================
</pre></div>
</div>
<img alt="_images/parte_3_38_1.png" src="_images/parte_3_38_1.png" />
<img alt="_images/parte_3_38_2.png" src="_images/parte_3_38_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="adicionando-uma-variavel-preditora">
<h3>Adicionando uma variável preditora<a class="headerlink" href="#adicionando-uma-variavel-preditora" title="Permalink to this headline">¶</a></h3>
<p>Como a variável peso (<em>weight</em>) descreve a altura (<em>height</em>)?</p>
<p><em>Obs: Iremos utilizar apenas pessoas que tenham acima de 18 anos de idade para todos os estudo seguintes, apenas simplesmente como efeito didático.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gráfico de dispersão - peso ajudar a identificar qual a altura.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">],</span>  <span class="c1"># Filtro para todos as pessoas que tem acima de 30 kilos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Dispersão&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Peso (weight)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altura (height)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_40_0.png" src="_images/parte_3_40_0.png" />
</div>
</div>
<p>Usando um modelo linear de média, <span class="math notranslate nohighlight">\(\mu\)</span>:</p>
<div class="math notranslate nohighlight">
\[ h_i \sim Normal(\mu_i, \sigma), \mbox{ [Verossimilhaças] }\]</div>
<div class="math notranslate nohighlight">
\[ mu_i = \alpha + \beta(x_i + \bar{x}), \mbox{ [Modelo Linear] } \]</div>
<div class="math notranslate nohighlight">
\[  \alpha \sim Normal(178, 20), \mbox{ [Priori de }\alpha \mbox{]} \]</div>
<div class="math notranslate nohighlight">
\[  \beta \sim Normal(0, 10), \mbox{ [Priori de }\beta \mbox{]} \]</div>
<div class="math notranslate nohighlight">
\[  \sigma \sim Uniform(0, 50), \mbox{ [Priori de }\sigma \mbox{]} \]</div>
<p>Vamos agora ver uma reta, um modelo linear. Até agora o que nós fizemos foram inferências de 1 ou 2 parâmetros que podem ser aproximadas como uma gaussiana.</p>
<p>Mas o que significa fazer um modelo linear, ou utilizar um reta no modelo? Isso significa que podemos adicionar uma nova variável que irá nos ajudar a melhorar nosso entendimento da variável <code class="docutils literal notranslate"><span class="pre">altura</span></code>. Essa nova variável terá a função, dentro do nosso modelo, de predizer, ou seja, dizer antecipadamente, antever, advinhar, prever qual é a da altura do indivíduo, probabilisticamente. Chamamos todas essas variáveis que podemos nos ajudar como <code class="docutils literal notranslate"><span class="pre">variáveis</span> <span class="pre">preditoras</span></code>.</p>
<p>A principal ideia em adicionar uma variável preditora, assim como outras variáveis do nosso conjunto de dados, é que quando aprendemos, podemos fazer podemos fazer melhores previsões sobre o resultado de interesse, que nesse caso, é a <code class="docutils literal notranslate"><span class="pre">altura</span></code>.</p>
<p>Para ficar mais claro, quando pretendemos saber a altura de uma pessoa sem termos nenhuma informação adicional sobre a pessoa, o melhor que podemos fazer é usar a estimativa da altura da população para estimar a altura desse indivíduo. É o máximo que podemos fazer com as informações que temos disponíveis.
Mas se esse mesmo indivíduo, assim como todos na nossa amotras, nos informarem uma característica a mais para nós estimarmos sua altura. Nesse exemplo, o peso é uma das informações adicionais, <em>preditoras</em>, para termos mais conhecimento sobre a altura.</p>
<div class="section" id="explicando-o-modelo-acima">
<h4>Explicando o modelo acima:<a class="headerlink" href="#explicando-o-modelo-acima" title="Permalink to this headline">¶</a></h4>
<p>Agora temos que <span class="math notranslate nohighlight">\(h_i\)</span> também contínua distribuído como uma <code class="docutils literal notranslate"><span class="pre">Gaussiana</span></code> como no exemplo anterior, porém agora a média <span class="math notranslate nohighlight">\(\mu\)</span> não é apenas distribuída normalmente com a média fixa em 178, dependerá de cada indivíduo <span class="math notranslate nohighlight">\(i\)</span>, assim <span class="math notranslate nohighlight">\( \mu_i = \alpha + \beta(x_i + \bar{x}) \)</span>, <span class="math notranslate nohighlight">\(x_i\)</span> representa uma pessoa em particular.</p>
<p>Em instante iremos entender melhor o que significa todos os termos de <span class="math notranslate nohighlight">\(\mu\)</span>. O <span class="math notranslate nohighlight">\(\alpha\)</span> e o <span class="math notranslate nohighlight">\(\sigma\)</span> continuam com as mesmas prioris do exemplo anterior, e agora temos uma nova distribuição à priori para <span class="math notranslate nohighlight">\(\beta\)</span>, que é o responsável por descrever a relação entre <code class="docutils literal notranslate"><span class="pre">altura</span></code> e o <code class="docutils literal notranslate"><span class="pre">peso</span></code>.</p>
<p>Observando mais profundamente a estrutura que criamos nosso novo modelo:</p>
<div class="math notranslate nohighlight">
\[ \mu_i = \alpha + \beta(x_i + \bar{x}) \]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mu_i\)</span> = é a média da linha i</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span> = é a altura média da quando <span class="math notranslate nohighlight">\(x_i = \bar{x}\)</span>, conhecida como o <code class="docutils literal notranslate"><span class="pre">intercepto</span></code>. (<em>Lindo!!!</em>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta\)</span> = taxa de mudança para <span class="math notranslate nohighlight">\(\mu\)</span> cada unidade de mundaça de <span class="math notranslate nohighlight">\(x_i\)</span>, conhecido como a <code class="docutils literal notranslate"><span class="pre">inclinação</span></code>.</p></li>
</ul>
<p>Se por acaso o <span class="math notranslate nohighlight">\(\beta\)</span> for zero, estamos novamente no modelo anterior. Ou seja, estamos dizendo que não há relação  transmitida para o <span class="math notranslate nohighlight">\(\mu\)</span> a partir do peso. Do contrário, cada número que o <span class="math notranslate nohighlight">\(x_i\)</span> sobe, subimos <span class="math notranslate nohighlight">\(\beta\)</span> o <span class="math notranslate nohighlight">\(\mu\)</span>.</p>
<p>Escrever nossos modelos lineares dessa forma nos permite entender e definir melhor os parâmetros e nossa prioris, mas nem todos os modelos devem ser escritos dessa forma e nesse caso deveremos ter uma boa justificativa.</p>
</div>
</div>
<div class="section" id="distribuicao-priori-preditiva">
<h3>Distribuição Priori Preditiva<a class="headerlink" href="#distribuicao-priori-preditiva" title="Permalink to this headline">¶</a></h3>
<p>Quais são as prioris desse modelo e o que essas prioris significam?</p>
<p>Como no exemplo anterior, vamos simular para entender e compreender as implicações do modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">65</span><span class="o">-</span><span class="mi">30</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===========================</span>
<span class="c1">#     Simulando a Priori</span>
<span class="c1"># ===========================</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># A quantidade de vezes que iremos simular os dados da priori</span>

<span class="n">alpha_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">beta_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">alpha_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span> <span class="c1"># (x_i - x_bar)</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha inferior vermelha: Altura óvulo fertilizado (0cm)  </span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha superior vermelha: Pessoa mais alta do mundo (272 cm)</span>
  
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Pessoa mais alta já registrada </span><span class="se">\n</span><span class="s1">              (272 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">280</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Altura do Embrião </span><span class="se">\n</span><span class="s1">           (0 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Priori: $alpha + beta * x_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altura $h_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Peso $x_i$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_44_0.png" src="_images/parte_3_44_0.png" />
</div>
</div>
<p>Analisando as retas, resultados da simulação da priori para <span class="math notranslate nohighlight">\(\alpha\)</span> e <span class="math notranslate nohighlight">\(\beta\)</span>, podemos ver que muitas linhas estão superiores a altura de <span class="math notranslate nohighlight">\(272 cm\)</span>. Também podemos ver que existem linhas que indicam alturas menores que zero, o que naturalmente deveria estar errado. Ambos comportamentos são prioritariamente resutantes dos valores gerados pela distribuição dos <span class="math notranslate nohighlight">\(\beta\)</span>, a inclinação da reta. Assim, essas retas são nossas crenças à priori.</p>
<p>Agora que temos um pouco mais de intimidade com o comportamento das nossas prioris, podemos concluir que devemos diminuir nosso entusiasmos com relação ao <span class="math notranslate nohighlight">\(\beta\)</span>, pois essa é uma priori muito ruim. Haverá momentos, em situações reais, que será necessário verificar a compatibilidade com o mundo real. Faça alterações nas prioris para verificar a mudança no efeito.</p>
</div>
<div class="section" id="distribuicao-preditiva-da-priori">
<h3>Distribuição Preditiva da Priori<a class="headerlink" href="#distribuicao-preditiva-da-priori" title="Permalink to this headline">¶</a></h3>
<p>Nós agora sabemos algo sobre as prioris, temos um conhecimento científico sobre a nossa distribuição dos <span class="math notranslate nohighlight">\(\beta\)</span>’s, sabemos que ele é positivo, assim, então, vamos transforma-lo em positivo?</p>
<p>Mas como?</p>
<p>Para fazer isso, usaremos a distribuição <code class="docutils literal notranslate"><span class="pre">log-Normal</span></code>. Essa distribuição pode ser um pouco menos conhecida, porém é muito útil para situações desse tipo. Essa distribuição, log-Normal, construída partir da exponenciação dos valores da distribuição Normal.</p>
<div class="math notranslate nohighlight">
\[lognormal(0, 1) = exp\{ Normal(0, 1)\}\]</div>
<p>Na teoria das probabilidades, uma distribuição log-normal (ou lognormal) é uma distribuição de probabilidade contínua de uma variável aleatória cujo logaritmo é normalmente distribuído.</p>
<p>Assim, se a variável aleatória <span class="math notranslate nohighlight">\(X\)</span> é log-normalmente distribuída, então <span class="math notranslate nohighlight">\(Y = log(X)\)</span> tem uma distribuição normal. <em>(Ref. Wikipedia)</em></p>
<p>Referências:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/reference/generated/scipy.stats.lognorm.html#scipy.stats.lognorm">Numpy - Log-Normal</a></p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.lognormal.html">Scipy - Log-Normal</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Log-normal_distribution">Wikipedia - Log-Normal</a></p></li>
</ul>
<hr class="docutils" />
<p>Um caminho para se entender melhor o que é uma <span class="math notranslate nohighlight">\(lognormal\)</span> é o seguinte:</p>
<p>Qual é a distribuição de <span class="math notranslate nohighlight">\(X\)</span> que, ao aplicarmos o log, ela se tornará <span class="math notranslate nohighlight">\(Normal\)</span>? Naturalmente temos que:</p>
<p>se</p>
<div class="math notranslate nohighlight">
\[ a = log(exp(a)) \]</div>
<p>então:</p>
<div class="math notranslate nohighlight">
\[ X \sim exp\{Normal\} \]</div>
<p>pois,</p>
<div class="math notranslate nohighlight">
\[  log(exp\{Normal\}) = Normal \]</div>
<p>ou seja,</p>
<div class="math notranslate nohighlight">
\[ log(X) = Normal \]</div>
<p>então:</p>
<div class="math notranslate nohighlight">
\[ X \sim lognormal \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================</span>
<span class="c1">#     Estudos sobre as Log-Normais </span>
<span class="c1"># =====================================</span>

<span class="n">d_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">d_lognormal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],[</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d_normal</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$exp( Normal(0,1) )$ </span><span class="se">\n</span><span class="s1"> Log Normal gerada na mão </span><span class="se">\n</span><span class="s1"> Mostrando valores de 0 a 5&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d_lognormal</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histograma da distribuição lognormal </span><span class="se">\n</span><span class="s1"> Gerada usando Numpy </span><span class="se">\n</span><span class="s1"> Mostrando os valores de 0 a 5&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d_normal</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$exp( Normal(0,1) )$ </span><span class="se">\n</span><span class="s1"> Log Normal gerada na mão&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>


<span class="n">ax4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d_lognormal</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histograma da distribuição lognormal </span><span class="se">\n</span><span class="s1"> Gerada usando Numpy&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ajustar as distâncias entre os gráficos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_47_0.png" src="_images/parte_3_47_0.png" />
</div>
</div>
<p>Com a lognormal introduzida, iremos trocar a distribuição da a priori de <span class="math notranslate nohighlight">\(\beta \sim Normal(0, 10)\)</span> para uma priori que é distribuída conforme uma <span class="math notranslate nohighlight">\(\beta \sim lognormal(0, 1)\)</span>.</p>
<p>Assim como antes, vamos simular para entender o novo comportamento da nossa priori.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==========================================</span>
<span class="c1">#     Simulando a priori com log-normal</span>
<span class="c1"># ==========================================</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># A quantidade de vezes que iremos simular os dados da priori</span>

<span class="n">alpha_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">beta_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>  <span class="c1"># Priori lognormal(0, 1)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">alpha_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span> <span class="c1"># (x_i - x_bar)</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha inferior vermelha: Altura óvulo fertilizado (0cm)  </span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha superior vermelha: Pessoa mais alta do mundo (272 cm)</span>
  
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Pessoa mais alta já registrada </span><span class="se">\n</span><span class="s1">              (272 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">280</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Altura do Embrião </span><span class="se">\n</span><span class="s1">           (0 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Priori: $alpha + beta * x_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altura $h_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Peso $x_i$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_49_0.png" src="_images/parte_3_49_0.png" />
</div>
</div>
<p>Nós ainda temos muita dispersão e também temos ainda algumas poucas linhas que ultrapassam a maior altura já registrada (de <span class="math notranslate nohighlight">\(272 cm\)</span>). Isso acontece pois não limitamos a nossa margem superior pela distribuição de <span class="math notranslate nohighlight">\(\beta\)</span>. Mas essa nossa nova abordagem parece ser uma priori bem mais condizente com o que podemos imaginar.</p>
</div>
<div class="section" id="aproximacao-da-posteriori">
<h3>Aproximação da posteriori<a class="headerlink" href="#aproximacao-da-posteriori" title="Permalink to this headline">¶</a></h3>
<p>Vamos fazer a aproximação da posteriori usando a Stan e verificar os resultados.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =================================================================</span>
<span class="c1">#   Aproximando a posteriori da altura usando o peso da pessoa</span>
<span class="c1"># =================================================================</span>

<span class="n">modelo_altura_2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        real x_barra;</span>
<span class="s2">        real altura[N];</span>
<span class="s2">        real peso[N];</span>
<span class="s2">    }</span>

<span class="s2">    parameters {</span>
<span class="s2">        real alpha;</span>
<span class="s2">        real&lt;lower=0&gt; beta;</span>
<span class="s2">        real&lt;lower=0&gt; sigma;</span>
<span class="s2">    }</span>

<span class="s2">    model {</span>
<span class="s2">        // alpha ~ normal(178, 20);</span>
<span class="s2">        // beta ~ lognormal(0, 1);</span>
<span class="s2">        // sigma ~ uniform(0, 50);</span>

<span class="s2">        for (i in 1:N){</span>
<span class="s2">            altura[i] ~ normal(alpha +  beta * (peso[i] - x_barra), sigma);</span>
<span class="s2">        }</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># Nossa amostra é apenas para pessoas acima de 18 anos</span>
<span class="n">df_maioridade</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">]]</span>

<span class="c1"># Definindo as variáveis</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_maioridade</span><span class="p">)</span>
<span class="n">x_barra</span> <span class="o">=</span> <span class="n">df_maioridade</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">altura</span> <span class="o">=</span> <span class="n">df_maioridade</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">values</span>
<span class="n">peso</span> <span class="o">=</span> <span class="n">df_maioridade</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Construindo o dicionário</span>
<span class="n">meus_dados_2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span> 
                <span class="s1">&#39;x_barra&#39;</span><span class="p">:</span> <span class="n">x_barra</span><span class="p">,</span> 
                <span class="s1">&#39;altura&#39;</span><span class="p">:</span> <span class="n">altura</span><span class="p">,</span> 
                <span class="s1">&#39;peso&#39;</span><span class="p">:</span> <span class="n">peso</span><span class="p">}</span>

<span class="c1"># Rodando o modelo</span>
<span class="n">posteriori_model_2</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">modelo_altura_2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">meus_dados_2</span><span class="p">)</span>
<span class="n">fit_altura_2</span> <span class="o">=</span> <span class="n">posteriori_model_2</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#  Modelo calculado na Stan</span>
<span class="c1"># =============================</span>

<span class="c1"># Recuperando os parâmetros</span>
<span class="n">alpha_posteriori</span> <span class="o">=</span> <span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_posteriori</span> <span class="o">=</span> <span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resumo das posterioris:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Media alpha: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">1</span><span class="p">),</span> 
     <span class="s1">&#39; - Desvio Padrão alpha: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Média beta:  &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">),</span>
      <span class="s1">&#39; - Desvio Padrão beta:  &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Média sigma: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">),</span> 
      <span class="s1">&#39; - Desvio Padrão sigma: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>


<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha_posteriori</span><span class="p">)</span>  <span class="c1"># Plotar todas as curvas estimadas</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># Plotar as 100 primeiras curvas</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Modelo linear </span><span class="se">\n</span><span class="s1"> Posteriori da Altura&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Altura&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Peso&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">alpha_posteriori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_posteriori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span> 
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># ==========================================</span>
<span class="c1">#    Plot todas as variáveis  estimadas</span>
<span class="c1"># ==========================================</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori alpha&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequência&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori beta&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequência&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Beta&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori sigma&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequência&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sigma&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ajustar as distâncias entre os gráficos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resumo das posterioris:
============================================================
Media alpha:  154.6  - Desvio Padrão alpha:  0.268
Média beta:   0.904  - Desvio Padrão beta:   0.042
Média sigma:  5.105  - Desvio Padrão sigma:  0.194
</pre></div>
</div>
<img alt="_images/parte_3_53_1.png" src="_images/parte_3_53_1.png" />
<img alt="_images/parte_3_53_2.png" src="_images/parte_3_53_2.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="parte_2.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">2 - Engenharia de Golems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="parte_4.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">4 - Funções Wiggly</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Rodolpho Macedo dos Santos<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>