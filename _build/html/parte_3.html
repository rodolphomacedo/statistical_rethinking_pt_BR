
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3- Modelos Geoc√™ntricos &#8212; Statistical Rethinking</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4 - Fun√ß√µes Wiggly" href="parte_4.html" />
    <link rel="prev" title="2 - Engenharia de Golems" href="parte_2.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Statistical Rethinking</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="capa.html">
   Estatistica Bayesiana
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro_pt-BR.html">
   Intro - Estat√≠stica Bayesiana (üáßüá∑)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_en.html">
   Intro - Bayesian Statistics (üá∫üá∏)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_1.html">
   1- Introdu√ß√£o
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_2.html">
   2 - Engenharia de Golems
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3- Modelos Geoc√™ntricos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_4.html">
   4 - Fun√ß√µes Wiggly
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_5.html">
   5 - Muitas Vari√°veis e os Waffles Esp√∫rios
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/parte_3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR/issues/new?title=Issue%20on%20page%20%2Fparte_3.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/rodolphomacedo/statistical_rethinking_pt_BR/main?urlpath=tree/parte_3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   3- Modelos Geoc√™ntricos
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#distribuicao-normal">
   Distribui√ß√£o Normal
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regressao-linear">
     Regress√£o Linear
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gerando-um-processo-de-flutuacao-normal">
     Gerando um processo de flutua√ß√£o normal
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#porque-a-normal">
     Porque a Normal?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perspectiva-ontologica">
     Perspectiva Ontol√≥gica
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perspectiva-epistemologica">
     Perspectiva Epistemologica
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modelos-lineares">
     Modelos Lineares
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#acordando-a-linguagem-que-iremos-trabalhar">
       Acordando a linguagem que iremos trabalhar
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linguagem-da-modelagem">
     Linguagem da modelagem
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#construindo-um-modelo-linear">
   Constru√≠ndo um Modelo Linear
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estudo-descritivo-da-base-de-dados">
     Estudo Descritivo da Base de Dados
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modelos-gaussianos">
     Modelos Gaussianos
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adicionando-prioris">
     Adicionando prioris
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulacao-a-partir-da-priori">
     Simula√ß√£o a partir da priori
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculando-a-posteriori-conjunta">
     Calculando a Posteriori Conjunta
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aproximacao-quadratica">
     Aproxima√ß√£o Quadr√°tica
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimando-a-altura-usando-a-stan">
     Estimando a altura usando a Stan
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adicionando-uma-variavel-preditora">
     Adicionando uma vari√°vel Preditora
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#explicando-o-modelo-acima">
       Explicando o modelo acima:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribuicao-priori-preditiva">
     Distribui√ß√£o Priori Preditiva
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#distribuicao-preditiva-da-priori">
       Distribui√ß√£o Preditiva da Priori
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#aproximacao-da-posteriori">
         Aproxima√ß√£o da posteriori
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resumo">
   Resumo
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="modelos-geocentricos">
<h1>3- Modelos Geoc√™ntricos<a class="headerlink" href="#modelos-geocentricos" title="Permalink to this headline">¬∂</a></h1>
</div>
<div class="section" id="distribuicao-normal">
<h1>Distribui√ß√£o Normal<a class="headerlink" href="#distribuicao-normal" title="Permalink to this headline">¬∂</a></h1>
<img alt="gauss" src="_images/Gauss.jpg" />
<p>fonte: <a class="reference external" href="https://pt.wikipedia.org/wiki/Marco_alem%C3%A3o">wikipedia</a></p>
<p>fonte: <a class="reference external" href="https://www.bis-ans-ende-der-welt.net/Deutschland-B.htm">Distribui√ß√£o Gausiana</a></p>
<p><a class="reference external" href="https://www.youtube.com/watch?v=h5aPo5wXN8E">Aula - Statistical Rethinking Winter 2019 Lecture 03</a></p>
<div class="section" id="regressao-linear">
<h2>Regress√£o Linear<a class="headerlink" href="#regressao-linear" title="Permalink to this headline">¬∂</a></h2>
<p>S√£o simples <em>golems</em> estat√≠sticos.</p>
<ul class="simple">
<li><p>Modelo de m√©dia e vari√¢ncia normalmente (Gaussiano) distribu√≠do.</p></li>
<li><p>M√©dia como uma combina√ß√£o aditiva dos pesos das var√°veis que a comp√µem.</p></li>
<li><p>Vari√¢ncia √© constante.</p></li>
</ul>
</div>
<div class="section" id="gerando-um-processo-de-flutuacao-normal">
<h2>Gerando um processo de flutua√ß√£o normal<a class="headerlink" href="#gerando-um-processo-de-flutuacao-normal" title="Permalink to this headline">¬∂</a></h2>
<p>Atrav√©s da flutua√ß√£o normal <em>(sobe 1 ou desce 1)</em> iremos construir um processo que tenha como resultante natural o surgimento de um comportamento cuja distribui√ß√£o podemos descrever como a normal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Necess√°rio para desbloquear o asyncio no Jupyter</span>

<span class="c1"># Fonte: https://pystan.readthedocs.io/en/latest/faq.html</span>
<span class="c1"># Fonte: https://github.com/microsoft/playwright-python/issues/178</span>

<span class="c1"># Docs Pystan: https://pystan.readthedocs.io/en/latest/index.html</span>

<span class="c1"># -------------</span>
<span class="c1"># Instalar nest_asyncio: pip install nest_asyncio - Est√°ra no requirements.txt</span>
<span class="c1"># Vers√µes </span>
<span class="c1"># python==3.8.0</span>
<span class="c1"># numpy==1.21.1</span>
<span class="c1"># pystan==3.2.0</span>
<span class="c1"># nest_asyncio==1.5.1</span>
<span class="c1"># -------------</span>

<span class="c1"># Rodar esse comando antes de import a stan (pystan vers√£o 3.x)</span>
<span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construindo um passeio conforme a distribui√ß√£o Bernoulli(0.5) em +1 ou -1</span>

<span class="n">n_linhas</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># Quantas linhas iremos simular?</span>
<span class="n">n_passos</span> <span class="o">=</span> <span class="mi">30</span>   <span class="c1"># Quantidade de passos que iremos simular?</span>

<span class="n">corte_1</span> <span class="o">=</span> <span class="mi">3</span>   <span class="c1"># Indica o primeiro corte no passeio</span>
<span class="n">corte_2</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># Indica o segundo corte no passeio</span>
<span class="n">corte_3</span> <span class="o">=</span> <span class="mi">26</span>  <span class="c1"># Indica o terceiro corte no passeio</span>

<span class="n">aleatorizar_grafico</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># True para ver a simula√ß√£o um pouco mais aleatorizada visualmente. False para ver sem efeito.</span>

<span class="n">passeios</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Armazenar todos os passeios gerados num array</span>

<span class="c1"># Par√¢metros da simula√ß√£o</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>  <span class="c1"># Alterando a cor de fundo, para ficar mais elegante. </span>

<span class="k">for</span> <span class="n">linha</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_linhas</span><span class="p">):</span>  <span class="c1"># Quantas linhas iremos plotar</span>
    
    <span class="n">passeio</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Inicializando todos os pontos com o valor 0 (conforme dito acima!)</span>
    <span class="n">novo_ponto</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># vari√°vel de controle </span>
    
    <span class="k">for</span> <span class="n">passo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_passos</span><span class="p">):</span>  <span class="c1"># Quantos passos iremos simular?</span>
        
        <span class="k">if</span> <span class="n">aleatorizar_grafico</span><span class="p">:</span>
            <span class="c1"># +1 (subida) ou -1 (descida) - Com efeito de aleatorizac√£o (apenas para melhorar a visualiza√ß√£o).</span>
            <span class="n">novo_ponto</span> <span class="o">=</span> <span class="n">novo_ponto</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>    
            <span class="c1"># +1 (subida) ou -1 (descida) - Sem efeito de aleatorizac√£o - &quot;Pixelizado&quot;</span>
            <span class="n">novo_ponto</span> <span class="o">=</span> <span class="n">novo_ponto</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
        
        <span class="n">passeio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">novo_ponto</span><span class="p">)</span>
    
    <span class="n">passeios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">passeio</span><span class="p">)</span>  <span class="c1"># Armazendo todas as linhas geradas</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">linha</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Plotando a linha gerada</span>
    
<span class="c1"># Retas horizontais dos cortes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">corte_1</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>  <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">corte_2</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">corte_3</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Configurando infos do gr√°fico    </span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Passeio Aleat√≥rio {+1, -1} com p(0.5)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;N√∫mero de passos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">passeios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">passeios</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Transpondo os vetores de passeios para ajuste na plotagem.</span>

<span class="c1"># ------------</span>
<span class="c1"># Gerando os histogramas de todas as linhas para alguns passos espec√≠ficos ao longo do passeio.</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">corte_1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograma </span><span class="se">\n</span><span class="s2"> Normalmente distribu√≠do </span><span class="se">\n</span><span class="s2">  passo &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corte_1</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">corte_2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograma </span><span class="se">\n</span><span class="s2"> Normalmente distribu√≠do </span><span class="se">\n</span><span class="s2">  passo &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corte_2</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">corte_3</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograma </span><span class="se">\n</span><span class="s2"> Normalmente distribu√≠do </span><span class="se">\n</span><span class="s2"> passo &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corte_3</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>      
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_9_0.png" src="_images/parte_3_9_0.png" />
<img alt="_images/parte_3_9_1.png" src="_images/parte_3_9_1.png" />
</div>
</div>
<p>Todas as flutua√ß√µes geradas se equilibriam entre si, gerando assim uma curva sim√©trica. Por√©m cada uma delas individualmente, e n√£o necessariamente, se equilibram entre si. Isso √© a <span class="math notranslate nohighlight">\(Normal\)</span>!</p>
</div>
<div class="section" id="porque-a-normal">
<h2>Porque a Normal?<a class="headerlink" href="#porque-a-normal" title="Permalink to this headline">¬∂</a></h2>
<p>O interessante, e frustrante ao mesmo tempo, √© que mesmos n√≥s sabendo como cada uma das curvas s√£o geradas, n√£o temos acesso a <code class="docutils literal notranslate"><span class="pre">como</span> <span class="pre">cada</span> <span class="pre">uma</span> <span class="pre">delas</span> <span class="pre">individualmente</span> <span class="pre">faz</span> <span class="pre">o</span> <span class="pre">seu</span> <span class="pre">percurso</span></code>, pois temos muito pouca informa√ß√£o sobre como √© o processo gerador dessas curvas.</p>
<p>Assim, quando vimos um comportamento de um evento que √© normalmente distribu√≠do, por exemplo, n√£o sabemos o que tem la dentro! N√£o temos um acesso intuitivo da informa√ß√£o contida no comportamento individual de cada passeio.</p>
<p>Mas sabendo que o processo como um todo tem o comportamento, aproximadamente, normalmente distribu√≠do, podemos usar essa informa√ß√£o para falsificar ou n√£o hip√≥teses de um estudo particular.</p>
<div class="math notranslate nohighlight">
\[ x \sim normal(\mu, \sigma) \]</div>
<p>E isso √© muito legal, pois podemos descrever o processo como um todo, com apenas por dois n√∫meros, pois toda a informa√ß√£o do funcionamento da maquinaria subjacente do processo foi eliminada. E tudo que foi preservado foi a m√©dia (<span class="math notranslate nohighlight">\(\mu\)</span>) e o desvio padr√£o (<span class="math notranslate nohighlight">\(\sigma\)</span>), por isso que precisamos apenas desses dois n√∫meros para descrever uma distribui√ß√£o normal.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Essa √© toda a informa√ß√£o que conseguimos extrair da maquinaria subjacente, a Natureza!</p>
</div>
<p>O mais terr√≠vel √© que n√£o podemos saber o funcionamento do processo a partir de um simples histograma! Temos que realmente fazer ci√™ncia para isso, temos de <em>cavar mais fundo</em>, <em>medir coisas mais dif√≠ceis</em> para <code class="docutils literal notranslate"><span class="pre">s√≥</span> <span class="pre">assim</span></code> descobrir mais algumas coisas nas profundezas do mecanismo de gera√ß√£o do processo.</p>
<p>Isso √© verdade n√£o apenas para a <span class="math notranslate nohighlight">\(Normal\)</span>, mas para muitas outras distribui√ß√µes! Todas as distribui√ß√µes de m√°xima entropia tem essa mesma propriedade, que muitos processos diferentes possuem a mesma distribui√ß√£o de frequ√™ncias.</p>
</div>
<div class="section" id="perspectiva-ontologica">
<h2>Perspectiva Ontol√≥gica<a class="headerlink" href="#perspectiva-ontologica" title="Permalink to this headline">¬∂</a></h2>
<p>Ontologia √© o ramo da filosofia que <code class="docutils literal notranslate"><span class="pre">estuda</span> <span class="pre">a</span> <span class="pre">natureza</span> <span class="pre">do</span> <span class="pre">ser</span></code>, da exist√™ncia e da pr√≥pria realidade. Vamos observar a distribui√ß√£o <span class="math notranslate nohighlight">\(Normal\)</span> sobre uma perspectiva ontol√≥gia:</p>
<ul class="simple">
<li><p>Processo que adiciona flutua√ß√µes amortecidas como resultado.</p></li>
<li><p>As flutua√ß√µes amortecidas se aproximam de uma gaussiana.</p></li>
<li><p>Mas nenhuma informa√ß√£o sobrou do processo gerador, apenas a m√©dia e a vari√¢ncia.</p></li>
<li><p>N√£o podemos inferir o processo a partir dessa distribui√ß√£o.</p></li>
</ul>
<p>Se quisermos construir um modelo visando responder de modo mais conservador poss√≠vel, no qual tudo que estiver disposto a dizer sobre algum conjunto de medidas, como medida de alturas, √© que eles t√™m vari√¢ncia finita e podemos usar a distribui√ß√£o gaussiana.</p>
<p>Mesmo se eles forem distorcidos ou alguma outras coisas, a distribui√ß√£o gaussiana cobrir√° uma faixa mais ampla de valores do que qualquer outra com a mesma m√©dia e a mesma vari√¢ncia!</p>
<p>Essa √© a distribui√ß√£o mais √© conservadora que podemos assumir. Qualquer outra distribui√ß√£o ser√° mais restrita por isso ter√° mais informa√ß√£o incorporada, por isso a op√ß√£o mais conservadora que podemos propor √© a <code class="docutils literal notranslate"><span class="pre">gaussiana</span></code>, no qual tudo que precisamos para ela √© a m√©dia a vari√¢ncia. (<em>Isso ser√° demostrado mais para frente no curso</em>.)</p>
</div>
<div class="section" id="perspectiva-epistemologica">
<h2>Perspectiva Epistemologica<a class="headerlink" href="#perspectiva-epistemologica" title="Permalink to this headline">¬∂</a></h2>
<p>Epistemologia, tamb√©m conhecida como a Teoria do Conhecimento, √© o ramo da filosofia que estuda como o ser humano ou a pr√≥pria ci√™ncia adquire e justifica seus conhecimentos. Vamos observar a <span class="math notranslate nohighlight">\(Normal\)</span> sobre essa perspectiva:</p>
<ul class="simple">
<li><p>Conhecemos apenas a m√©dia e a vari√¢ncia.</p></li>
<li><p>A menos surpreendente e mais conservadora (<em>m√°xima entropia</em>) distribui√ß√£o gaussiana.</p></li>
<li><p>√â a distribui√ß√£o natural da m√°xima entropia.</p></li>
</ul>
</div>
<div class="section" id="modelos-lineares">
<h2>Modelos Lineares<a class="headerlink" href="#modelos-lineares" title="Permalink to this headline">¬∂</a></h2>
<p>‚Äú<strong>Modelo lineares generalizados</strong>‚Äù: teste <em>t</em>, regress√£o simples, regress√£o multipla, ANOVA, ANCOVA, MANOVA, MANCOVA, etc, etc, etc. Todos esses modelos <code class="docutils literal notranslate"><span class="pre">s√£o</span> <span class="pre">a</span> <span class="pre">mesma</span> <span class="pre">coisa,</span> <span class="pre">s√£o</span> <span class="pre">todos</span> <span class="pre">modelos</span> <span class="pre">os</span> <span class="pre">lineares</span></code>.</p>
<p>A seguir, iremos construir modelos lineares manualmente e do zero para entendermos como √© o processo de pensamento de constru√ß√£o de hip√≥teses e, tamb√©m, iremos construir um gr√°fico no qual iremos visualizar a nossa incerteza do sistema.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Iremos aprender estrat√©gias e n√£o procedimentos!</p>
</div>
<div class="section" id="acordando-a-linguagem-que-iremos-trabalhar">
<h3>Acordando a linguagem que iremos trabalhar<a class="headerlink" href="#acordando-a-linguagem-que-iremos-trabalhar" title="Permalink to this headline">¬∂</a></h3>
<p>Relembrando o primeiro modelo que n√≥s fizemos anteriormente, o lan√ßamento do globo, n√≥s tinhamos:</p>
<div class="math notranslate nohighlight">
\[ w \sim Binomial(N, p) \]</div>
<div class="math notranslate nohighlight">
\[ p \sim Uniform(0, 1) \]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(w\)</span>: Resultado</p></li>
<li><p><span class="math notranslate nohighlight">\(\sim\)</span>: ‚Äú<em>√â distribu√≠do como‚Ä¶</em>‚Äù</p></li>
<li><p><span class="math notranslate nohighlight">\(Binomial( N, p)\)</span>: √â a fun√ß√£o de distribui√ß√£o de probabilidade dos dados (verossimilhan√ßa, ou <em>likelihood</em> no ingl√™s)</p></li>
<li><p><span class="math notranslate nohighlight">\(p\)</span>: √â o par√¢metro que iremos estimar</p></li>
<li><p><span class="math notranslate nohighlight">\(Uniform(0, 1)\)</span>: Nossa distribui√ß√£o <em>√† priori</em></p></li>
</ul>
<p>No exemplo do lan√ßamento do globo, o que est√°vamos interessados em saber era a propor√ß√£o de √°gua na superf√≠cie (<span class="math notranslate nohighlight">\(p\)</span>) da Terra. O processo que usamos para coletar os dados, a amostragem, automaticamente nos prop√µem, de modo quase impositivo, a utiliza√ß√£o da estrutura Binomial.</p>
<p>A estrutura que distribui os dados binominalmente, nada mais √© do que a contagem do n√∫mero de vezes que √© poss√≠vel acontecer tal fato, dado que a propor√ß√£o <span class="math notranslate nohighlight">\(p\)</span> √© fixa para todas √†s vezes <span class="math notranslate nohighlight">\(N\)</span> que iremos retirar uma amostra.</p>
<hr class="docutils" />
<p>Essa √© a linguagem que iremos usar nesse curso. A nota√ß√£o matem√°tica padr√£o, na qual consiste em uma maneira de comunicar a todos os nossos colegas de trabalho o que foi pensado, quais foram as suposi√ß√µes, quais foram as hip√≥teses (isto √©, as sugest√µes) e, tamb√©m, qual a estrutura foi proposta para um poss√≠vel caminho para se entender o problema.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A linguagem matem√°tica ser√° a forma de comunicar ao mundo sua forma de pensar!</p>
</div>
</div>
</div>
<div class="section" id="linguagem-da-modelagem">
<h2>Linguagem da modelagem<a class="headerlink" href="#linguagem-da-modelagem" title="Permalink to this headline">¬∂</a></h2>
<p>Do mesmo modo que escrevemos o modelo acima iremos escrever todos os outros modelos, inclusive, a programa√ß√£o usando a linguagem probabil√≠stica <code class="docutils literal notranslate"><span class="pre">Stan</span></code>, o qual tem a sua sintaxe pr√≥xima a esse formato.</p>
<p>Para qualquer modelo que iremos elaborar, seja uma regress√£o linear simples ou modelos mais elaborados, temos que criar uma lista com todas as vari√°veis que ir√£o participar desse modelo. Algumas <code class="docutils literal notranslate"><span class="pre">coisas</span> <span class="pre">que</span> <span class="pre">iremos</span> <span class="pre">observar</span> <span class="pre">nos</span> <span class="pre">dados</span></code>, como a contagem do n√∫mero de vezes que o globo foi lan√ßado. E tamb√©m haver√° outras <code class="docutils literal notranslate"><span class="pre">coisas</span> <span class="pre">que</span> <span class="pre">n√£o</span> <span class="pre">vamos</span> <span class="pre">poder</span> <span class="pre">observar</span></code>, como a inclina√ß√£o de uma reta de uma modelo linear simples, ou propor√ß√£o de √°gua no globo, pois elas n√£o s√£o entidades observ√°veis.</p>
<p>Por isso temos que listar todas as vari√°veis e ent√£o defini-las.</p>
<p>Listando as vari√°veis:</p>
<div class="math notranslate nohighlight">
\[ y_i \]</div>
<div class="math notranslate nohighlight">
\[ \mu_i \]</div>
<div class="math notranslate nohighlight">
\[ \beta \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \]</div>
<div class="math notranslate nohighlight">
\[ x_i \]</div>
<p>Um modelo de regress√£o, assim como qualquer outro modelo, ser√° escrito da mesma forma que vimos anteriormente, por√©m esse modelo ter√° muito mais s√≠mbolos pois temos muito mais vari√°veis participando da explica√ß√£o, <code class="docutils literal notranslate"><span class="pre">mas</span> <span class="pre">√©</span> <span class="pre">a</span> <span class="pre">mesma</span> <span class="pre">coisa</span></code>, apenas precisamos definir a cada um desses s√≠mbolos.</p>
<p>O motor dos modelos de regress√£o linear √© a segunda linha da defini√ß√£o abaixo (<em>a seguir iremos construir esse modelo desde o in√≠cio</em>):</p>
<div class="math notranslate nohighlight">
\[ y_i \sim Normal(\mu_i, \sigma) \]</div>
<div class="math notranslate nohighlight">
\[ \mu_i = \beta x_i \]</div>
<div class="math notranslate nohighlight">
\[ \beta \sim Normal(0, 10) \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim Exponencial(1) \]</div>
<div class="math notranslate nohighlight">
\[ x_i \sim Normal(0, 1) \]</div>
<p>Essa segunda linha,  <span class="math notranslate nohighlight">\( \mu_i = \beta x_i \)</span>, geralmente a parte que √© mais confusa para se entender (iremos ver um exemplo a seguir), mas ela significa que m√©dia da distribui√ß√£o normal de cima (m√©dia do <span class="math notranslate nohighlight">\(y_i\)</span>) √© geralmente definida por uma equa√ß√£o, o que define em termos de alguma outra vari√°vel que observamos, <span class="math notranslate nohighlight">\(x_i\)</span>.</p>
<p>O <span class="math notranslate nohighlight">\(x_i\)</span> √© uma vari√°vel que ajuda a explicar o comportamento do <span class="math notranslate nohighlight">\(y_i\)</span>, ou seja, <span class="math notranslate nohighlight">\(x_i\)</span> √© uma vari√°vel explicativa.</p>
<p>Mas repare que <span class="math notranslate nohighlight">\(x_i\)</span> tamb√©m tem uma distribui√ß√£o, n√≥s normalmente n√£o nos preocupamos em definir uma distribui√ß√£o para as vari√°veis explicativas, pois n√£o iremos prev√™-las, <code class="docutils literal notranslate"><span class="pre">por√©m</span> <span class="pre">existe</span> <span class="pre">uma</span> <span class="pre">grande</span> <span class="pre">vantagem</span> <span class="pre">em</span> <span class="pre">fazer</span> <span class="pre">essas</span> <span class="pre">suposi√ß√µes</span> <span class="pre">de</span> <span class="pre">distribui√ß√£o</span></code>, pois podemos fazer coisas muito legais com esse fato, iremos ver essas coisas mais √† frente, tais como <code class="docutils literal notranslate"><span class="pre">medidas</span> <span class="pre">de</span> <span class="pre">erros</span></code> e tamb√©m <code class="docutils literal notranslate"><span class="pre">dados</span> <span class="pre">faltantes</span></code>.</p>
<p>Assim, como todas as vari√°veis t√™m sua pr√≥pria defini√ß√£o de distribui√ß√£o, se voc√™ n√£o sabe algo sobre algumas delas podemos colocar dentro do modelo e assim iremos ganhar automaticamente um poder inferencial do que est√°vamos perdendo antes.</p>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="construindo-um-modelo-linear">
<h1>Constru√≠ndo um Modelo Linear<a class="headerlink" href="#construindo-um-modelo-linear" title="Permalink to this headline">¬∂</a></h1>
<p>Com o conjunto de dados amostrados de uma popula√ß√£o, extra√≠da do livro da <em>Nancy Howel</em>, <code class="docutils literal notranslate"><span class="pre">Life</span> <span class="pre">history</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">DOBE</span> <span class="pre">!KUNG</span></code>, um novo cl√°ssico de demografia evolucion√°ria, dispon√≠vel no pacote R <em>rethinking</em> e suas vers√µes variantes. (Nesse material temos uma c√≥pia do link <a class="reference external" href="https://github.com/rmcelreath/rethinking">Rethinking - R-library - GitHub</a>.</p>
<img alt="Dobe !Kung" src="_images/dobe_kung.jpg" />
<div class="section" id="estudo-descritivo-da-base-de-dados">
<h2>Estudo Descritivo da Base de Dados<a class="headerlink" href="#estudo-descritivo-da-base-de-dados" title="Permalink to this headline">¬∂</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/Howell1.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>  <span class="c1"># Banco de dados do pacote Rethinking - Dispon√≠vel no Github</span>

<span class="c1"># Just adults</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span> <span class="p">]</span>

<span class="c1"># =======================================</span>
<span class="c1"># P√°gina 86</span>
<span class="c1"># Overthinking: Sample size and the normality  of sigma&#39;s posterior</span>
<span class="c1"># Note que, no gr√°fico posteriori da conjunta, o sigma n√£o √© normal.</span>
<span class="n">overthinking_test</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">qtd_sampled</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># Amostragem dos dados</span>
<span class="k">if</span> <span class="n">overthinking_test</span><span class="p">:</span>
    <span class="n">sample_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">qtd_sampled</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_df</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1"># =======================================</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>  <span class="c1"># Resumo do banco de dados</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           height      weight         age        male
count  352.000000  352.000000  352.000000  352.000000
mean   154.597093   44.990486   41.138494    0.468750
std      7.742332    6.456708   15.967855    0.499733
min    136.525000   31.071052   18.000000    0.000000
25%    148.590000   40.256290   28.000000    0.000000
50%    154.305000   44.792210   39.000000    0.000000
75%    160.655000   49.292693   51.000000    1.000000
max    179.070000   62.992589   88.000000    1.000000
</pre></div>
</div>
</div>
</div>
<p>Nosso conjunto de dados cont√©m um total de <span class="math notranslate nohighlight">\(544\)</span> indiv√≠duos, abaixo temos um histograma descritivo das quatro vari√°veis da base:</p>
<ul class="simple">
<li><p>Altura (<em>height</em>)</p></li>
<li><p>Peso (<em>weight</em>)</p></li>
<li><p>Idade (<em>Age</em>)</p></li>
<li><p>G√™nero (<em>male</em>) - Definido <span class="math notranslate nohighlight">\(1\)</span> para homens e <span class="math notranslate nohighlight">\(0\)</span> para mulheres</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotando os histogramas</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],</span> <span class="p">[</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Histograma de todos os dados da altura (height)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Altura das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Histograma de todos os dados do peso (weight)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Peso das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Kg&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Histograma de todos os dados da idade (age)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Idade das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Anos&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Histograma de todos os dados da g√™nero (male)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">male</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;G√™nero das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Feminino       -      Masculino&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_22_0.png" src="_images/parte_3_22_0.png" />
</div>
</div>
</div>
<div class="section" id="modelos-gaussianos">
<h2>Modelos Gaussianos<a class="headerlink" href="#modelos-gaussianos" title="Permalink to this headline">¬∂</a></h2>
<p>Vamos propor um primeiro modelo, abaixo temos a um modelo <span class="math notranslate nohighlight">\(Normal\)</span>:</p>
<div class="math notranslate nohighlight">
\[ h_i \sim Normal(\mu, \sigma) \]</div>
<p>A altura <span class="math notranslate nohighlight">\(h\)</span> do indiv√≠duo <span class="math notranslate nohighlight">\(i\)</span> ser√° distribu√≠do normalmente, com uma m√©dia <span class="math notranslate nohighlight">\(\mu\)</span> e o desvio padr√£o <span class="math notranslate nohighlight">\(\sigma\)</span>.</p>
<hr class="docutils" />
<p>Estamos usando as letras gregas <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>, por conven√ß√£o de linguagem, mas nada nos impede de usarmos quaisquer outros s√≠mbolos. N√£o haver√° nenhum problema, <code class="docutils literal notranslate"><span class="pre">apenas</span> <span class="pre">iremos</span> <span class="pre">irritar</span> <span class="pre">alguns</span> <span class="pre">estat√≠sticos</span></code>, mas isso ser√° mais um <em>b√¥nus</em>!</p>
<p>Aqui √© necess√°rio que voc√™ saiba ler e entender o que isso significa, s√≥ assim voc√™ aprender√° o que est√° acontecendo. Lembre-se isso √© <code class="docutils literal notranslate"><span class="pre">apenas</span> <span class="pre">uma</span> <span class="pre">linguagem</span></code>, isso n√£o √© um c√≥digo. √â apenas uma forma de comunica√ß√£o, ou seja, √© uma comunica√ß√£o cient√≠fica.</p>
<hr class="docutils" />
<p>Aqui temos duas vari√°veis para estimar, <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>, e teremos que inferir a partir de <span class="math notranslate nohighlight">\(h\)</span>, das coisas que medimos, mas <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span> precisam de defini√ß√µes por que esse √© um modelo bayesiano.</p>
</div>
<div class="section" id="adicionando-prioris">
<h2>Adicionando prioris<a class="headerlink" href="#adicionando-prioris" title="Permalink to this headline">¬∂</a></h2>
<p>Agora vamos definir uma priori para os par√¢metros da <span class="math notranslate nohighlight">\(Normal\)</span>, o <span class="math notranslate nohighlight">\(\mu\)</span> e o <span class="math notranslate nohighlight">\(\sigma\)</span>:</p>
<div class="math notranslate nohighlight">
\[ h_i \sim Normal(\mu, \sigma) \]</div>
<div class="math notranslate nohighlight">
\[ \mu \sim Normal(178, 20) \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim Uniform(0, 50) \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotando a distribui√ß√£o √† priori do mu e do sigma</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">x_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x_sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

<span class="c1"># Priori do mu</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_mu</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_mu</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Priori de $\mu$ </span><span class="se">\n</span><span class="s1"> Normal(178, 20)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1">#Priori do Sigma</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_sigma</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_sigma</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Priori de $\sigma$ </span><span class="se">\n</span><span class="s1"> Uniforme(0, 50)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_25_0.png" src="_images/parte_3_25_0.png" />
</div>
</div>
<p>Qual √© a implica√ß√£o de usar essas distribui√ß√µes para <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>?</p>
<p>O valor <span class="math notranslate nohighlight">\(178\)</span> foi escolhido para ser a m√©dia da distribui√ß√£o normal (<em>√† priori</em>), esse valor foi escolhido por <code class="docutils literal notranslate"><span class="pre">acharmos</span></code> que poderia ser a altura m√©dia da popula√ß√£o, e com isso adicionamos uma generosa incerteza (<em>incerteza da m√©dia</em>) de <span class="math notranslate nohighlight">\(20\)</span> (gr√°fico da esquerda).</p>
<p>Para o <span class="math notranslate nohighlight">\(\sigma\)</span> colocamos qualquer valor entre <span class="math notranslate nohighlight">\(0\)</span> at√© <span class="math notranslate nohighlight">\(50\)</span> (gr√°fico da direita), esses valores t√™m igual probabilidade de ocorrer, esse √© um range bastante razo√°vel j√° que <span class="math notranslate nohighlight">\(50\)</span> √© um valor bem mais alto do que podemos esperar para o desvio padr√£o, pois n√£o temos uma nenhuma informa√ß√£o mais razo√°vel para colocar como priori (no mundo real certamente saber√≠amos um pouco mais).</p>
</div>
<div class="section" id="simulacao-a-partir-da-priori">
<h2>Simula√ß√£o a partir da priori<a class="headerlink" href="#simulacao-a-partir-da-priori" title="Permalink to this headline">¬∂</a></h2>
<p>O que essas <code class="docutils literal notranslate"><span class="pre">prioris</span></code> est√£o implicando sobre a estimativa da altura, antes de vermos os dados (<span class="math notranslate nohighlight">\(h\)</span>)?</p>
<p>Para saber, vamos Simular! <code class="docutils literal notranslate"><span class="pre">Distribui√ß√£o</span> <span class="pre">√†</span> <span class="pre">Priori</span> <span class="pre">Preditiva</span></code>.</p>
<p>Simular os dados apenas das prioris nos permitir√° entender se, do modo como estamos <em>ensinando</em> o modelo, seu resultado est√° sendo satisfat√≥rio.</p>
<p>Vamos simular!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================================================</span>
<span class="c1"># Construindo o processo de amostragem da distribui√ß√£o √† priori preditiva.</span>
<span class="c1">#                *** Priori vers√£o com dados absurdos  ***</span>
<span class="c1"># ========================================================================</span>

<span class="c1"># Amostragem</span>
<span class="n">amostra_mu</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Normal(178, 20) estimativa para mu.</span>
<span class="n">amostra_sigma</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Uniforme(0, 50) estimativa para sigma.</span>

<span class="n">amostra_h_priori</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">amostra_mu</span><span class="p">,</span> <span class="n">amostra_sigma</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>  <span class="c1"># Amostrando da Normal(mu, sigma)</span>


<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">amostra_h_priori</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">170</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribui√ß√£o Preditiva da Priori com Valores Absurdos </span><span class="se">\n</span><span class="s1"> Altura </span><span class="se">\n</span><span class="s1"> $Normal(178, 100)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;(cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 0 cm de altura, ovo fertilizado.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 272 cm de altura, pessoa mais alta da hist√≥ria. </span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_28_0.png" src="_images/parte_3_28_0.png" />
</div>
</div>
<p>Plotar o gr√°fico da <code class="docutils literal notranslate"><span class="pre">Distribui√ß√£o</span> <span class="pre">Preditiva</span> <span class="pre">da</span> <span class="pre">Priori</span></code> nos permite observar que a probabilidade, por exemplo, de algu√©m ter a altura pr√≥xima de <span class="math notranslate nohighlight">\(0 cm\)</span> √© praticamente igual a <em>zero</em>, <span class="math notranslate nohighlight">\(P\{altura = 0\}\)</span>, e ,tamb√©m, a probabilidade de uma pessoa ser maior do que <span class="math notranslate nohighlight">\(272 cm\)</span>, <span class="math notranslate nohighlight">\(P\{altura &gt;= 272\}\)</span>, que √© a <code class="docutils literal notranslate"><span class="pre">altura</span> <span class="pre">da</span> <span class="pre">pessoa</span> <span class="pre">mais</span> <span class="pre">alta</span> <span class="pre">no</span> <span class="pre">mundo</span> <span class="pre">j√°</span> <span class="pre">registrada</span></code>, √© bem baixa.</p>
<p>Imagine agora que colocaremos como √† priori valores muito absurdos para o <span class="math notranslate nohighlight">\(\sigma\)</span>, vamos ver o que acontece:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================================================</span>
<span class="c1"># Construindo o processo de amostragem da distribui√ß√£o √† priori preditiva.</span>
<span class="c1"># ========================================================================</span>

<span class="c1"># Amostragem</span>
<span class="n">amostra_mu</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Normal(178, 20) estimativa para mu.</span>
<span class="n">amostra_sigma</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Uniforme(0, 50) estimativa para sigma.</span>

<span class="n">amostra_h_priori</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">amostra_mu</span><span class="p">,</span> <span class="n">amostra_sigma</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>  <span class="c1"># Amostrando da Normal(mu, sigma)</span>


<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">amostra_h_priori</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">171</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribui√ß√£o Preditiva da Priori  </span><span class="se">\n</span><span class="s1"> Altura&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;(cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 0 cm de altura, ovo fertilizado.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 272 cm de altura, pessoa mais alta da hist√≥ria.</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_30_0.png" src="_images/parte_3_30_0.png" />
</div>
</div>
<p>Os valores de probabilidade que est√£o sendo atribu√≠dos pela distribui√ß√£o √† priori e que <code class="docutils literal notranslate"><span class="pre">est√£o</span> <span class="pre">para</span> <span class="pre">fora</span> <span class="pre">dos</span> <span class="pre">limites</span> <span class="pre">mais</span> <span class="pre">conservadores</span> <span class="pre">poss√≠veis</span></code>, n√£o deveriam ter uma import√¢ncia t√£o grande, ou seja, sua probabilidade deveria <code class="docutils literal notranslate"><span class="pre">se</span> <span class="pre">aproximar</span></code> de <em>zero</em>!</p>
<p>Esse √© um exemplo de escolha ruim para uma priori, colocando apenas um valor enorme para <span class="math notranslate nohighlight">\(\sigma\)</span> mas sem ter uma liga√ß√£o mais √≠ntima com a natureza do problema.</p>
<p>Nesse caso, <code class="docutils literal notranslate"><span class="pre">o</span> <span class="pre">caso</span> <span class="pre">univariado</span></code>, as distor√ß√µes que podem ser geradas por usarmos uma priori dessa forma √© praticamente nula, o modelo provavelmente ajustar√° bem. J√° para modelos mais complexos, como modelos mistos ou modelos hier√°rquicos com muitos par√¢metros, a utiliza√ß√£o de prioris sem muito sentido pode causar <em>s√©rias</em> distor√ß√µes nos resultados.</p>
<p>Por isso, <code class="docutils literal notranslate"><span class="pre">sempre</span> <span class="pre">simule</span> <span class="pre">a</span> <span class="pre">priori</span></code> para observar se o comportamento do modelo condiz com a realidade.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Priori: √© essa a nossa cren√ßa antes do modelo ver o dados!</p>
</div>
</div>
<div class="section" id="calculando-a-posteriori-conjunta">
<h2>Calculando a Posteriori Conjunta<a class="headerlink" href="#calculando-a-posteriori-conjunta" title="Permalink to this headline">¬∂</a></h2>
<p>Nosso objetivo √© estimar a distribui√ß√£o conjunta dos par√¢metros <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>, para isto, iremos calcular a estimativa pelo m√©todo do <em>grid de aproxima√ß√£o</em>.</p>
<div class="math notranslate nohighlight">
\[ p\{(\mu, \sigma) | h_i\} ‚àù p\{h_i | \mu, \sigma \} p\{ \mu \} p\{ \sigma \} \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Para visualiza√ß√£o das multiplica√ß√µes vamos deixar o ùúé fixo, em 20, por exemplo, </span>
<span class="c1"># e iremos variar o ùúá entre 100 e 300, para os tr√™s valores distintos de alturas (147, 155, 180).</span>

<span class="n">curva_1</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Resetando a vari√°vel curva_1 </span>
<span class="n">curva_2</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Resetando a vari√°vel curva_2</span>
<span class="n">curva_3</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Resetando a vari√°vel curva_3</span>

<span class="n">posteriori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">curva_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curva_1</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">147</span><span class="p">))</span>  <span class="c1"># Para todos os ùúá, calcular a probabilidade de ocorrer 147 com sigma fixo.</span>
    <span class="n">curva_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curva_2</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">155</span><span class="p">))</span>  <span class="c1"># Para todos os ùúá, calcular a probabilidade de ocorrer 155 com sigma fixo.</span>
    <span class="n">curva_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curva_3</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">180</span><span class="p">))</span>  <span class="c1"># Para todos os ùúá, calcular a probabilidade de ocorrer 180 com sigma fixo.</span>
    
<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Normal </span><span class="se">\n</span><span class="s1"> Para as alturas ($h_i$): {147, 155, 180} </span><span class="se">\n</span><span class="s1"> com as hip√≥teses de mu [100, 300] para a m√©dia&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;h=147&#39;</span><span class="p">,</span> <span class="s1">&#39;h=155&#39;</span><span class="p">,</span> <span class="s1">&#39;h=180&#39;</span><span class="p">])</span>

<span class="c1"># Abaixo iremos fazer a soma dos logs, ao inv√©s de multiplicar. Isso ser√° feito na pr√≥xima c√©lula.</span>
<span class="c1"># posteriori_nao_normalizada = np.log(curva_1) + np.log(curva_2) + np.log(curva_3)  # </span>
<span class="n">posteriori_nao_normalizada</span> <span class="o">=</span> <span class="n">curva_1</span> <span class="o">*</span> <span class="n">curva_2</span> <span class="o">*</span> <span class="n">curva_3</span>   <span class="c1"># Essa multiplica√ß√£o ser√° feita ponto a ponto.</span>



<span class="n">posteriori</span> <span class="o">=</span> <span class="n">posteriori_nao_normalizada</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">)</span>  <span class="c1"># Normalizando a posteriori</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">posteriori</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>  <span class="c1"># Essa multiplica√ß√£o ser√° feita ponto a ponto.</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori </span><span class="se">\n</span><span class="s1"> Usando os tr√™s valores da altura juntos ($h_i$): {147, 155, 180}&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.4&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;posteriori&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_33_0.png" src="_images/parte_3_33_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ================================</span>
<span class="c1">#     Calculando a posteriori</span>
<span class="c1"># ================================</span>

<span class="c1"># Filter only adults (&gt;= 18 years old)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">]</span>

<span class="n">grid</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Determina a precis√£o, para valores maiores demanda maior custo computacional!</span>

<span class="k">if</span> <span class="n">overthinking_test</span><span class="p">:</span>  <span class="c1"># Pag. 86 SR2</span>
    <span class="n">grid_width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">142</span><span class="p">,</span> <span class="mi">162</span><span class="p">)</span>
    <span class="n">grid_height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> 
<span class="k">else</span><span class="p">:</span>
    <span class="n">grid_width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">156</span><span class="p">)</span>
    <span class="n">grid_height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">)</span> 

<span class="n">mu_ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">grid_width</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_width</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">grid</span><span class="p">)</span>  <span class="c1"># Espa√ßo do ùúá - Esses valores foram escolhidos para uma melhor visualiza√ß√£o.</span>
<span class="n">sigma_ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">grid_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_height</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">grid</span><span class="p">)</span>  <span class="c1"># Espa√ßo do ùúé - Esses valores foram escolhidos para uma melhor visualiza√ß√£o.</span>

<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">mu_ls</span><span class="p">,</span> <span class="n">sigma_ls</span><span class="p">)</span>  <span class="c1"># Construindo um plano do ùúá vs ùúé.</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">verossimilhanca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">verossimilhanca_parcial</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="c1"># Calcular a verossimilhan√ßa para cada (ùúá, ùúé), usando todas as alturas da amostra. </span>
    <span class="n">verossimilhanca_parcial_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">verossimilhanca_parcial</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>  <span class="c1"># Calculando o log da verossimilhan√ßa</span>
    <span class="n">verossimilhanca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verossimilhanca</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">verossimilhanca_parcial_log</span><span class="p">))</span>

<span class="c1"># Adicionando a priori</span>
<span class="c1"># P{ altura | ùúá, ùúé} * P{ùúá} * P{ùúé}  ==  exp[ log(P{ altura | ùúá, ùúé}) + log(P{ùúá}) + log(P{ùúé}) ]</span>

<span class="n">posteriori_nao_normalizada</span> <span class="o">=</span> <span class="n">verossimilhanca</span> <span class="o">+</span> \
                             <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span> <span class="o">+</span> \
                             <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span>   <span class="c1"># Priori de sigma</span>
    
<span class="c1"># Explica√ß√£o na p√°gina 561, endnotes n√∫mero 73! Mais detalhes no gr√°fico abaixo.</span>
<span class="n">posteriori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">))</span>  
<span class="n">posteriori</span> <span class="o">=</span> <span class="n">posteriori</span> <span class="o">/</span> <span class="n">posteriori</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">mu_mesh</span><span class="p">,</span> <span class="n">sigma_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">mu_ls</span><span class="p">,</span> <span class="n">sigma_ls</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">mu_mesh</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sigma_mesh</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">posteriori</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">grid</span><span class="p">,</span> <span class="n">grid</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Posteriori&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">grid_width</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_width</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">grid_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_height</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_34_0.png" src="_images/parte_3_34_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Explica√ß√£o gr√°fica - N√£o faz parte do material original do curso.</span>

<span class="c1"># Porque usar (posteriori_nao_normalizada - np.max(posteriori_nao_normalizada))</span>

<span class="c1"># Como exp(-x) -&gt; 0 quando x √© muito negativo. Sem normaliza√ß√£o, todos os valores ser√£o zero.</span>

<span class="c1"># Lembrando que exp(0) = 1, por isso usar o max padroniza os valores. </span>
<span class="c1"># Ao gerar a posteriori, a escala dos valores se mantem.</span>


<span class="n">fig</span><span class="p">,</span> <span class="p">[[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],</span> <span class="p">[</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="c1"># Gr√°fico 1 e 3</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori n√£o normalizada&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Escala em Log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Posteriori n√£o normalizada&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Gr√°fico 2 e 4</span>
<span class="n">post_ajustada</span> <span class="o">=</span> <span class="p">(</span><span class="n">posteriori_nao_normalizada</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">))</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">post_ajustada</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori n√£o normalizada - Ajustada&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Escala em Log - Ajsutada&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">post_ajustada</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Posteriori n√£o normalizada - Ajustada&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_35_0.png" src="_images/parte_3_35_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =================================================================</span>
<span class="c1">#     Amostrando ùúá e o ùúé a partir da distribui√ß√£o √† posteriori.</span>
<span class="c1"># =================================================================</span>

<span class="c1"># Escolhendo pontos 1000 pontos aleat√≥rios dentro do grid com a probabilidade √† posteriori</span>
<span class="n">amostras_posteriori_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">*</span><span class="n">grid</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">posteriori</span><span class="p">)</span>

<span class="n">mu_amostrado</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>
<span class="n">sigma_amostrado</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_amostrado</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da Posteriori </span><span class="se">\n</span><span class="s1"> $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_amostrado</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da Posteriori </span><span class="se">\n</span><span class="s1"> $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_36_0.png" src="_images/parte_3_36_0.png" />
</div>
</div>
</div>
<div class="section" id="aproximacao-quadratica">
<h2>Aproxima√ß√£o Quadr√°tica<a class="headerlink" href="#aproximacao-quadratica" title="Permalink to this headline">¬∂</a></h2>
<p>A partir de agora at√© a metade do curso iremos usar a <code class="docutils literal notranslate"><span class="pre">aproxima√ß√£o</span> <span class="pre">quadr√°tica</span></code>. Se voc√™ fez os c√°lculos da posteriori para a altura, oque √© sugerido fortemente, percebemos que a complexidade e o custo computacional envolvido para estimar √†s duas vari√°veis (<span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>) s√£o bastante significativos.</p>
<p>Para modelos que necessitem estimar mais par√¢metros, <span class="math notranslate nohighlight">\(10\)</span> par√¢metros por exemplo, o custo computacional e a estrutura necess√°ria para calcular essa estimativa com o m√©todo do <em>grid de aproxima√ß√£o</em> se torna invi√°vel. Por isso temos que pensar em uma nova estrutura na qual podemos, <strong>Laplace</strong>, <span class="math notranslate nohighlight">\(1749-1827\)</span>, propor o uso da aproxima√ß√£o quadr√°tica. Com essa estrutura mais ex√≥tica, n√≥s poderemos calcular estimativas da posteriori em dimens√µes muito elevadas.</p>
<ul class="simple">
<li><p>Aproxima√ß√£o da posteriori como uma Gaussiana</p></li>
<li><p>Podemos construir essa estimativa encontrando o valor das duas seguintes coisas:</p>
<ul>
<li><p>Pelo ‚Äúpico‚Äù da posteriori, maximum a posteriori (MAP)</p></li>
<li><p>Desvio Padr√£o e a correla√ß√£o entre os par√¢metros.</p></li>
</ul>
</li>
<li><p>As estimativas s√£o bem parecidas com o que j√° fizemos, exceto que n√£o temos prioris.</p></li>
</ul>
<p>A primeira coisa que temos que olhar √© para a posteriori (<em>nos histogramas acima</em>) de <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span> e subir a colina at√© encontrar o pico da distribui√ß√£o. O computador pode come√ßar a busca por qualquer local sem saber onde est√° o pico, mas ele sabe subir a colina e ent√£o pode simplesmente subir usando o apenas o <em>gradientes descendentes</em> (ou melhor, usando o gradiente ascendente, pois iremos escalar a subida at√© o pico). Existem muitos algoritmos eficientes para fazer isso, e podemos dar a ele um espa√ßo multidimensional muito alto (bem maior que 2, como no exemplo anterior) e iremos alcan√ßar o pico.</p>
<p>Quando al√ßarmos o pico, s√≥ precisamos medir a curvatura no pico para saber a largura da colina e isso √© tudo que precisa ser feito para constru√≠mos a <code class="docutils literal notranslate"><span class="pre">aproxima√ß√£o</span> <span class="pre">quadr√°tica</span></code>. Tamb√©m conhecida por <code class="docutils literal notranslate"><span class="pre">Aproxima√ß√£o</span> <span class="pre">de</span> <span class="pre">Laplace</span></code>, por ele ter utilizado o procedimento corretamente.</p>
<img alt="Laplace" src="_images/Laplace.jpg" />
<hr class="docutils" />
<p>Fonte: <a class="reference external" href="https://fr.wikipedia.org/wiki/Pierre-Simon_de_Laplace">wikipedia</a></p>
<p>Obs: No curso original, as estimativas s√£o realizadas com a biblioteca <code class="docutils literal notranslate"><span class="pre">Rethinking</span></code> criadas e disponibilizadas pelo github do pr√≥prio professor Richard McElreath, pode ser acessado nesse endere√ßo: <a class="reference external" href="https://github.com/rmcelreath/rethinking">https://github.com/rmcelreath/rethinking</a></p>
<p>A partir daqui iremos fazer em paralelo com o curso a utiliza√ß√£o da biblioteca Stan-mc a p√°gina e a documenta√ß√£o oficial se encontram em <a class="reference external" href="https://mc-stan.org/">Stan</a></p>
<img alt="stan" src="_images/stan-logo.png" />
<p>Obs2: a estimativa da posteriori feita pela Stan utiliza algumas t√©cnicas mais robustas do que a aproxima√ß√£o quadr√°tica, por√©m no curso, essas estimativas s√£o realizadas internamente na biblioteca rethinking e √© invis√≠vel para o usu√°rio, assim, o conte√∫do dessas notas ser√£o intimamente paralelas com o curso, sendo que se ocorrer um distanciamento entre ambas trajet√≥rias, notas extras ser√£o inseridas para minimizar esse longor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">stan</span>  <span class="c1"># Importando a Stan - estamos usando a pystan</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Essa estrutura est√° definida na p√°gina 77 - SR2</span>

<span class="n">primeiro_codigo_stan</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">data {</span>
<span class="s2">    int N;</span>
<span class="s2">    real X[N];</span>
<span class="s2">}</span>

<span class="s2">parameters {</span>
<span class="s2">    real mu;</span>
<span class="s2">    real&lt;lower=0&gt; sigma;</span>
<span class="s2">}</span>

<span class="s2">model {</span>
<span class="s2">    X ~ normal(mu, sigma);</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">mu_nao_observavel</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">sigma_nao_observavel</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mu_nao_observavel</span><span class="p">,</span> <span class="n">sigma_nao_observavel</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Gerando os dados amostrais ~ Normal(50, 12)</span>
<span class="n">meus_dados</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="p">)}</span>  <span class="c1"># Constru√≠ndo um dicion√°rio com os dados</span>

<span class="n">posteriori_model</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">primeiro_codigo_stan</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">meus_dados</span><span class="p">)</span>  <span class="c1"># Constru√≠ndo um modelo e anexando os dados</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">posteriori_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Fazendo a amostragem da posteriori </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recuperando os par√¢metros</span>
<span class="n">mu_modelo_1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Amostras da posteriori do ùúá</span>
<span class="n">sigma_modelo_1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Amostras da posteriori do ùúé</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  mu m√©dio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mu_modelo_1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39; </span><span class="se">\t</span><span class="s1"> mu original: &#39;</span><span class="p">,</span> <span class="n">mu_nao_observavel</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  sigma m√©dio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">sigma_modelo_1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39; </span><span class="se">\t</span><span class="s1"> sigma original: &#39;</span><span class="p">,</span> <span class="n">sigma_nao_observavel</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Posteriori estimada com a Stan&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_modelo_1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequ√™ncias √† Posteriori&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_modelo_1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequ√™ncias √† Posteriori&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
  mu m√©dio:  50.57  	 mu original:  50
  sigma m√©dio:  11.9  	 sigma original:  12
======================================================================
</pre></div>
</div>
<img alt="_images/parte_3_42_1.png" src="_images/parte_3_42_1.png" />
</div>
</div>
</div>
<div class="section" id="estimando-a-altura-usando-a-stan">
<h2>Estimando a altura usando a Stan<a class="headerlink" href="#estimando-a-altura-usando-a-stan" title="Permalink to this headline">¬∂</a></h2>
<p>De volta ao exemplo anterior, vamos estimar a altura <span class="math notranslate nohighlight">\(h\)</span> usando um modelo escrito em Stan.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelo_altura</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        real altura[N];</span>
<span class="s2">    }</span>

<span class="s2">    parameters {</span>
<span class="s2">        real mu;</span>
<span class="s2">        real&lt;lower=0, upper=50&gt; sigma;  // Priori para sigma ~ Uniform(0, 50)</span>
<span class="s2">    }</span>

<span class="s2">    model {</span>
<span class="s2">        //mu ~ normal(178, 0.1);  // *Teste com a priori muito informativa, veja o impacto do sigma √† posteriori</span>
<span class="s2">        //mu ~ normal(154, 0.1);  // *Teste com a priori informativa com a m√©dia bem p≈ïoxima do que ser√° estimado, usado apenas para entendimento, verifique que a m√©dia da vari√¢ncia se mant√©m.</span>
<span class="s2">        mu ~ normal(178, 20);   // Priori para mu</span>
<span class="s2">        sigma ~ uniform(0, 50);  // Priori para sigma</span>

<span class="s2">        altura ~ normal(mu, sigma);</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">altura</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Como recomenda a documenta√ß√£o https://mc-stan.org/docs/2_22/stan-users-guide/standardizing-predictors-and-outputs.html</span>
<span class="c1"># Iremos rescalonar o vetor de altura antes de mandar para a Stan</span>
<span class="n">altura_media</span> <span class="o">=</span> <span class="n">altura</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">altura_std</span> <span class="o">=</span> <span class="n">altura</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">altura_resc</span> <span class="o">=</span> <span class="p">(</span><span class="n">altura</span> <span class="o">-</span> <span class="n">altura_media</span><span class="p">)</span> <span class="o">/</span> <span class="n">altura_std</span>

<span class="n">dados</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">altura</span><span class="p">),</span> 
         <span class="s1">&#39;altura&#39;</span><span class="p">:</span> <span class="n">altura</span><span class="p">}</span>  <span class="c1"># Iremos usar a altura n√£o normalizada para efeito de simplifica√ß√£o.</span>

<span class="n">posteriori_model</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">modelo_altura</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dados</span><span class="p">)</span>
<span class="n">fit_altura</span> <span class="o">=</span> <span class="n">posteriori_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare o sigma usando duas priori diferentes para mu.</span>
<span class="c1"># (***) Com a priori mu ~ normal(178, 0.1), a posteriori do sigma tem um aumento significativo.</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;M√©dia: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sigma: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori $\mu$ da altura&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;M√©dia do $\mu$ da altura (cm)&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori $\sigma$ da altura&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;M√©dia do $\sigma$ da altura&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----------------------------------------
M√©dia:  154.6175358324885
Sigma:  7.77149906071101
----------------------------------------
</pre></div>
</div>
<img alt="_images/parte_3_45_1.png" src="_images/parte_3_45_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#  Modelo calculado na Stan</span>
<span class="c1"># =============================</span>

<span class="c1"># Recuperando os par√¢metros</span>
<span class="n">mu_altura</span> <span class="o">=</span> <span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>
<span class="n">sigma_altura</span> <span class="o">=</span> <span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Comparativo com a amostra&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  mu amostrado: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  sigma amostrado: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  mu m√©dio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mu_altura</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  sigma m√©dio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">sigma_altura</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Posteriori estimada com a Stan&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_altura</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequ√™ncias √† Posteriori&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_altura</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequ√™ncias √† Posteriori&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># =============================</span>
<span class="c1">#  Modelo calculado na m√£o</span>
<span class="c1"># =============================</span>
<span class="c1"># Amostrando mu e sigma a partir da posteriori calculada na m√£o (exemplo constru√≠do acima)</span>

<span class="n">amostras_posteriori_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">*</span><span class="n">grid</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">posteriori</span><span class="p">)</span>

<span class="n">mu_amostrado</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>
<span class="n">sigma_amostrado</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Posteriori estimada na m√£o&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_amostrado</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da posteriori </span><span class="se">\n</span><span class="s1"> $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_amostrado</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da posteriori </span><span class="se">\n</span><span class="s1"> $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Comparativo com a amostra
==============================
  mu amostrado:  154.6
  sigma amostrado:  7.74
==============================
  mu m√©dio:  154.62
  sigma m√©dio:  7.77
==============================
</pre></div>
</div>
<img alt="_images/parte_3_46_1.png" src="_images/parte_3_46_1.png" />
<img alt="_images/parte_3_46_2.png" src="_images/parte_3_46_2.png" />
</div>
</div>
</div>
<div class="section" id="adicionando-uma-variavel-preditora">
<h2>Adicionando uma vari√°vel Preditora<a class="headerlink" href="#adicionando-uma-variavel-preditora" title="Permalink to this headline">¬∂</a></h2>
<p>Agora, iremos refazer a estimativa da altura, mas iremos usar <code class="docutils literal notranslate"><span class="pre">mais</span> <span class="pre">uma</span> <span class="pre">vari√°vel</span></code> para nos ajudar explicar melhor a altura, e assim teremos mais informa√ß√µes. Usaremos a vari√°vel <code class="docutils literal notranslate"><span class="pre">peso</span></code> (<em>weight</em>) que nos ajudar√° a entender melhor a altura (<em>height</em>)?</p>
<p><em>Obs: Iremos selecionar apenas as pessoas que tenham acima de 18 anos de idade para todos os estudo a seguir.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gr√°fico de dispers√£o - peso ajudar a identificar qual a altura.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">],</span>  <span class="c1"># Filtro para todos as pessoas que tem acima de 18 anos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">])</span>  <span class="c1"># Filtro para todos as pessoas que tem acima de 18 anos</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gr√°fico de Dispers√£o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Peso (weight)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altura (height)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_48_0.png" src="_images/parte_3_48_0.png" />
</div>
</div>
<p>Usando um modelo linear de m√©dia, <span class="math notranslate nohighlight">\(\mu\)</span>:</p>
<div class="math notranslate nohighlight">
\[ h_i \sim Normal(\mu_i, \sigma), \mbox{ [Verossimilha√ßas] }\]</div>
<div class="math notranslate nohighlight">
\[ mu_i = \alpha + \beta(x_i + \bar{x}), \mbox{ [Modelo Linear] } \]</div>
<div class="math notranslate nohighlight">
\[  \alpha \sim Normal(178, 20), \mbox{ [Priori de }\alpha \mbox{]} \]</div>
<div class="math notranslate nohighlight">
\[  \beta \sim Normal(0, 10), \mbox{ [Priori de }\beta \mbox{]} \]</div>
<div class="math notranslate nohighlight">
\[  \sigma \sim Uniform(0, 50), \mbox{ [Priori de }\sigma \mbox{]} \]</div>
<p>Vamos agora construir uma reta, <code class="docutils literal notranslate"><span class="pre">um</span> <span class="pre">modelo</span> <span class="pre">linear</span></code>. At√© agora n√≥s fizemos infer√™ncias de <span class="math notranslate nohighlight">\(1\)</span> ou <span class="math notranslate nohighlight">\(2\)</span> par√¢metros e que podem ser aproximadas como uma gaussiana.</p>
<p>Mas o que significa fazer um modelo linear, ou utilizar uma reta no modelo? Isso significa que podemos adicionar uma nova vari√°vel que ir√° nos ajudar a melhorar nosso entendimento da vari√°vel <code class="docutils literal notranslate"><span class="pre">altura</span></code>. Essa nova vari√°vel ter√° a fun√ß√£o, dentro do nosso modelo, de predizer, ou seja, dizer antecipadamente, antever, adivinhar, prever qual √© a da altura do indiv√≠duo, probabilisticamente. Chamamos todas essas vari√°veis que podem nos ajudar de <code class="docutils literal notranslate"><span class="pre">vari√°veis</span> <span class="pre">preditoras</span></code>.</p>
<p>A principal ideia em adicionar uma vari√°vel preditora, assim como outras vari√°veis do nosso conjunto de dados, √© que quando aprendemos, podemos fazer melhores previs√µes sobre o resultado de interesse que, nesse caso, √© a <code class="docutils literal notranslate"><span class="pre">altura</span></code>.</p>
<p>Para ficar mais claro, quando pretendemos saber a altura de uma pessoa sem termos nenhuma informa√ß√£o adicional, o melhor que podemos fazer √© usar a estimativa da altura da popula√ß√£o toda para estimar a altura desse indiv√≠duo. √â o m√°ximo que podemos fazer com as informa√ß√µes que temos dispon√≠veis.</p>
<p>Mas se esse mesmo indiv√≠duo, assim como todos da amostra, nos informar uma caracter√≠stica a mais para n√≥s estimarmos sua altura? Nesse exemplo, o peso √© uma dessas informa√ß√µes adicionais, <code class="docutils literal notranslate"><span class="pre">vari√°vel</span> <span class="pre">preditora</span></code>, assim teremos mais conhecimento para poder estimar a sua <em>altura</em>.</p>
<div class="section" id="explicando-o-modelo-acima">
<h3>Explicando o modelo acima:<a class="headerlink" href="#explicando-o-modelo-acima" title="Permalink to this headline">¬∂</a></h3>
<p>Agora temos que <span class="math notranslate nohighlight">\(h_i\)</span> tamb√©m cont√≠nua distribu√≠da como uma <code class="docutils literal notranslate"><span class="pre">Gaussiana</span></code> como no exemplo anterior, por√©m agora a m√©dia <span class="math notranslate nohighlight">\(\mu\)</span> n√£o √© apenas distribu√≠da normalmente com a m√©dia fixa em 178, depender√° de cada indiv√≠duo <span class="math notranslate nohighlight">\(i\)</span>, assim:</p>
<div class="math notranslate nohighlight">
\[ \mu_i = \alpha + \beta(x_i + \bar{x}) \]</div>
<p><span class="math notranslate nohighlight">\(x_i\)</span> representa o peso de uma pessoa em particular.</p>
<p>Em instante iremos entender melhor o que significa todos os termos de <span class="math notranslate nohighlight">\(\mu\)</span>. O <span class="math notranslate nohighlight">\(\alpha\)</span> e o <span class="math notranslate nohighlight">\(\sigma\)</span> continuam com as mesmas prioris do exemplo anterior, e agora temos uma nova distribui√ß√£o √† priori para <span class="math notranslate nohighlight">\(\beta\)</span>, que √© o respons√°vel por descrever a rela√ß√£o entre <code class="docutils literal notranslate"><span class="pre">altura</span></code> e o <code class="docutils literal notranslate"><span class="pre">peso</span></code>.</p>
<p>Observando mais profundamente a estrutura que criamos nosso novo modelo:</p>
<div class="math notranslate nohighlight">
\[ \mu_i = \alpha + \beta(x_i + \bar{x}) \]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mu_i\)</span> = √© a m√©dia da linha i</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span> = √© a altura m√©dia da quando <span class="math notranslate nohighlight">\(x_i = \bar{x}\)</span>, conhecida como o <code class="docutils literal notranslate"><span class="pre">intercepto</span></code>. (<em>Lindo!!!</em>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta\)</span> = taxa de mudan√ßa para <span class="math notranslate nohighlight">\(\mu\)</span> cada unidade de mudan√ßa de <span class="math notranslate nohighlight">\(x_i\)</span>, conhecido como a <code class="docutils literal notranslate"><span class="pre">inclina√ß√£o</span></code>.</p></li>
</ul>
<p>Se por acaso o <span class="math notranslate nohighlight">\(\beta\)</span> for zero, estamos novamente no modelo anterior. Ou seja, estamos dizendo que n√£o h√° rela√ß√£o  transmitida para o <span class="math notranslate nohighlight">\(\mu\)</span> a partir do peso. Do contr√°rio, cada n√∫mero que o <span class="math notranslate nohighlight">\(x_i\)</span> sobe, subimos <span class="math notranslate nohighlight">\(\beta\)</span> o <span class="math notranslate nohighlight">\(\mu\)</span>.</p>
<p>Escrever nossos modelos lineares dessa forma nos permite entender e definir melhor os par√¢metros e nossa prioris, mas nem todos os modelos devem ser escritos dessa forma e nesse caso deveremos ter uma boa justificativa.</p>
</div>
</div>
<div class="section" id="distribuicao-priori-preditiva">
<h2>Distribui√ß√£o Priori Preditiva<a class="headerlink" href="#distribuicao-priori-preditiva" title="Permalink to this headline">¬∂</a></h2>
<p>Quais s√£o as prioris desse modelo e o que essas prioris significam?</p>
<p>Como, no exemplo anterior, vamos simular para entender e compreender as implica√ß√µes do modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===========================</span>
<span class="c1">#     Simulando a Priori</span>
<span class="c1"># ===========================</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># A quantidade de vezes que iremos simular os dados da priori</span>

<span class="n">alpha_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">beta_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> 
             <span class="n">alpha_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span> <span class="c1"># (x_i - x_bar)</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha inferior vermelha: Altura √≥vulo fertilizado (0cm)  </span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha superior vermelha: Pessoa mais alta do mundo (272 cm)</span>
  
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Pessoa mais alta j√° registrada </span><span class="se">\n</span><span class="s1">              (272 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">280</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Altura do Embri√£o </span><span class="se">\n</span><span class="s1">           (0 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Priori: $alpha + beta * x_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altura $h_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Peso $x_i$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_52_0.png" src="_images/parte_3_52_0.png" />
</div>
</div>
<p>O resultado das simula√ß√µes da distribui√ß√£o √† priori do <span class="math notranslate nohighlight">\(\alpha\)</span> e o <span class="math notranslate nohighlight">\(\beta\)</span>, geram as curvas acima, de acordo o modelo:</p>
<div class="math notranslate nohighlight">
\[ altura = \alpha + \beta \times peso \]</div>
<p>com podemos ver no gr√°fico, muitas linhas tem valores superiores √† altura de <span class="math notranslate nohighlight">\(272 cm\)</span>. Tamb√©m podemos ver que existem linhas que indicam alturas menores que zero, <code class="docutils literal notranslate"><span class="pre">o</span> <span class="pre">que</span> <span class="pre">naturalmente</span> <span class="pre">deveria</span> <span class="pre">estar</span> <span class="pre">errado</span></code>. Ambos comportamentos s√£o prioritariamente resultantes dos valores gerados pela distribui√ß√£o dos <span class="math notranslate nohighlight">\(\beta\)</span>‚Äôs, a inclina√ß√£o da reta.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Essas retas s√£o as nossas cren√ßas √† priori.</p>
</div>
<p>Agora que temos um pouco mais de intimidade com o comportamento das nossas prioris, podemos concluir que devemos diminuir nosso entusiasmo com rela√ß√£o ao <span class="math notranslate nohighlight">\(\beta\)</span>, pois essa <code class="docutils literal notranslate"><span class="pre">√©</span> <span class="pre">uma</span> <span class="pre">priori</span> <span class="pre">muito</span> <span class="pre">ruim</span></code>. Haver√° momentos, em situa√ß√µes reais, que ser√° necess√°rio verificar a compatibilidade com o mundo real. Fa√ßa altera√ß√µes nas prioris para verificar a mudan√ßa no efeito.</p>
<div class="section" id="distribuicao-preditiva-da-priori">
<h3>Distribui√ß√£o Preditiva da Priori<a class="headerlink" href="#distribuicao-preditiva-da-priori" title="Permalink to this headline">¬∂</a></h3>
<p>N√≥s agora sabemos algo sobre as prioris, temos um conhecimento cient√≠fico sobre a nossa distribui√ß√£o dos <span class="math notranslate nohighlight">\(\beta\)</span>‚Äôs, sabemos que ele √© positivo, assim, ent√£o, vamos transforma-lo em positivo?</p>
<p><em>Mas como?</em></p>
<p>Para fazer isso, usaremos a distribui√ß√£o <code class="docutils literal notranslate"><span class="pre">log-Normal</span></code>. Essa distribui√ß√£o pode ser um pouco menos conhecida, por√©m √© muito √∫til para situa√ß√µes desse tipo. Essa distribui√ß√£o, log-Normal, constru√≠da partir da exponencia√ß√£o dos valores da distribui√ß√£o Normal.</p>
<div class="math notranslate nohighlight">
\[Log-Normal(0, 1) = exp( Normal(0, 1))\]</div>
<p>Na teoria das probabilidades, uma distribui√ß√£o log-normal (ou lognormal) √© uma distribui√ß√£o de probabilidade cont√≠nua de uma vari√°vel aleat√≥ria cujo logaritmo √© normalmente distribu√≠do.</p>
<p>Assim, se a vari√°vel aleat√≥ria <span class="math notranslate nohighlight">\(X\)</span> √© log-normalmente distribu√≠da, ent√£o <span class="math notranslate nohighlight">\(Y = log(X)\)</span> tem uma distribui√ß√£o normal. <em>(Ref. Wikipedia)</em></p>
<p>Refer√™ncias:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/reference/generated/scipy.stats.lognorm.html#scipy.stats.lognorm">Numpy - Log-Normal</a></p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.lognormal.html">Scipy - Log-Normal</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Log-normal_distribution">Wikipedia - Log-Normal</a></p></li>
</ul>
<hr class="docutils" />
<p>Um caminho para se entender melhor o que √© uma <span class="math notranslate nohighlight">\(lognormal\)</span> √© o seguinte:</p>
<p>Qual √© a distribui√ß√£o de <span class="math notranslate nohighlight">\(X\)</span>, na qual, ao aplicarmos o log, <span class="math notranslate nohighlight">\(log(X)\)</span>, ela se tornar√° <span class="math notranslate nohighlight">\(Normal\)</span>? Naturalmente temos que:</p>
<p>de acordo com a express√£o abaixo:</p>
<div class="math notranslate nohighlight">
\[ log(exp(a)) = a , \forall a \in R\]</div>
<p>se a distribui√ß√£o de <span class="math notranslate nohighlight">\(X\)</span> for:</p>
<div class="math notranslate nohighlight">
\[ X \sim exp(Normal) \]</div>
<p>ent√£o a opera√ß√£o abaixo √© v√°lida,</p>
<div class="math notranslate nohighlight">
\[  log(exp(Normal)) = Normal \]</div>
<p>logo,</p>
<div class="math notranslate nohighlight">
\[ log(X) = Normal \]</div>
<p>ent√£o, assim teremos que:</p>
<div class="math notranslate nohighlight">
\[ X \sim lognormal \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================</span>
<span class="c1">#     Estudos sobre as Log-Normais </span>
<span class="c1"># =====================================</span>
<span class="c1"># Iremos plotar, a partir de uma </span>
<span class="c1"># distribui√ß√£o normal, uma lognormal </span>
<span class="c1"># e compara-la com amostragem da </span>
<span class="c1"># lognormal implementada no Numpy!</span>
<span class="c1"># =====================================</span>

<span class="n">d_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">d_lognormal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],[</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d_normal</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$exp( Normal(0,1) )$ </span><span class="se">\n</span><span class="s1"> Log Normal gerada na m√£o&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d_lognormal</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histograma da distribui√ß√£o lognormal </span><span class="se">\n</span><span class="s1"> Gerada usando Numpy&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d_normal</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$exp( Normal(0,1) )$ </span><span class="se">\n</span><span class="s1"> Log Normal gerada na m√£o </span><span class="se">\n</span><span class="s1"> Mostrando valores de 0 a 5&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d_lognormal</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histograma da distribui√ß√£o lognormal </span><span class="se">\n</span><span class="s1"> Gerada usando Numpy </span><span class="se">\n</span><span class="s1"> Mostrando os valores de 0 a 5&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ajustar as dist√¢ncias entre os gr√°ficos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_55_0.png" src="_images/parte_3_55_0.png" />
</div>
</div>
<hr class="docutils" />
<p>Com a lognormal explicada, iremos trocar a distribui√ß√£o da a priori de:</p>
<div class="math notranslate nohighlight">
\[\beta \sim Normal(0, 10)\]</div>
<p>para uma priori que √© distribu√≠da conforme uma <em>lognormal</em>:</p>
<div class="math notranslate nohighlight">
\[\beta \sim lognormal(0, 1)\]</div>
<p>Assim, como antes, vamos <code class="docutils literal notranslate"><span class="pre">simular</span> <span class="pre">para</span> <span class="pre">entender</span> <span class="pre">o</span> <span class="pre">novo</span> <span class="pre">comportamento</span> <span class="pre">da</span> <span class="pre">nossa</span> <span class="pre">priori</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==========================================</span>
<span class="c1">#     Simulando a priori com log-normal</span>
<span class="c1"># ==========================================</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># A quantidade de vezes que iremos simular os dados da priori</span>

<span class="n">alpha_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">beta_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>  <span class="c1"># Priori lognormal(0, 1)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">alpha_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span> <span class="c1"># (x_i - x_bar)</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha inferior vermelha: Altura √≥vulo fertilizado (0cm)  </span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha superior vermelha: Pessoa mais alta do mundo (272 cm)</span>
  
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Pessoa mais alta j√° registrada </span><span class="se">\n</span><span class="s1">              (272 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">280</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Altura do Embri√£o </span><span class="se">\n</span><span class="s1">           (0 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Priori: $alpha + beta * x_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altura $h_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Peso $x_i$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_57_0.png" src="_images/parte_3_57_0.png" />
</div>
</div>
<p>N√≥s ainda temos muita dispers√£o e tamb√©m temos ainda algumas poucas linhas que ultrapassam a maior altura j√° registrada (de <span class="math notranslate nohighlight">\(272 cm\)</span>). Isso acontece porque n√£o limitamos a nossa margem superior pela distribui√ß√£o de <span class="math notranslate nohighlight">\(\beta\)</span>. Mas essa nossa nova abordagem parece ser uma priori bem mais condizente com o que podemos imaginar.</p>
<div class="section" id="aproximacao-da-posteriori">
<h4>Aproxima√ß√£o da posteriori<a class="headerlink" href="#aproximacao-da-posteriori" title="Permalink to this headline">¬∂</a></h4>
<p>Vamos fazer a aproxima√ß√£o da posteriori usando a <em>Stan</em> e verificar os resultados.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =================================================================</span>
<span class="c1">#   Aproximando a posteriori da altura usando o peso da pessoa</span>
<span class="c1"># =================================================================</span>

<span class="n">modelo_altura_2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        real x_barra;</span>
<span class="s2">        real altura[N];</span>
<span class="s2">        real peso[N];</span>
<span class="s2">    }</span>

<span class="s2">    parameters {</span>
<span class="s2">        real alpha;</span>
<span class="s2">        real&lt;lower=0&gt; beta;</span>
<span class="s2">        real&lt;lower=0, upper=50&gt; sigma;</span>
<span class="s2">    }</span>

<span class="s2">    model {</span>
<span class="s2">        alpha ~ normal(178, 20);</span>
<span class="s2">        beta ~ lognormal(0, 1);</span>
<span class="s2">        // sigma ~ uniform(0, 50);</span>

<span class="s2">        for (i in 1:N){</span>
<span class="s2">            altura[i] ~ normal(alpha +  beta * (peso[i] - x_barra), sigma);</span>
<span class="s2">    }</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Nossa amostra √© apenas para pessoas acima de 18 anos</span>
<span class="n">df_maioridade</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">]]</span>

<span class="c1"># Definindo as vari√°veis</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_maioridade</span><span class="p">)</span>
<span class="n">x_barra</span> <span class="o">=</span> <span class="n">df_maioridade</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">altura</span> <span class="o">=</span> <span class="n">df_maioridade</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">values</span>
<span class="n">peso</span> <span class="o">=</span> <span class="n">df_maioridade</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Construindo o dicion√°rio</span>
<span class="n">meus_dados_2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span> 
                <span class="s1">&#39;x_barra&#39;</span><span class="p">:</span> <span class="n">x_barra</span><span class="p">,</span> 
                <span class="s1">&#39;altura&#39;</span><span class="p">:</span> <span class="n">altura</span><span class="p">,</span> 
                <span class="s1">&#39;peso&#39;</span><span class="p">:</span> <span class="n">peso</span><span class="p">}</span>

<span class="c1"># Rodando o modelo</span>
<span class="n">posteriori_model_2</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">modelo_altura_2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">meus_dados_2</span><span class="p">)</span>
<span class="n">fit_altura_2</span> <span class="o">=</span> <span class="n">posteriori_model_2</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#  Modelo calculado na Stan</span>
<span class="c1"># =============================</span>

<span class="c1"># Recuperando os par√¢metros</span>
<span class="n">alpha_posteriori</span> <span class="o">=</span> <span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_posteriori</span> <span class="o">=</span> <span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resumo das posterioris:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Media alpha: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">1</span><span class="p">),</span> 
     <span class="s1">&#39; - Desvio Padr√£o alpha: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;M√©dia beta:  &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">),</span>
      <span class="s1">&#39; - Desvio Padr√£o beta:  &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;M√©dia sigma: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">),</span> 
      <span class="s1">&#39; - Desvio Padr√£o sigma: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>


<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha_posteriori</span><span class="p">)</span>  <span class="c1"># Plotar todas as curvas estimadas</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># Plotar as 200 primeiras curvas</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Modelo linear </span><span class="se">\n</span><span class="s1"> Posteriori da Altura&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Altura&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Peso&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">alpha_posteriori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_posteriori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span> 
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># ==========================================</span>
<span class="c1">#    Plot todas as vari√°veis  estimadas</span>
<span class="c1"># ==========================================</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori alpha&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequ√™ncia&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori beta&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequ√™ncia&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Beta&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori sigma&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequ√™ncia&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sigma&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ajustar as dist√¢ncias entre os gr√°ficos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resumo das posterioris:
============================================================
Media alpha:  154.6  - Desvio Padr√£o alpha:  0.273
M√©dia beta:   0.904  - Desvio Padr√£o beta:   0.042
M√©dia sigma:  5.111  - Desvio Padr√£o sigma:  0.195
</pre></div>
</div>
<img alt="_images/parte_3_61_1.png" src="_images/parte_3_61_1.png" />
<img alt="_images/parte_3_61_2.png" src="_images/parte_3_61_2.png" />
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="resumo">
<h1>Resumo<a class="headerlink" href="#resumo" title="Permalink to this headline">¬∂</a></h1>
<p>At√© aqui vimos a constru√ß√£o de um modelo linear simples usando a Stan, vimos tamb√©m como pensar e como construir uma priori, vimos como gerar as amostras da posteriori e analisar seus resultados.</p>
<p>O modelo linear √© o modelo muito simples e √© empregado em <em>muitas</em> an√°lises no dia a dia.</p>
<p>Na mesma linha de racioc√≠nio que usamos para pensar e construir esse modelo de regress√£o linear, n√≥s tamb√©m iremos utiliz√°-la na pr√≥xima parte desse material. Iremos adicionar mais ferramentas dentro dessa estrutura e, com isso, aumentaremos um pouco mais a profundidade que nossas an√°lises podem alcan√ßar.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="parte_2.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">2 - Engenharia de Golems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="parte_4.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">4 - Fun√ß√µes Wiggly</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Rodolpho Macedo dos Santos<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>