
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3- Modelos Geocêntricos &#8212; Statistical Rethinking</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4 - Funções Wiggly" href="parte_4.html" />
    <link rel="prev" title="2 - Engenharia de Golems" href="parte_2.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Statistical Rethinking</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="capa.html">
   Estatistica Bayesiana
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro_pt-BR.html">
   Intro - Estatística Bayesiana (🇧🇷)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_en.html">
   Intro - Bayesian Statistics (🇺🇸)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_1.html">
   1- Introdução
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_2.html">
   2 - Engenharia de Golems
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3- Modelos Geocêntricos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_4.html">
   4 - Funções Wiggly
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="parte_5.html">
   5 - Muitas Variáveis e os Waffles Espúrios
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/parte_3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/rodolphomacedo/statistical_rethinking_pt_BR/issues/new?title=Issue%20on%20page%20%2Fparte_3.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/rodolphomacedo/statistical_rethinking_pt_BR/main?urlpath=tree/parte_3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   3- Modelos Geocêntricos
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#distribuicao-normal">
   Distribuição Normal
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regressao-linear">
     Regressão Linear
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gerando-um-processo-de-flutuacao-normal">
     Gerando um processo de flutuação normal
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#porque-a-normal">
     Porque a Normal?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perspectiva-ontologica">
     Perspectiva Ontológica
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perspectiva-epistemologica">
     Perspectiva Epistemologica
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modelos-lineares">
     Modelos Lineares
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#acordando-a-linguagem-que-iremos-trabalhar">
       Acordando a linguagem que iremos trabalhar
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linguagem-da-modelagem">
     Linguagem da modelagem
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#construindo-um-modelo-linear">
   Construíndo um Modelo Linear
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estudo-descritivo-da-base-de-dados">
     Estudo Descritivo da Base de Dados
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modelos-gaussianos">
     Modelos Gaussianos
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adicionando-prioris">
     Adicionando prioris
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulacao-a-partir-da-priori">
     Simulação a partir da priori
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculando-a-posteriori-conjunta">
     Calculando a Posteriori Conjunta
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aproximacao-quadratica">
     Aproximação Quadrática
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimando-a-altura-usando-a-stan">
     Estimando a altura usando a Stan
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adicionando-uma-variavel-preditora">
     Adicionando uma variável Preditora
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#explicando-o-modelo-acima">
       Explicando o modelo acima:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribuicao-priori-preditiva">
     Distribuição Priori Preditiva
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#distribuicao-preditiva-da-priori">
       Distribuição Preditiva da Priori
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#aproximacao-da-posteriori">
         Aproximação da posteriori
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resumo">
   Resumo
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="modelos-geocentricos">
<h1>3- Modelos Geocêntricos<a class="headerlink" href="#modelos-geocentricos" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="distribuicao-normal">
<h1>Distribuição Normal<a class="headerlink" href="#distribuicao-normal" title="Permalink to this headline">¶</a></h1>
<img alt="gauss" src="_images/Gauss.jpg" />
<p>fonte: <a class="reference external" href="https://pt.wikipedia.org/wiki/Marco_alem%C3%A3o">wikipedia</a></p>
<p>fonte: <a class="reference external" href="https://www.bis-ans-ende-der-welt.net/Deutschland-B.htm">Distribuição Gausiana</a></p>
<p><a class="reference external" href="https://www.youtube.com/watch?v=h5aPo5wXN8E">Aula - Statistical Rethinking Winter 2019 Lecture 03</a></p>
<div class="section" id="regressao-linear">
<h2>Regressão Linear<a class="headerlink" href="#regressao-linear" title="Permalink to this headline">¶</a></h2>
<p>São simples <em>golems</em> estatísticos.</p>
<ul class="simple">
<li><p>Modelo de média e variância normalmente (Gaussiano) distribuído.</p></li>
<li><p>Média como uma combinação aditiva dos pesos das varáveis que a compõem.</p></li>
<li><p>Variância é constante.</p></li>
</ul>
</div>
<div class="section" id="gerando-um-processo-de-flutuacao-normal">
<h2>Gerando um processo de flutuação normal<a class="headerlink" href="#gerando-um-processo-de-flutuacao-normal" title="Permalink to this headline">¶</a></h2>
<p>Através da flutuação normal <em>(sobe 1 ou desce 1)</em> iremos construir um processo que tenha como resultante natural o surgimento de um comportamento cuja distribuição podemos descrever como a normal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Necessário para desbloquear o asyncio no Jupyter</span>

<span class="c1"># Fonte: https://pystan.readthedocs.io/en/latest/faq.html</span>
<span class="c1"># Fonte: https://github.com/microsoft/playwright-python/issues/178</span>

<span class="c1"># Docs Pystan: https://pystan.readthedocs.io/en/latest/index.html</span>

<span class="c1"># -------------</span>
<span class="c1"># Instalar nest_asyncio: pip install nest_asyncio - Estára no requirements.txt</span>
<span class="c1"># Versões </span>
<span class="c1"># python==3.8.0</span>
<span class="c1"># numpy==1.21.1</span>
<span class="c1"># pystan==3.2.0</span>
<span class="c1"># nest_asyncio==1.5.1</span>
<span class="c1"># -------------</span>

<span class="c1"># Rodar esse comando antes de import a stan (pystan versão 3.x)</span>
<span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construindo um passeio conforme a distribuição Bernoulli(0.5) em +1 ou -1</span>

<span class="n">n_linhas</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># Quantas linhas iremos simular?</span>
<span class="n">n_passos</span> <span class="o">=</span> <span class="mi">30</span>   <span class="c1"># Quantidade de passos que iremos simular?</span>

<span class="n">corte_1</span> <span class="o">=</span> <span class="mi">3</span>   <span class="c1"># Indica o primeiro corte no passeio</span>
<span class="n">corte_2</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># Indica o segundo corte no passeio</span>
<span class="n">corte_3</span> <span class="o">=</span> <span class="mi">26</span>  <span class="c1"># Indica o terceiro corte no passeio</span>

<span class="n">aleatorizar_grafico</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># True para ver a simulação um pouco mais aleatorizada visualmente. False para ver sem efeito.</span>

<span class="n">passeios</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Armazenar todos os passeios gerados num array</span>

<span class="c1"># Parâmetros da simulação</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>  <span class="c1"># Alterando a cor de fundo, para ficar mais elegante. </span>

<span class="k">for</span> <span class="n">linha</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_linhas</span><span class="p">):</span>  <span class="c1"># Quantas linhas iremos plotar</span>
    
    <span class="n">passeio</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Inicializando todos os pontos com o valor 0 (conforme dito acima!)</span>
    <span class="n">novo_ponto</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># variável de controle </span>
    
    <span class="k">for</span> <span class="n">passo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_passos</span><span class="p">):</span>  <span class="c1"># Quantos passos iremos simular?</span>
        
        <span class="k">if</span> <span class="n">aleatorizar_grafico</span><span class="p">:</span>
            <span class="c1"># +1 (subida) ou -1 (descida) - Com efeito de aleatorizacão (apenas para melhorar a visualização).</span>
            <span class="n">novo_ponto</span> <span class="o">=</span> <span class="n">novo_ponto</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>    
            <span class="c1"># +1 (subida) ou -1 (descida) - Sem efeito de aleatorizacão - &quot;Pixelizado&quot;</span>
            <span class="n">novo_ponto</span> <span class="o">=</span> <span class="n">novo_ponto</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
        
        <span class="n">passeio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">novo_ponto</span><span class="p">)</span>
    
    <span class="n">passeios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">passeio</span><span class="p">)</span>  <span class="c1"># Armazendo todas as linhas geradas</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">linha</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Plotando a linha gerada</span>
    
<span class="c1"># Retas horizontais dos cortes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">corte_1</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>  <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">corte_2</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">corte_3</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Configurando infos do gráfico    </span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Passeio Aleatório {+1, -1} com p(0.5)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Número de passos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">passeios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">passeios</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Transpondo os vetores de passeios para ajuste na plotagem.</span>

<span class="c1"># ------------</span>
<span class="c1"># Gerando os histogramas de todas as linhas para alguns passos específicos ao longo do passeio.</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">corte_1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograma </span><span class="se">\n</span><span class="s2"> Normalmente distribuído </span><span class="se">\n</span><span class="s2">  passo &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corte_1</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">corte_2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograma </span><span class="se">\n</span><span class="s2"> Normalmente distribuído </span><span class="se">\n</span><span class="s2">  passo &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corte_2</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">passeios</span><span class="p">[</span><span class="n">corte_3</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histograma </span><span class="se">\n</span><span class="s2"> Normalmente distribuído </span><span class="se">\n</span><span class="s2"> passo &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corte_3</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Valor&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>      
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_9_0.png" src="_images/parte_3_9_0.png" />
<img alt="_images/parte_3_9_1.png" src="_images/parte_3_9_1.png" />
</div>
</div>
<p>Todas as flutuações geradas se equilibriam entre si, gerando assim uma curva simétrica. Porém cada uma delas individualmente, e não necessariamente, se equilibram entre si. Isso é a <span class="math notranslate nohighlight">\(Normal\)</span>!</p>
</div>
<div class="section" id="porque-a-normal">
<h2>Porque a Normal?<a class="headerlink" href="#porque-a-normal" title="Permalink to this headline">¶</a></h2>
<p>O interessante, e frustrante ao mesmo tempo, é que mesmos nós sabendo como cada uma das curvas são geradas, não temos acesso a <code class="docutils literal notranslate"><span class="pre">como</span> <span class="pre">cada</span> <span class="pre">uma</span> <span class="pre">delas</span> <span class="pre">individualmente</span> <span class="pre">faz</span> <span class="pre">o</span> <span class="pre">seu</span> <span class="pre">percurso</span></code>, pois temos muito pouca informação sobre como é o processo gerador dessas curvas.</p>
<p>Assim, quando vimos um comportamento de um evento que é normalmente distribuído, por exemplo, não sabemos o que tem la dentro! Não temos um acesso intuitivo da informação contida no comportamento individual de cada passeio.</p>
<p>Mas sabendo que o processo como um todo tem o comportamento, aproximadamente, normalmente distribuído, podemos usar essa informação para falsificar ou não hipóteses de um estudo particular.</p>
<div class="math notranslate nohighlight">
\[ x \sim normal(\mu, \sigma) \]</div>
<p>E isso é muito legal, pois podemos descrever o processo como um todo, com apenas por dois números, pois toda a informação do funcionamento da maquinaria subjacente do processo foi eliminada. E tudo que foi preservado foi a média (<span class="math notranslate nohighlight">\(\mu\)</span>) e o desvio padrão (<span class="math notranslate nohighlight">\(\sigma\)</span>), por isso que precisamos apenas desses dois números para descrever uma distribuição normal.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Essa é toda a informação que conseguimos extrair da maquinaria subjacente, a Natureza!</p>
</div>
<p>O mais terrível é que não podemos saber o funcionamento do processo a partir de um simples histograma! Temos que realmente fazer ciência para isso, temos de <em>cavar mais fundo</em>, <em>medir coisas mais difíceis</em> para <code class="docutils literal notranslate"><span class="pre">só</span> <span class="pre">assim</span></code> descobrir mais algumas coisas nas profundezas do mecanismo de geração do processo.</p>
<p>Isso é verdade não apenas para a <span class="math notranslate nohighlight">\(Normal\)</span>, mas para muitas outras distribuições! Todas as distribuições de máxima entropia tem essa mesma propriedade, que muitos processos diferentes possuem a mesma distribuição de frequências.</p>
</div>
<div class="section" id="perspectiva-ontologica">
<h2>Perspectiva Ontológica<a class="headerlink" href="#perspectiva-ontologica" title="Permalink to this headline">¶</a></h2>
<p>Ontologia é o ramo da filosofia que <code class="docutils literal notranslate"><span class="pre">estuda</span> <span class="pre">a</span> <span class="pre">natureza</span> <span class="pre">do</span> <span class="pre">ser</span></code>, da existência e da própria realidade. Vamos observar a distribuição <span class="math notranslate nohighlight">\(Normal\)</span> sobre uma perspectiva ontológia:</p>
<ul class="simple">
<li><p>Processo que adiciona flutuações amortecidas como resultado.</p></li>
<li><p>As flutuações amortecidas se aproximam de uma gaussiana.</p></li>
<li><p>Mas nenhuma informação sobrou do processo gerador, apenas a média e a variância.</p></li>
<li><p>Não podemos inferir o processo a partir dessa distribuição.</p></li>
</ul>
<p>Se quisermos construir um modelo visando responder de modo mais conservador possível, no qual tudo que estiver disposto a dizer sobre algum conjunto de medidas, como medida de alturas, é que eles têm variância finita e podemos usar a distribuição gaussiana.</p>
<p>Mesmo se eles forem distorcidos ou alguma outras coisas, a distribuição gaussiana cobrirá uma faixa mais ampla de valores do que qualquer outra com a mesma média e a mesma variância!</p>
<p>Essa é a distribuição mais é conservadora que podemos assumir. Qualquer outra distribuição será mais restrita por isso terá mais informação incorporada, por isso a opção mais conservadora que podemos propor é a <code class="docutils literal notranslate"><span class="pre">gaussiana</span></code>, no qual tudo que precisamos para ela é a média a variância. (<em>Isso será demostrado mais para frente no curso</em>.)</p>
</div>
<div class="section" id="perspectiva-epistemologica">
<h2>Perspectiva Epistemologica<a class="headerlink" href="#perspectiva-epistemologica" title="Permalink to this headline">¶</a></h2>
<p>Epistemologia, também conhecida como a Teoria do Conhecimento, é o ramo da filosofia que estuda como o ser humano ou a própria ciência adquire e justifica seus conhecimentos. Vamos observar a <span class="math notranslate nohighlight">\(Normal\)</span> sobre essa perspectiva:</p>
<ul class="simple">
<li><p>Conhecemos apenas a média e a variância.</p></li>
<li><p>A menos surpreendente e mais conservadora (<em>máxima entropia</em>) distribuição gaussiana.</p></li>
<li><p>É a distribuição natural da máxima entropia.</p></li>
</ul>
</div>
<div class="section" id="modelos-lineares">
<h2>Modelos Lineares<a class="headerlink" href="#modelos-lineares" title="Permalink to this headline">¶</a></h2>
<p>“<strong>Modelo lineares generalizados</strong>”: teste <em>t</em>, regressão simples, regressão multipla, ANOVA, ANCOVA, MANOVA, MANCOVA, etc, etc, etc. Todos esses modelos <code class="docutils literal notranslate"><span class="pre">são</span> <span class="pre">a</span> <span class="pre">mesma</span> <span class="pre">coisa,</span> <span class="pre">são</span> <span class="pre">todos</span> <span class="pre">modelos</span> <span class="pre">os</span> <span class="pre">lineares</span></code>.</p>
<p>A seguir, iremos construir modelos lineares manualmente e do zero para entendermos como é o processo de pensamento de construção de hipóteses e, também, iremos construir um gráfico no qual iremos visualizar a nossa incerteza do sistema.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Iremos aprender estratégias e não procedimentos!</p>
</div>
<div class="section" id="acordando-a-linguagem-que-iremos-trabalhar">
<h3>Acordando a linguagem que iremos trabalhar<a class="headerlink" href="#acordando-a-linguagem-que-iremos-trabalhar" title="Permalink to this headline">¶</a></h3>
<p>Relembrando o primeiro modelo que nós fizemos anteriormente, o lançamento do globo, nós tinhamos:</p>
<div class="math notranslate nohighlight">
\[ w \sim Binomial(N, p) \]</div>
<div class="math notranslate nohighlight">
\[ p \sim Uniform(0, 1) \]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(w\)</span>: Resultado</p></li>
<li><p><span class="math notranslate nohighlight">\(\sim\)</span>: “<em>É distribuído como…</em>”</p></li>
<li><p><span class="math notranslate nohighlight">\(Binomial( N, p)\)</span>: É a função de distribuição de probabilidade dos dados (verossimilhança, ou <em>likelihood</em> no inglês)</p></li>
<li><p><span class="math notranslate nohighlight">\(p\)</span>: É o parâmetro que iremos estimar</p></li>
<li><p><span class="math notranslate nohighlight">\(Uniform(0, 1)\)</span>: Nossa distribuição <em>à priori</em></p></li>
</ul>
<p>No exemplo do lançamento do globo, o que estávamos interessados em saber era a proporção de água na superfície (<span class="math notranslate nohighlight">\(p\)</span>) da Terra. O processo que usamos para coletar os dados, a amostragem, automaticamente nos propõem, de modo quase impositivo, a utilização da estrutura Binomial.</p>
<p>A estrutura que distribui os dados binominalmente, nada mais é do que a contagem do número de vezes que é possível acontecer tal fato, dado que a proporção <span class="math notranslate nohighlight">\(p\)</span> é fixa para todas às vezes <span class="math notranslate nohighlight">\(N\)</span> que iremos retirar uma amostra.</p>
<hr class="docutils" />
<p>Essa é a linguagem que iremos usar nesse curso. A notação matemática padrão, na qual consiste em uma maneira de comunicar a todos os nossos colegas de trabalho o que foi pensado, quais foram as suposições, quais foram as hipóteses (isto é, as sugestões) e, também, qual a estrutura foi proposta para um possível caminho para se entender o problema.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A linguagem matemática será a forma de comunicar ao mundo sua forma de pensar!</p>
</div>
</div>
</div>
<div class="section" id="linguagem-da-modelagem">
<h2>Linguagem da modelagem<a class="headerlink" href="#linguagem-da-modelagem" title="Permalink to this headline">¶</a></h2>
<p>Do mesmo modo que escrevemos o modelo acima iremos escrever todos os outros modelos, inclusive, a programação usando a linguagem probabilística <code class="docutils literal notranslate"><span class="pre">Stan</span></code>, o qual tem a sua sintaxe próxima a esse formato.</p>
<p>Para qualquer modelo que iremos elaborar, seja uma regressão linear simples ou modelos mais elaborados, temos que criar uma lista com todas as variáveis que irão participar desse modelo. Algumas <code class="docutils literal notranslate"><span class="pre">coisas</span> <span class="pre">que</span> <span class="pre">iremos</span> <span class="pre">observar</span> <span class="pre">nos</span> <span class="pre">dados</span></code>, como a contagem do número de vezes que o globo foi lançado. E também haverá outras <code class="docutils literal notranslate"><span class="pre">coisas</span> <span class="pre">que</span> <span class="pre">não</span> <span class="pre">vamos</span> <span class="pre">poder</span> <span class="pre">observar</span></code>, como a inclinação de uma reta de uma modelo linear simples, ou proporção de água no globo, pois elas não são entidades observáveis.</p>
<p>Por isso temos que listar todas as variáveis e então defini-las.</p>
<p>Listando as variáveis:</p>
<div class="math notranslate nohighlight">
\[ y_i \]</div>
<div class="math notranslate nohighlight">
\[ \mu_i \]</div>
<div class="math notranslate nohighlight">
\[ \beta \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \]</div>
<div class="math notranslate nohighlight">
\[ x_i \]</div>
<p>Um modelo de regressão, assim como qualquer outro modelo, será escrito da mesma forma que vimos anteriormente, porém esse modelo terá muito mais símbolos pois temos muito mais variáveis participando da explicação, <code class="docutils literal notranslate"><span class="pre">mas</span> <span class="pre">é</span> <span class="pre">a</span> <span class="pre">mesma</span> <span class="pre">coisa</span></code>, apenas precisamos definir a cada um desses símbolos.</p>
<p>O motor dos modelos de regressão linear é a segunda linha da definição abaixo (<em>a seguir iremos construir esse modelo desde o início</em>):</p>
<div class="math notranslate nohighlight">
\[ y_i \sim Normal(\mu_i, \sigma) \]</div>
<div class="math notranslate nohighlight">
\[ \mu_i = \beta x_i \]</div>
<div class="math notranslate nohighlight">
\[ \beta \sim Normal(0, 10) \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim Exponencial(1) \]</div>
<div class="math notranslate nohighlight">
\[ x_i \sim Normal(0, 1) \]</div>
<p>Essa segunda linha,  <span class="math notranslate nohighlight">\( \mu_i = \beta x_i \)</span>, geralmente a parte que é mais confusa para se entender (iremos ver um exemplo a seguir), mas ela significa que média da distribuição normal de cima (média do <span class="math notranslate nohighlight">\(y_i\)</span>) é geralmente definida por uma equação, o que define em termos de alguma outra variável que observamos, <span class="math notranslate nohighlight">\(x_i\)</span>.</p>
<p>O <span class="math notranslate nohighlight">\(x_i\)</span> é uma variável que ajuda a explicar o comportamento do <span class="math notranslate nohighlight">\(y_i\)</span>, ou seja, <span class="math notranslate nohighlight">\(x_i\)</span> é uma variável explicativa.</p>
<p>Mas repare que <span class="math notranslate nohighlight">\(x_i\)</span> também tem uma distribuição, nós normalmente não nos preocupamos em definir uma distribuição para as variáveis explicativas, pois não iremos prevê-las, <code class="docutils literal notranslate"><span class="pre">porém</span> <span class="pre">existe</span> <span class="pre">uma</span> <span class="pre">grande</span> <span class="pre">vantagem</span> <span class="pre">em</span> <span class="pre">fazer</span> <span class="pre">essas</span> <span class="pre">suposições</span> <span class="pre">de</span> <span class="pre">distribuição</span></code>, pois podemos fazer coisas muito legais com esse fato, iremos ver essas coisas mais à frente, tais como <code class="docutils literal notranslate"><span class="pre">medidas</span> <span class="pre">de</span> <span class="pre">erros</span></code> e também <code class="docutils literal notranslate"><span class="pre">dados</span> <span class="pre">faltantes</span></code>.</p>
<p>Assim, como todas as variáveis têm sua própria definição de distribuição, se você não sabe algo sobre algumas delas podemos colocar dentro do modelo e assim iremos ganhar automaticamente um poder inferencial do que estávamos perdendo antes.</p>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="construindo-um-modelo-linear">
<h1>Construíndo um Modelo Linear<a class="headerlink" href="#construindo-um-modelo-linear" title="Permalink to this headline">¶</a></h1>
<p>Com o conjunto de dados amostrados de uma população, extraída do livro da <em>Nancy Howel</em>, <code class="docutils literal notranslate"><span class="pre">Life</span> <span class="pre">history</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">DOBE</span> <span class="pre">!KUNG</span></code>, um novo clássico de demografia evolucionária, disponível no pacote R <em>rethinking</em> e suas versões variantes. (Nesse material temos uma cópia do link <a class="reference external" href="https://github.com/rmcelreath/rethinking">Rethinking - R-library - GitHub</a>.</p>
<img alt="Dobe !Kung" src="_images/dobe_kung.jpg" />
<div class="section" id="estudo-descritivo-da-base-de-dados">
<h2>Estudo Descritivo da Base de Dados<a class="headerlink" href="#estudo-descritivo-da-base-de-dados" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/Howell1.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>  <span class="c1"># Banco de dados do pacote Rethinking - Disponível no Github</span>

<span class="c1"># Just adults</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span> <span class="p">]</span>

<span class="c1"># =======================================</span>
<span class="c1"># Página 86</span>
<span class="c1"># Overthinking: Sample size and the normality  of sigma&#39;s posterior</span>
<span class="c1"># Note que, no gráfico posteriori da conjunta, o sigma não é normal.</span>
<span class="n">overthinking_test</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">qtd_sampled</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># Amostragem dos dados</span>
<span class="k">if</span> <span class="n">overthinking_test</span><span class="p">:</span>
    <span class="n">sample_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">qtd_sampled</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_df</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1"># =======================================</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>  <span class="c1"># Resumo do banco de dados</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           height      weight         age        male
count  352.000000  352.000000  352.000000  352.000000
mean   154.597093   44.990486   41.138494    0.468750
std      7.742332    6.456708   15.967855    0.499733
min    136.525000   31.071052   18.000000    0.000000
25%    148.590000   40.256290   28.000000    0.000000
50%    154.305000   44.792210   39.000000    0.000000
75%    160.655000   49.292693   51.000000    1.000000
max    179.070000   62.992589   88.000000    1.000000
</pre></div>
</div>
</div>
</div>
<p>Nosso conjunto de dados contém um total de <span class="math notranslate nohighlight">\(544\)</span> indivíduos, abaixo temos um histograma descritivo das quatro variáveis da base:</p>
<ul class="simple">
<li><p>Altura (<em>height</em>)</p></li>
<li><p>Peso (<em>weight</em>)</p></li>
<li><p>Idade (<em>Age</em>)</p></li>
<li><p>Gênero (<em>male</em>) - Definido <span class="math notranslate nohighlight">\(1\)</span> para homens e <span class="math notranslate nohighlight">\(0\)</span> para mulheres</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotando os histogramas</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],</span> <span class="p">[</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Histograma de todos os dados da altura (height)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Altura das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Histograma de todos os dados do peso (weight)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Peso das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Kg&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Histograma de todos os dados da idade (age)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Idade das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Anos&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Histograma de todos os dados da gênero (male)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">male</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gênero das Pessoas&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Feminino       -      Masculino&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_22_0.png" src="_images/parte_3_22_0.png" />
</div>
</div>
</div>
<div class="section" id="modelos-gaussianos">
<h2>Modelos Gaussianos<a class="headerlink" href="#modelos-gaussianos" title="Permalink to this headline">¶</a></h2>
<p>Vamos propor um primeiro modelo, abaixo temos a um modelo <span class="math notranslate nohighlight">\(Normal\)</span>:</p>
<div class="math notranslate nohighlight">
\[ h_i \sim Normal(\mu, \sigma) \]</div>
<p>A altura <span class="math notranslate nohighlight">\(h\)</span> do indivíduo <span class="math notranslate nohighlight">\(i\)</span> será distribuído normalmente, com uma média <span class="math notranslate nohighlight">\(\mu\)</span> e o desvio padrão <span class="math notranslate nohighlight">\(\sigma\)</span>.</p>
<hr class="docutils" />
<p>Estamos usando as letras gregas <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>, por convenção de linguagem, mas nada nos impede de usarmos quaisquer outros símbolos. Não haverá nenhum problema, <code class="docutils literal notranslate"><span class="pre">apenas</span> <span class="pre">iremos</span> <span class="pre">irritar</span> <span class="pre">alguns</span> <span class="pre">estatísticos</span></code>, mas isso será mais um <em>bônus</em>!</p>
<p>Aqui é necessário que você saiba ler e entender o que isso significa, só assim você aprenderá o que está acontecendo. Lembre-se isso é <code class="docutils literal notranslate"><span class="pre">apenas</span> <span class="pre">uma</span> <span class="pre">linguagem</span></code>, isso não é um código. É apenas uma forma de comunicação, ou seja, é uma comunicação científica.</p>
<hr class="docutils" />
<p>Aqui temos duas variáveis para estimar, <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>, e teremos que inferir a partir de <span class="math notranslate nohighlight">\(h\)</span>, das coisas que medimos, mas <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span> precisam de definições por que esse é um modelo bayesiano.</p>
</div>
<div class="section" id="adicionando-prioris">
<h2>Adicionando prioris<a class="headerlink" href="#adicionando-prioris" title="Permalink to this headline">¶</a></h2>
<p>Agora vamos definir uma priori para os parâmetros da <span class="math notranslate nohighlight">\(Normal\)</span>, o <span class="math notranslate nohighlight">\(\mu\)</span> e o <span class="math notranslate nohighlight">\(\sigma\)</span>:</p>
<div class="math notranslate nohighlight">
\[ h_i \sim Normal(\mu, \sigma) \]</div>
<div class="math notranslate nohighlight">
\[ \mu \sim Normal(178, 20) \]</div>
<div class="math notranslate nohighlight">
\[ \sigma \sim Uniform(0, 50) \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotando a distribuição à priori do mu e do sigma</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">x_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x_sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

<span class="c1"># Priori do mu</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_mu</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_mu</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Priori de $\mu$ </span><span class="se">\n</span><span class="s1"> Normal(178, 20)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1">#Priori do Sigma</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_sigma</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_sigma</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Priori de $\sigma$ </span><span class="se">\n</span><span class="s1"> Uniforme(0, 50)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_25_0.png" src="_images/parte_3_25_0.png" />
</div>
</div>
<p>Qual é a implicação de usar essas distribuições para <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>?</p>
<p>O valor <span class="math notranslate nohighlight">\(178\)</span> foi escolhido para ser a média da distribuição normal (<em>à priori</em>), esse valor foi escolhido por <code class="docutils literal notranslate"><span class="pre">acharmos</span></code> que poderia ser a altura média da população, e com isso adicionamos uma generosa incerteza (<em>incerteza da média</em>) de <span class="math notranslate nohighlight">\(20\)</span> (gráfico da esquerda).</p>
<p>Para o <span class="math notranslate nohighlight">\(\sigma\)</span> colocamos qualquer valor entre <span class="math notranslate nohighlight">\(0\)</span> até <span class="math notranslate nohighlight">\(50\)</span> (gráfico da direita), esses valores têm igual probabilidade de ocorrer, esse é um range bastante razoável já que <span class="math notranslate nohighlight">\(50\)</span> é um valor bem mais alto do que podemos esperar para o desvio padrão, pois não temos uma nenhuma informação mais razoável para colocar como priori (no mundo real certamente saberíamos um pouco mais).</p>
</div>
<div class="section" id="simulacao-a-partir-da-priori">
<h2>Simulação a partir da priori<a class="headerlink" href="#simulacao-a-partir-da-priori" title="Permalink to this headline">¶</a></h2>
<p>O que essas <code class="docutils literal notranslate"><span class="pre">prioris</span></code> estão implicando sobre a estimativa da altura, antes de vermos os dados (<span class="math notranslate nohighlight">\(h\)</span>)?</p>
<p>Para saber, vamos Simular! <code class="docutils literal notranslate"><span class="pre">Distribuição</span> <span class="pre">à</span> <span class="pre">Priori</span> <span class="pre">Preditiva</span></code>.</p>
<p>Simular os dados apenas das prioris nos permitirá entender se, do modo como estamos <em>ensinando</em> o modelo, seu resultado está sendo satisfatório.</p>
<p>Vamos simular!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================================================</span>
<span class="c1"># Construindo o processo de amostragem da distribuição à priori preditiva.</span>
<span class="c1">#                *** Priori versão com dados absurdos  ***</span>
<span class="c1"># ========================================================================</span>

<span class="c1"># Amostragem</span>
<span class="n">amostra_mu</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Normal(178, 20) estimativa para mu.</span>
<span class="n">amostra_sigma</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Uniforme(0, 50) estimativa para sigma.</span>

<span class="n">amostra_h_priori</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">amostra_mu</span><span class="p">,</span> <span class="n">amostra_sigma</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>  <span class="c1"># Amostrando da Normal(mu, sigma)</span>


<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">amostra_h_priori</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">170</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribuição Preditiva da Priori com Valores Absurdos </span><span class="se">\n</span><span class="s1"> Altura </span><span class="se">\n</span><span class="s1"> $Normal(178, 100)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;(cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 0 cm de altura, ovo fertilizado.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 272 cm de altura, pessoa mais alta da história. </span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_28_0.png" src="_images/parte_3_28_0.png" />
</div>
</div>
<p>Plotar o gráfico da <code class="docutils literal notranslate"><span class="pre">Distribuição</span> <span class="pre">Preditiva</span> <span class="pre">da</span> <span class="pre">Priori</span></code> nos permite observar que a probabilidade, por exemplo, de alguém ter a altura próxima de <span class="math notranslate nohighlight">\(0 cm\)</span> é praticamente igual a <em>zero</em>, <span class="math notranslate nohighlight">\(P\{altura = 0\}\)</span>, e ,também, a probabilidade de uma pessoa ser maior do que <span class="math notranslate nohighlight">\(272 cm\)</span>, <span class="math notranslate nohighlight">\(P\{altura &gt;= 272\}\)</span>, que é a <code class="docutils literal notranslate"><span class="pre">altura</span> <span class="pre">da</span> <span class="pre">pessoa</span> <span class="pre">mais</span> <span class="pre">alta</span> <span class="pre">no</span> <span class="pre">mundo</span> <span class="pre">já</span> <span class="pre">registrada</span></code>, é bem baixa.</p>
<p>Imagine agora que colocaremos como à priori valores muito absurdos para o <span class="math notranslate nohighlight">\(\sigma\)</span>, vamos ver o que acontece:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ========================================================================</span>
<span class="c1"># Construindo o processo de amostragem da distribuição à priori preditiva.</span>
<span class="c1"># ========================================================================</span>

<span class="c1"># Amostragem</span>
<span class="n">amostra_mu</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Normal(178, 20) estimativa para mu.</span>
<span class="n">amostra_sigma</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>  <span class="c1"># Amostra da Uniforme(0, 50) estimativa para sigma.</span>

<span class="n">amostra_h_priori</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">amostra_mu</span><span class="p">,</span> <span class="n">amostra_sigma</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>  <span class="c1"># Amostrando da Normal(mu, sigma)</span>


<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">amostra_h_priori</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">171</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribuição Preditiva da Priori  </span><span class="se">\n</span><span class="s1"> Altura&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;(cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 0 cm de altura, ovo fertilizado.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 272 cm de altura, pessoa mais alta da história.</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.3&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_30_0.png" src="_images/parte_3_30_0.png" />
</div>
</div>
<p>Os valores de probabilidade que estão sendo atribuídos pela distribuição à priori e que <code class="docutils literal notranslate"><span class="pre">estão</span> <span class="pre">para</span> <span class="pre">fora</span> <span class="pre">dos</span> <span class="pre">limites</span> <span class="pre">mais</span> <span class="pre">conservadores</span> <span class="pre">possíveis</span></code>, não deveriam ter uma importância tão grande, ou seja, sua probabilidade deveria <code class="docutils literal notranslate"><span class="pre">se</span> <span class="pre">aproximar</span></code> de <em>zero</em>!</p>
<p>Esse é um exemplo de escolha ruim para uma priori, colocando apenas um valor enorme para <span class="math notranslate nohighlight">\(\sigma\)</span> mas sem ter uma ligação mais íntima com a natureza do problema.</p>
<p>Nesse caso, <code class="docutils literal notranslate"><span class="pre">o</span> <span class="pre">caso</span> <span class="pre">univariado</span></code>, as distorções que podem ser geradas por usarmos uma priori dessa forma é praticamente nula, o modelo provavelmente ajustará bem. Já para modelos mais complexos, como modelos mistos ou modelos hierárquicos com muitos parâmetros, a utilização de prioris sem muito sentido pode causar <em>sérias</em> distorções nos resultados.</p>
<p>Por isso, <code class="docutils literal notranslate"><span class="pre">sempre</span> <span class="pre">simule</span> <span class="pre">a</span> <span class="pre">priori</span></code> para observar se o comportamento do modelo condiz com a realidade.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Priori: é essa a nossa crença antes do modelo ver o dados!</p>
</div>
</div>
<div class="section" id="calculando-a-posteriori-conjunta">
<h2>Calculando a Posteriori Conjunta<a class="headerlink" href="#calculando-a-posteriori-conjunta" title="Permalink to this headline">¶</a></h2>
<p>Nosso objetivo é estimar a distribuição conjunta dos parâmetros <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>, para isto, iremos calcular a estimativa pelo método do <em>grid de aproximação</em>.</p>
<div class="math notranslate nohighlight">
\[ p\{(\mu, \sigma) | h_i\} ∝ p\{h_i | \mu, \sigma \} p\{ \mu \} p\{ \sigma \} \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Para visualização das multiplicações vamos deixar o 𝜎 fixo, em 20, por exemplo, </span>
<span class="c1"># e iremos variar o 𝜇 entre 100 e 300, para os três valores distintos de alturas (147, 155, 180).</span>

<span class="n">curva_1</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Resetando a variável curva_1 </span>
<span class="n">curva_2</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Resetando a variável curva_2</span>
<span class="n">curva_3</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Resetando a variável curva_3</span>

<span class="n">posteriori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">curva_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curva_1</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">147</span><span class="p">))</span>  <span class="c1"># Para todos os 𝜇, calcular a probabilidade de ocorrer 147 com sigma fixo.</span>
    <span class="n">curva_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curva_2</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">155</span><span class="p">))</span>  <span class="c1"># Para todos os 𝜇, calcular a probabilidade de ocorrer 155 com sigma fixo.</span>
    <span class="n">curva_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curva_3</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">180</span><span class="p">))</span>  <span class="c1"># Para todos os 𝜇, calcular a probabilidade de ocorrer 180 com sigma fixo.</span>
    
<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Normal </span><span class="se">\n</span><span class="s1"> Para as alturas ($h_i$): {147, 155, 180} </span><span class="se">\n</span><span class="s1"> com as hipóteses de mu [100, 300] para a média&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;h=147&#39;</span><span class="p">,</span> <span class="s1">&#39;h=155&#39;</span><span class="p">,</span> <span class="s1">&#39;h=180&#39;</span><span class="p">])</span>

<span class="c1"># Abaixo iremos fazer a soma dos logs, ao invés de multiplicar. Isso será feito na próxima célula.</span>
<span class="c1"># posteriori_nao_normalizada = np.log(curva_1) + np.log(curva_2) + np.log(curva_3)  # </span>
<span class="n">posteriori_nao_normalizada</span> <span class="o">=</span> <span class="n">curva_1</span> <span class="o">*</span> <span class="n">curva_2</span> <span class="o">*</span> <span class="n">curva_3</span>   <span class="c1"># Essa multiplicação será feita ponto a ponto.</span>



<span class="n">posteriori</span> <span class="o">=</span> <span class="n">posteriori_nao_normalizada</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">)</span>  <span class="c1"># Normalizando a posteriori</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">posteriori</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>  <span class="c1"># Essa multiplicação será feita ponto a ponto.</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">curva_3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori </span><span class="se">\n</span><span class="s1"> Usando os três valores da altura juntos ($h_i$): {147, 155, 180}&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="s1">&#39;0.4&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;posteriori&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_33_0.png" src="_images/parte_3_33_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ================================</span>
<span class="c1">#     Calculando a posteriori</span>
<span class="c1"># ================================</span>

<span class="c1"># Filter only adults (&gt;= 18 years old)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">]</span>

<span class="n">grid</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Determina a precisão, para valores maiores demanda maior custo computacional!</span>

<span class="k">if</span> <span class="n">overthinking_test</span><span class="p">:</span>  <span class="c1"># Pag. 86 SR2</span>
    <span class="n">grid_width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">142</span><span class="p">,</span> <span class="mi">162</span><span class="p">)</span>
    <span class="n">grid_height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> 
<span class="k">else</span><span class="p">:</span>
    <span class="n">grid_width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">153</span><span class="p">,</span> <span class="mi">156</span><span class="p">)</span>
    <span class="n">grid_height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">)</span> 

<span class="n">mu_ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">grid_width</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_width</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">grid</span><span class="p">)</span>  <span class="c1"># Espaço do 𝜇 - Esses valores foram escolhidos para uma melhor visualização.</span>
<span class="n">sigma_ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">grid_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_height</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">grid</span><span class="p">)</span>  <span class="c1"># Espaço do 𝜎 - Esses valores foram escolhidos para uma melhor visualização.</span>

<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">mu_ls</span><span class="p">,</span> <span class="n">sigma_ls</span><span class="p">)</span>  <span class="c1"># Construindo um plano do 𝜇 vs 𝜎.</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">verossimilhanca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">verossimilhanca_parcial</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="c1"># Calcular a verossimilhança para cada (𝜇, 𝜎), usando todas as alturas da amostra. </span>
    <span class="n">verossimilhanca_parcial_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">verossimilhanca_parcial</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>  <span class="c1"># Calculando o log da verossimilhança</span>
    <span class="n">verossimilhanca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verossimilhanca</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">verossimilhanca_parcial_log</span><span class="p">))</span>

<span class="c1"># Adicionando a priori</span>
<span class="c1"># P{ altura | 𝜇, 𝜎} * P{𝜇} * P{𝜎}  ==  exp[ log(P{ altura | 𝜇, 𝜎}) + log(P{𝜇}) + log(P{𝜎}) ]</span>

<span class="n">posteriori_nao_normalizada</span> <span class="o">=</span> <span class="n">verossimilhanca</span> <span class="o">+</span> \
                             <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span> <span class="o">+</span> \
                             <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span>   <span class="c1"># Priori de sigma</span>
    
<span class="c1"># Explicação na página 561, endnotes número 73! Mais detalhes no gráfico abaixo.</span>
<span class="n">posteriori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">))</span>  
<span class="n">posteriori</span> <span class="o">=</span> <span class="n">posteriori</span> <span class="o">/</span> <span class="n">posteriori</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">mu_mesh</span><span class="p">,</span> <span class="n">sigma_mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">mu_ls</span><span class="p">,</span> <span class="n">sigma_ls</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">mu_mesh</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">sigma_mesh</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">posteriori</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">grid</span><span class="p">,</span> <span class="n">grid</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Posteriori&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">grid_width</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_width</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">grid_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_height</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_34_0.png" src="_images/parte_3_34_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Explicação gráfica - Não faz parte do material original do curso.</span>

<span class="c1"># Porque usar (posteriori_nao_normalizada - np.max(posteriori_nao_normalizada))</span>

<span class="c1"># Como exp(-x) -&gt; 0 quando x é muito negativo. Sem normalização, todos os valores serão zero.</span>

<span class="c1"># Lembrando que exp(0) = 1, por isso usar o max padroniza os valores. </span>
<span class="c1"># Ao gerar a posteriori, a escala dos valores se mantem.</span>


<span class="n">fig</span><span class="p">,</span> <span class="p">[[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],</span> <span class="p">[</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="c1"># Gráfico 1 e 3</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori não normalizada&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Escala em Log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Posteriori não normalizada&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Gráfico 2 e 4</span>
<span class="n">post_ajustada</span> <span class="o">=</span> <span class="p">(</span><span class="n">posteriori_nao_normalizada</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">posteriori_nao_normalizada</span><span class="p">))</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">post_ajustada</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori não normalizada - Ajustada&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Escala em Log - Ajsutada&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">post_ajustada</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Posteriori não normalizada - Ajustada&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_35_0.png" src="_images/parte_3_35_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =================================================================</span>
<span class="c1">#     Amostrando 𝜇 e o 𝜎 a partir da distribuição à posteriori.</span>
<span class="c1"># =================================================================</span>

<span class="c1"># Escolhendo pontos 1000 pontos aleatórios dentro do grid com a probabilidade à posteriori</span>
<span class="n">amostras_posteriori_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">*</span><span class="n">grid</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">posteriori</span><span class="p">)</span>

<span class="n">mu_amostrado</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>
<span class="n">sigma_amostrado</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_amostrado</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da Posteriori </span><span class="se">\n</span><span class="s1"> $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_amostrado</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da Posteriori </span><span class="se">\n</span><span class="s1"> $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_36_0.png" src="_images/parte_3_36_0.png" />
</div>
</div>
</div>
<div class="section" id="aproximacao-quadratica">
<h2>Aproximação Quadrática<a class="headerlink" href="#aproximacao-quadratica" title="Permalink to this headline">¶</a></h2>
<p>A partir de agora até a metade do curso iremos usar a <code class="docutils literal notranslate"><span class="pre">aproximação</span> <span class="pre">quadrática</span></code>. Se você fez os cálculos da posteriori para a altura, oque é sugerido fortemente, percebemos que a complexidade e o custo computacional envolvido para estimar às duas variáveis (<span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span>) são bastante significativos.</p>
<p>Para modelos que necessitem estimar mais parâmetros, <span class="math notranslate nohighlight">\(10\)</span> parâmetros por exemplo, o custo computacional e a estrutura necessária para calcular essa estimativa com o método do <em>grid de aproximação</em> se torna inviável. Por isso temos que pensar em uma nova estrutura na qual podemos, <strong>Laplace</strong>, <span class="math notranslate nohighlight">\(1749-1827\)</span>, propor o uso da aproximação quadrática. Com essa estrutura mais exótica, nós poderemos calcular estimativas da posteriori em dimensões muito elevadas.</p>
<ul class="simple">
<li><p>Aproximação da posteriori como uma Gaussiana</p></li>
<li><p>Podemos construir essa estimativa encontrando o valor das duas seguintes coisas:</p>
<ul>
<li><p>Pelo “pico” da posteriori, maximum a posteriori (MAP)</p></li>
<li><p>Desvio Padrão e a correlação entre os parâmetros.</p></li>
</ul>
</li>
<li><p>As estimativas são bem parecidas com o que já fizemos, exceto que não temos prioris.</p></li>
</ul>
<p>A primeira coisa que temos que olhar é para a posteriori (<em>nos histogramas acima</em>) de <span class="math notranslate nohighlight">\(\mu\)</span> e <span class="math notranslate nohighlight">\(\sigma\)</span> e subir a colina até encontrar o pico da distribuição. O computador pode começar a busca por qualquer local sem saber onde está o pico, mas ele sabe subir a colina e então pode simplesmente subir usando o apenas o <em>gradientes descendentes</em> (ou melhor, usando o gradiente ascendente, pois iremos escalar a subida até o pico). Existem muitos algoritmos eficientes para fazer isso, e podemos dar a ele um espaço multidimensional muito alto (bem maior que 2, como no exemplo anterior) e iremos alcançar o pico.</p>
<p>Quando alçarmos o pico, só precisamos medir a curvatura no pico para saber a largura da colina e isso é tudo que precisa ser feito para construímos a <code class="docutils literal notranslate"><span class="pre">aproximação</span> <span class="pre">quadrática</span></code>. Também conhecida por <code class="docutils literal notranslate"><span class="pre">Aproximação</span> <span class="pre">de</span> <span class="pre">Laplace</span></code>, por ele ter utilizado o procedimento corretamente.</p>
<img alt="Laplace" src="_images/Laplace.jpg" />
<hr class="docutils" />
<p>Fonte: <a class="reference external" href="https://fr.wikipedia.org/wiki/Pierre-Simon_de_Laplace">wikipedia</a></p>
<p>Obs: No curso original, as estimativas são realizadas com a biblioteca <code class="docutils literal notranslate"><span class="pre">Rethinking</span></code> criadas e disponibilizadas pelo github do próprio professor Richard McElreath, pode ser acessado nesse endereço: <a class="reference external" href="https://github.com/rmcelreath/rethinking">https://github.com/rmcelreath/rethinking</a></p>
<p>A partir daqui iremos fazer em paralelo com o curso a utilização da biblioteca Stan-mc a página e a documentação oficial se encontram em <a class="reference external" href="https://mc-stan.org/">Stan</a></p>
<img alt="stan" src="_images/stan-logo.png" />
<p>Obs2: a estimativa da posteriori feita pela Stan utiliza algumas técnicas mais robustas do que a aproximação quadrática, porém no curso, essas estimativas são realizadas internamente na biblioteca rethinking e é invisível para o usuário, assim, o conteúdo dessas notas serão intimamente paralelas com o curso, sendo que se ocorrer um distanciamento entre ambas trajetórias, notas extras serão inseridas para minimizar esse longor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">stan</span>  <span class="c1"># Importando a Stan - estamos usando a pystan</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Essa estrutura está definida na página 77 - SR2</span>

<span class="n">primeiro_codigo_stan</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">data {</span>
<span class="s2">    int N;</span>
<span class="s2">    real X[N];</span>
<span class="s2">}</span>

<span class="s2">parameters {</span>
<span class="s2">    real mu;</span>
<span class="s2">    real&lt;lower=0&gt; sigma;</span>
<span class="s2">}</span>

<span class="s2">model {</span>
<span class="s2">    X ~ normal(mu, sigma);</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">mu_nao_observavel</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">sigma_nao_observavel</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mu_nao_observavel</span><span class="p">,</span> <span class="n">sigma_nao_observavel</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Gerando os dados amostrais ~ Normal(50, 12)</span>
<span class="n">meus_dados</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="p">)}</span>  <span class="c1"># Construíndo um dicionário com os dados</span>

<span class="n">posteriori_model</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">primeiro_codigo_stan</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">meus_dados</span><span class="p">)</span>  <span class="c1"># Construíndo um modelo e anexando os dados</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">posteriori_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Fazendo a amostragem da posteriori </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recuperando os parâmetros</span>
<span class="n">mu_modelo_1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Amostras da posteriori do 𝜇</span>
<span class="n">sigma_modelo_1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Amostras da posteriori do 𝜎</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  mu médio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mu_modelo_1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39; </span><span class="se">\t</span><span class="s1"> mu original: &#39;</span><span class="p">,</span> <span class="n">mu_nao_observavel</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  sigma médio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">sigma_modelo_1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39; </span><span class="se">\t</span><span class="s1"> sigma original: &#39;</span><span class="p">,</span> <span class="n">sigma_nao_observavel</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Posteriori estimada com a Stan&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_modelo_1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequências à Posteriori&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_modelo_1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequências à Posteriori&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
  mu médio:  50.57  	 mu original:  50
  sigma médio:  11.9  	 sigma original:  12
======================================================================
</pre></div>
</div>
<img alt="_images/parte_3_42_1.png" src="_images/parte_3_42_1.png" />
</div>
</div>
</div>
<div class="section" id="estimando-a-altura-usando-a-stan">
<h2>Estimando a altura usando a Stan<a class="headerlink" href="#estimando-a-altura-usando-a-stan" title="Permalink to this headline">¶</a></h2>
<p>De volta ao exemplo anterior, vamos estimar a altura <span class="math notranslate nohighlight">\(h\)</span> usando um modelo escrito em Stan.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelo_altura</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        real altura[N];</span>
<span class="s2">    }</span>

<span class="s2">    parameters {</span>
<span class="s2">        real mu;</span>
<span class="s2">        real&lt;lower=0, upper=50&gt; sigma;  // Priori para sigma ~ Uniform(0, 50)</span>
<span class="s2">    }</span>

<span class="s2">    model {</span>
<span class="s2">        //mu ~ normal(178, 0.1);  // *Teste com a priori muito informativa, veja o impacto do sigma à posteriori</span>
<span class="s2">        //mu ~ normal(154, 0.1);  // *Teste com a priori informativa com a média bem pŕoxima do que será estimado, usado apenas para entendimento, verifique que a média da variância se mantém.</span>
<span class="s2">        mu ~ normal(178, 20);   // Priori para mu</span>
<span class="s2">        sigma ~ uniform(0, 50);  // Priori para sigma</span>

<span class="s2">        altura ~ normal(mu, sigma);</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">altura</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Como recomenda a documentação https://mc-stan.org/docs/2_22/stan-users-guide/standardizing-predictors-and-outputs.html</span>
<span class="c1"># Iremos rescalonar o vetor de altura antes de mandar para a Stan</span>
<span class="n">altura_media</span> <span class="o">=</span> <span class="n">altura</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">altura_std</span> <span class="o">=</span> <span class="n">altura</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">altura_resc</span> <span class="o">=</span> <span class="p">(</span><span class="n">altura</span> <span class="o">-</span> <span class="n">altura_media</span><span class="p">)</span> <span class="o">/</span> <span class="n">altura_std</span>

<span class="n">dados</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">altura</span><span class="p">),</span> 
         <span class="s1">&#39;altura&#39;</span><span class="p">:</span> <span class="n">altura</span><span class="p">}</span>  <span class="c1"># Iremos usar a altura não normalizada para efeito de simplificação.</span>

<span class="n">posteriori_model</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">modelo_altura</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dados</span><span class="p">)</span>
<span class="n">fit_altura</span> <span class="o">=</span> <span class="n">posteriori_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare o sigma usando duas priori diferentes para mu.</span>
<span class="c1"># (***) Com a priori mu ~ normal(178, 0.1), a posteriori do sigma tem um aumento significativo.</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Média: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sigma: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori $\mu$ da altura&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Média do $\mu$ da altura (cm)&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori $\sigma$ da altura&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Média do $\sigma$ da altura&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----------------------------------------
Média:  154.6175358324885
Sigma:  7.77149906071101
----------------------------------------
</pre></div>
</div>
<img alt="_images/parte_3_45_1.png" src="_images/parte_3_45_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#  Modelo calculado na Stan</span>
<span class="c1"># =============================</span>

<span class="c1"># Recuperando os parâmetros</span>
<span class="n">mu_altura</span> <span class="o">=</span> <span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>
<span class="n">sigma_altura</span> <span class="o">=</span> <span class="n">fit_altura</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Comparativo com a amostra&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  mu amostrado: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  sigma amostrado: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  mu médio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mu_altura</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  sigma médio: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">sigma_altura</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Posteriori estimada com a Stan&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_altura</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequências à Posteriori&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_altura</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori de $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequências à Posteriori&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># =============================</span>
<span class="c1">#  Modelo calculado na mão</span>
<span class="c1"># =============================</span>
<span class="c1"># Amostrando mu e sigma a partir da posteriori calculada na mão (exemplo construído acima)</span>

<span class="n">amostras_posteriori_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">grid</span><span class="o">*</span><span class="n">grid</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">posteriori</span><span class="p">)</span>

<span class="n">mu_amostrado</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>
<span class="n">sigma_amostrado</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="n">amostras_posteriori_index</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Posteriori estimada na mão&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mu_amostrado</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da posteriori </span><span class="se">\n</span><span class="s1"> $\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sigma_amostrado</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Amostra da posteriori </span><span class="se">\n</span><span class="s1"> $\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probabilidade&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Comparativo com a amostra
==============================
  mu amostrado:  154.6
  sigma amostrado:  7.74
==============================
  mu médio:  154.62
  sigma médio:  7.77
==============================
</pre></div>
</div>
<img alt="_images/parte_3_46_1.png" src="_images/parte_3_46_1.png" />
<img alt="_images/parte_3_46_2.png" src="_images/parte_3_46_2.png" />
</div>
</div>
</div>
<div class="section" id="adicionando-uma-variavel-preditora">
<h2>Adicionando uma variável Preditora<a class="headerlink" href="#adicionando-uma-variavel-preditora" title="Permalink to this headline">¶</a></h2>
<p>Agora, iremos refazer a estimativa da altura, mas iremos usar <code class="docutils literal notranslate"><span class="pre">mais</span> <span class="pre">uma</span> <span class="pre">variável</span></code> para nos ajudar explicar melhor a altura, e assim teremos mais informações. Usaremos a variável <code class="docutils literal notranslate"><span class="pre">peso</span></code> (<em>weight</em>) que nos ajudará a entender melhor a altura (<em>height</em>)?</p>
<p><em>Obs: Iremos selecionar apenas as pessoas que tenham acima de 18 anos de idade para todos os estudo a seguir.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gráfico de dispersão - peso ajudar a identificar qual a altura.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">],</span>  <span class="c1"># Filtro para todos as pessoas que tem acima de 18 anos</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">])</span>  <span class="c1"># Filtro para todos as pessoas que tem acima de 18 anos</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Dispersão&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Peso (weight)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altura (height)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_48_0.png" src="_images/parte_3_48_0.png" />
</div>
</div>
<p>Usando um modelo linear de média, <span class="math notranslate nohighlight">\(\mu\)</span>:</p>
<div class="math notranslate nohighlight">
\[ h_i \sim Normal(\mu_i, \sigma), \mbox{ [Verossimilhaças] }\]</div>
<div class="math notranslate nohighlight">
\[ mu_i = \alpha + \beta(x_i + \bar{x}), \mbox{ [Modelo Linear] } \]</div>
<div class="math notranslate nohighlight">
\[  \alpha \sim Normal(178, 20), \mbox{ [Priori de }\alpha \mbox{]} \]</div>
<div class="math notranslate nohighlight">
\[  \beta \sim Normal(0, 10), \mbox{ [Priori de }\beta \mbox{]} \]</div>
<div class="math notranslate nohighlight">
\[  \sigma \sim Uniform(0, 50), \mbox{ [Priori de }\sigma \mbox{]} \]</div>
<p>Vamos agora construir uma reta, <code class="docutils literal notranslate"><span class="pre">um</span> <span class="pre">modelo</span> <span class="pre">linear</span></code>. Até agora nós fizemos inferências de <span class="math notranslate nohighlight">\(1\)</span> ou <span class="math notranslate nohighlight">\(2\)</span> parâmetros e que podem ser aproximadas como uma gaussiana.</p>
<p>Mas o que significa fazer um modelo linear, ou utilizar uma reta no modelo? Isso significa que podemos adicionar uma nova variável que irá nos ajudar a melhorar nosso entendimento da variável <code class="docutils literal notranslate"><span class="pre">altura</span></code>. Essa nova variável terá a função, dentro do nosso modelo, de predizer, ou seja, dizer antecipadamente, antever, adivinhar, prever qual é a da altura do indivíduo, probabilisticamente. Chamamos todas essas variáveis que podem nos ajudar de <code class="docutils literal notranslate"><span class="pre">variáveis</span> <span class="pre">preditoras</span></code>.</p>
<p>A principal ideia em adicionar uma variável preditora, assim como outras variáveis do nosso conjunto de dados, é que quando aprendemos, podemos fazer melhores previsões sobre o resultado de interesse que, nesse caso, é a <code class="docutils literal notranslate"><span class="pre">altura</span></code>.</p>
<p>Para ficar mais claro, quando pretendemos saber a altura de uma pessoa sem termos nenhuma informação adicional, o melhor que podemos fazer é usar a estimativa da altura da população toda para estimar a altura desse indivíduo. É o máximo que podemos fazer com as informações que temos disponíveis.</p>
<p>Mas se esse mesmo indivíduo, assim como todos da amostra, nos informar uma característica a mais para nós estimarmos sua altura? Nesse exemplo, o peso é uma dessas informações adicionais, <code class="docutils literal notranslate"><span class="pre">variável</span> <span class="pre">preditora</span></code>, assim teremos mais conhecimento para poder estimar a sua <em>altura</em>.</p>
<div class="section" id="explicando-o-modelo-acima">
<h3>Explicando o modelo acima:<a class="headerlink" href="#explicando-o-modelo-acima" title="Permalink to this headline">¶</a></h3>
<p>Agora temos que <span class="math notranslate nohighlight">\(h_i\)</span> também contínua distribuída como uma <code class="docutils literal notranslate"><span class="pre">Gaussiana</span></code> como no exemplo anterior, porém agora a média <span class="math notranslate nohighlight">\(\mu\)</span> não é apenas distribuída normalmente com a média fixa em 178, dependerá de cada indivíduo <span class="math notranslate nohighlight">\(i\)</span>, assim:</p>
<div class="math notranslate nohighlight">
\[ \mu_i = \alpha + \beta(x_i + \bar{x}) \]</div>
<p><span class="math notranslate nohighlight">\(x_i\)</span> representa o peso de uma pessoa em particular.</p>
<p>Em instante iremos entender melhor o que significa todos os termos de <span class="math notranslate nohighlight">\(\mu\)</span>. O <span class="math notranslate nohighlight">\(\alpha\)</span> e o <span class="math notranslate nohighlight">\(\sigma\)</span> continuam com as mesmas prioris do exemplo anterior, e agora temos uma nova distribuição à priori para <span class="math notranslate nohighlight">\(\beta\)</span>, que é o responsável por descrever a relação entre <code class="docutils literal notranslate"><span class="pre">altura</span></code> e o <code class="docutils literal notranslate"><span class="pre">peso</span></code>.</p>
<p>Observando mais profundamente a estrutura que criamos nosso novo modelo:</p>
<div class="math notranslate nohighlight">
\[ \mu_i = \alpha + \beta(x_i + \bar{x}) \]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mu_i\)</span> = é a média da linha i</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span> = é a altura média da quando <span class="math notranslate nohighlight">\(x_i = \bar{x}\)</span>, conhecida como o <code class="docutils literal notranslate"><span class="pre">intercepto</span></code>. (<em>Lindo!!!</em>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta\)</span> = taxa de mudança para <span class="math notranslate nohighlight">\(\mu\)</span> cada unidade de mudança de <span class="math notranslate nohighlight">\(x_i\)</span>, conhecido como a <code class="docutils literal notranslate"><span class="pre">inclinação</span></code>.</p></li>
</ul>
<p>Se por acaso o <span class="math notranslate nohighlight">\(\beta\)</span> for zero, estamos novamente no modelo anterior. Ou seja, estamos dizendo que não há relação  transmitida para o <span class="math notranslate nohighlight">\(\mu\)</span> a partir do peso. Do contrário, cada número que o <span class="math notranslate nohighlight">\(x_i\)</span> sobe, subimos <span class="math notranslate nohighlight">\(\beta\)</span> o <span class="math notranslate nohighlight">\(\mu\)</span>.</p>
<p>Escrever nossos modelos lineares dessa forma nos permite entender e definir melhor os parâmetros e nossa prioris, mas nem todos os modelos devem ser escritos dessa forma e nesse caso deveremos ter uma boa justificativa.</p>
</div>
</div>
<div class="section" id="distribuicao-priori-preditiva">
<h2>Distribuição Priori Preditiva<a class="headerlink" href="#distribuicao-priori-preditiva" title="Permalink to this headline">¶</a></h2>
<p>Quais são as prioris desse modelo e o que essas prioris significam?</p>
<p>Como, no exemplo anterior, vamos simular para entender e compreender as implicações do modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===========================</span>
<span class="c1">#     Simulando a Priori</span>
<span class="c1"># ===========================</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># A quantidade de vezes que iremos simular os dados da priori</span>

<span class="n">alpha_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">beta_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> 
             <span class="n">alpha_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span> <span class="c1"># (x_i - x_bar)</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha inferior vermelha: Altura óvulo fertilizado (0cm)  </span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha superior vermelha: Pessoa mais alta do mundo (272 cm)</span>
  
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Pessoa mais alta já registrada </span><span class="se">\n</span><span class="s1">              (272 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">280</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Altura do Embrião </span><span class="se">\n</span><span class="s1">           (0 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Priori: $alpha + beta * x_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altura $h_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Peso $x_i$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_52_0.png" src="_images/parte_3_52_0.png" />
</div>
</div>
<p>O resultado das simulações da distribuição à priori do <span class="math notranslate nohighlight">\(\alpha\)</span> e o <span class="math notranslate nohighlight">\(\beta\)</span>, geram as curvas acima, de acordo o modelo:</p>
<div class="math notranslate nohighlight">
\[ altura = \alpha + \beta \times peso \]</div>
<p>com podemos ver no gráfico, muitas linhas tem valores superiores à altura de <span class="math notranslate nohighlight">\(272 cm\)</span>. Também podemos ver que existem linhas que indicam alturas menores que zero, <code class="docutils literal notranslate"><span class="pre">o</span> <span class="pre">que</span> <span class="pre">naturalmente</span> <span class="pre">deveria</span> <span class="pre">estar</span> <span class="pre">errado</span></code>. Ambos comportamentos são prioritariamente resultantes dos valores gerados pela distribuição dos <span class="math notranslate nohighlight">\(\beta\)</span>’s, a inclinação da reta.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Essas retas são as nossas crenças à priori.</p>
</div>
<p>Agora que temos um pouco mais de intimidade com o comportamento das nossas prioris, podemos concluir que devemos diminuir nosso entusiasmo com relação ao <span class="math notranslate nohighlight">\(\beta\)</span>, pois essa <code class="docutils literal notranslate"><span class="pre">é</span> <span class="pre">uma</span> <span class="pre">priori</span> <span class="pre">muito</span> <span class="pre">ruim</span></code>. Haverá momentos, em situações reais, que será necessário verificar a compatibilidade com o mundo real. Faça alterações nas prioris para verificar a mudança no efeito.</p>
<div class="section" id="distribuicao-preditiva-da-priori">
<h3>Distribuição Preditiva da Priori<a class="headerlink" href="#distribuicao-preditiva-da-priori" title="Permalink to this headline">¶</a></h3>
<p>Nós agora sabemos algo sobre as prioris, temos um conhecimento científico sobre a nossa distribuição dos <span class="math notranslate nohighlight">\(\beta\)</span>’s, sabemos que ele é positivo, assim, então, vamos transforma-lo em positivo?</p>
<p><em>Mas como?</em></p>
<p>Para fazer isso, usaremos a distribuição <code class="docutils literal notranslate"><span class="pre">log-Normal</span></code>. Essa distribuição pode ser um pouco menos conhecida, porém é muito útil para situações desse tipo. Essa distribuição, log-Normal, construída partir da exponenciação dos valores da distribuição Normal.</p>
<div class="math notranslate nohighlight">
\[Log-Normal(0, 1) = exp( Normal(0, 1))\]</div>
<p>Na teoria das probabilidades, uma distribuição log-normal (ou lognormal) é uma distribuição de probabilidade contínua de uma variável aleatória cujo logaritmo é normalmente distribuído.</p>
<p>Assim, se a variável aleatória <span class="math notranslate nohighlight">\(X\)</span> é log-normalmente distribuída, então <span class="math notranslate nohighlight">\(Y = log(X)\)</span> tem uma distribuição normal. <em>(Ref. Wikipedia)</em></p>
<p>Referências:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/reference/generated/scipy.stats.lognorm.html#scipy.stats.lognorm">Numpy - Log-Normal</a></p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.lognormal.html">Scipy - Log-Normal</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Log-normal_distribution">Wikipedia - Log-Normal</a></p></li>
</ul>
<hr class="docutils" />
<p>Um caminho para se entender melhor o que é uma <span class="math notranslate nohighlight">\(lognormal\)</span> é o seguinte:</p>
<p>Qual é a distribuição de <span class="math notranslate nohighlight">\(X\)</span>, na qual, ao aplicarmos o log, <span class="math notranslate nohighlight">\(log(X)\)</span>, ela se tornará <span class="math notranslate nohighlight">\(Normal\)</span>? Naturalmente temos que:</p>
<p>de acordo com a expressão abaixo:</p>
<div class="math notranslate nohighlight">
\[ log(exp(a)) = a , \forall a \in R\]</div>
<p>se a distribuição de <span class="math notranslate nohighlight">\(X\)</span> for:</p>
<div class="math notranslate nohighlight">
\[ X \sim exp(Normal) \]</div>
<p>então a operação abaixo é válida,</p>
<div class="math notranslate nohighlight">
\[  log(exp(Normal)) = Normal \]</div>
<p>logo,</p>
<div class="math notranslate nohighlight">
\[ log(X) = Normal \]</div>
<p>então, assim teremos que:</p>
<div class="math notranslate nohighlight">
\[ X \sim lognormal \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================</span>
<span class="c1">#     Estudos sobre as Log-Normais </span>
<span class="c1"># =====================================</span>
<span class="c1"># Iremos plotar, a partir de uma </span>
<span class="c1"># distribuição normal, uma lognormal </span>
<span class="c1"># e compara-la com amostragem da </span>
<span class="c1"># lognormal implementada no Numpy!</span>
<span class="c1"># =====================================</span>

<span class="n">d_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">d_lognormal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">[[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],[</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d_normal</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$exp( Normal(0,1) )$ </span><span class="se">\n</span><span class="s1"> Log Normal gerada na mão&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d_lognormal</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histograma da distribuição lognormal </span><span class="se">\n</span><span class="s1"> Gerada usando Numpy&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d_normal</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$exp( Normal(0,1) )$ </span><span class="se">\n</span><span class="s1"> Log Normal gerada na mão </span><span class="se">\n</span><span class="s1"> Mostrando valores de 0 a 5&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d_lognormal</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histograma da distribuição lognormal </span><span class="se">\n</span><span class="s1"> Gerada usando Numpy </span><span class="se">\n</span><span class="s1"> Mostrando os valores de 0 a 5&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ajustar as distâncias entre os gráficos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_55_0.png" src="_images/parte_3_55_0.png" />
</div>
</div>
<hr class="docutils" />
<p>Com a lognormal explicada, iremos trocar a distribuição da a priori de:</p>
<div class="math notranslate nohighlight">
\[\beta \sim Normal(0, 10)\]</div>
<p>para uma priori que é distribuída conforme uma <em>lognormal</em>:</p>
<div class="math notranslate nohighlight">
\[\beta \sim lognormal(0, 1)\]</div>
<p>Assim, como antes, vamos <code class="docutils literal notranslate"><span class="pre">simular</span> <span class="pre">para</span> <span class="pre">entender</span> <span class="pre">o</span> <span class="pre">novo</span> <span class="pre">comportamento</span> <span class="pre">da</span> <span class="pre">nossa</span> <span class="pre">priori</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==========================================</span>
<span class="c1">#     Simulando a priori com log-normal</span>
<span class="c1"># ==========================================</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># A quantidade de vezes que iremos simular os dados da priori</span>

<span class="n">alpha_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">beta_priori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>  <span class="c1"># Priori lognormal(0, 1)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">alpha_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_priori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span> <span class="c1"># (x_i - x_bar)</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha inferior vermelha: Altura óvulo fertilizado (0cm)  </span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Linha superior vermelha: Pessoa mais alta do mundo (272 cm)</span>
  
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Pessoa mais alta já registrada </span><span class="se">\n</span><span class="s1">              (272 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">280</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Altura do Embrião </span><span class="se">\n</span><span class="s1">           (0 cm)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Priori: $alpha + beta * x_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altura $h_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Peso $x_i$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/parte_3_57_0.png" src="_images/parte_3_57_0.png" />
</div>
</div>
<p>Nós ainda temos muita dispersão e também temos ainda algumas poucas linhas que ultrapassam a maior altura já registrada (de <span class="math notranslate nohighlight">\(272 cm\)</span>). Isso acontece porque não limitamos a nossa margem superior pela distribuição de <span class="math notranslate nohighlight">\(\beta\)</span>. Mas essa nossa nova abordagem parece ser uma priori bem mais condizente com o que podemos imaginar.</p>
<div class="section" id="aproximacao-da-posteriori">
<h4>Aproximação da posteriori<a class="headerlink" href="#aproximacao-da-posteriori" title="Permalink to this headline">¶</a></h4>
<p>Vamos fazer a aproximação da posteriori usando a <em>Stan</em> e verificar os resultados.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =================================================================</span>
<span class="c1">#   Aproximando a posteriori da altura usando o peso da pessoa</span>
<span class="c1"># =================================================================</span>

<span class="n">modelo_altura_2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    data {</span>
<span class="s2">        int N;</span>
<span class="s2">        real x_barra;</span>
<span class="s2">        real altura[N];</span>
<span class="s2">        real peso[N];</span>
<span class="s2">    }</span>

<span class="s2">    parameters {</span>
<span class="s2">        real alpha;</span>
<span class="s2">        real&lt;lower=0&gt; beta;</span>
<span class="s2">        real&lt;lower=0, upper=50&gt; sigma;</span>
<span class="s2">    }</span>

<span class="s2">    model {</span>
<span class="s2">        alpha ~ normal(178, 20);</span>
<span class="s2">        beta ~ lognormal(0, 1);</span>
<span class="s2">        // sigma ~ uniform(0, 50);</span>

<span class="s2">        for (i in 1:N){</span>
<span class="s2">            altura[i] ~ normal(alpha +  beta * (peso[i] - x_barra), sigma);</span>
<span class="s2">    }</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Nossa amostra é apenas para pessoas acima de 18 anos</span>
<span class="n">df_maioridade</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">]]</span>

<span class="c1"># Definindo as variáveis</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_maioridade</span><span class="p">)</span>
<span class="n">x_barra</span> <span class="o">=</span> <span class="n">df_maioridade</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">altura</span> <span class="o">=</span> <span class="n">df_maioridade</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">values</span>
<span class="n">peso</span> <span class="o">=</span> <span class="n">df_maioridade</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Construindo o dicionário</span>
<span class="n">meus_dados_2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span> 
                <span class="s1">&#39;x_barra&#39;</span><span class="p">:</span> <span class="n">x_barra</span><span class="p">,</span> 
                <span class="s1">&#39;altura&#39;</span><span class="p">:</span> <span class="n">altura</span><span class="p">,</span> 
                <span class="s1">&#39;peso&#39;</span><span class="p">:</span> <span class="n">peso</span><span class="p">}</span>

<span class="c1"># Rodando o modelo</span>
<span class="n">posteriori_model_2</span> <span class="o">=</span> <span class="n">stan</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">modelo_altura_2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">meus_dados_2</span><span class="p">)</span>
<span class="n">fit_altura_2</span> <span class="o">=</span> <span class="n">posteriori_model_2</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================</span>
<span class="c1">#  Modelo calculado na Stan</span>
<span class="c1"># =============================</span>

<span class="c1"># Recuperando os parâmetros</span>
<span class="n">alpha_posteriori</span> <span class="o">=</span> <span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_posteriori</span> <span class="o">=</span> <span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resumo das posterioris:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Media alpha: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">1</span><span class="p">),</span> 
     <span class="s1">&#39; - Desvio Padrão alpha: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Média beta:  &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">),</span>
      <span class="s1">&#39; - Desvio Padrão beta:  &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Média sigma: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">),</span> 
      <span class="s1">&#39; - Desvio Padrão sigma: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>


<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha_posteriori</span><span class="p">)</span>  <span class="c1"># Plotar todas as curvas estimadas</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># Plotar as 200 primeiras curvas</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Modelo linear </span><span class="se">\n</span><span class="s1"> Posteriori da Altura&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Altura&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Peso&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">alpha_posteriori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">beta_posteriori</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span> 
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># ==========================================</span>
<span class="c1">#    Plot todas as variáveis  estimadas</span>
<span class="c1"># ==========================================</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori alpha&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequência&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori beta&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequência&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Beta&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">fit_altura_2</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posteriori sigma&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequência&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sigma&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Ajustar as distâncias entre os gráficos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resumo das posterioris:
============================================================
Media alpha:  154.6  - Desvio Padrão alpha:  0.273
Média beta:   0.904  - Desvio Padrão beta:   0.042
Média sigma:  5.111  - Desvio Padrão sigma:  0.195
</pre></div>
</div>
<img alt="_images/parte_3_61_1.png" src="_images/parte_3_61_1.png" />
<img alt="_images/parte_3_61_2.png" src="_images/parte_3_61_2.png" />
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="resumo">
<h1>Resumo<a class="headerlink" href="#resumo" title="Permalink to this headline">¶</a></h1>
<p>Até aqui vimos a construção de um modelo linear simples usando a Stan, vimos também como pensar e como construir uma priori, vimos como gerar as amostras da posteriori e analisar seus resultados.</p>
<p>O modelo linear é o modelo muito simples e é empregado em <em>muitas</em> análises no dia a dia.</p>
<p>Na mesma linha de raciocínio que usamos para pensar e construir esse modelo de regressão linear, nós também iremos utilizá-la na próxima parte desse material. Iremos adicionar mais ferramentas dentro dessa estrutura e, com isso, aumentaremos um pouco mais a profundidade que nossas análises podem alcançar.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="parte_2.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">2 - Engenharia de Golems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="parte_4.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">4 - Funções Wiggly</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Rodolpho Macedo dos Santos<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>